<!DOCTYPE html>
<html>
<head>
	<title>Semgrep Rule Generator - Security Tools</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Generate custom Semgrep rules for security scanning - detect SQL injection, XSS, command injection, hardcoded secrets, and more.">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
	<style>
		:root {
			--bg-primary: #fafafa;
			--bg-secondary: #fff;
			--bg-code: #18181b;
			--text-primary: #171717;
			--text-secondary: #525252;
			--text-muted: #a3a3a3;
			--border-color: #e5e5e5;
			--accent: #171717;
			--accent-hover: #404040;
			--code-text: #a1a1aa;
		}

		* { box-sizing: border-box; }

		body {
			font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
			background-color: var(--bg-primary);
			color: var(--text-primary);
			margin: 0;
			padding: 0;
			line-height: 1.6;
			-webkit-font-smoothing: antialiased;
		}

		.navbar {
			background-color: var(--bg-secondary);
			padding: 16px 0;
			border-bottom: 1px solid var(--border-color);
		}

		.navbar-brand { color: var(--text-primary) !important; font-size: 15px; font-weight: 600; }
		.nav-link { color: var(--text-secondary) !important; font-size: 14px; font-weight: 500; margin-left: 24px; }
		.nav-link:hover, .nav-link.active { color: var(--text-primary) !important; }

		.page-header {
			background: var(--bg-secondary);
			border-bottom: 1px solid var(--border-color);
			padding: 32px 0;
		}

		.page-header h1 { font-size: 24px; font-weight: 700; letter-spacing: -0.02em; margin: 0; }
		.page-header p { font-size: 14px; color: var(--text-secondary); margin: 8px 0 0 0; }

		.main-content { padding: 32px 0 64px; }

		.card {
			background: var(--bg-secondary);
			border: 1px solid var(--border-color);
			border-radius: 8px;
			margin-bottom: 20px;
		}

		.card-header {
			background: transparent;
			border-bottom: 1px solid var(--border-color);
			padding: 14px 20px;
			font-size: 13px;
			font-weight: 600;
			color: var(--text-primary);
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.card-header i { color: var(--text-muted); font-size: 12px; }
		.card-header[data-toggle="collapse"] { cursor: pointer; }
		.card-header .float-right { margin-left: auto; }

		.card-body { padding: 20px; }

		.section-label {
			font-size: 11px;
			font-weight: 600;
			letter-spacing: 0.05em;
			text-transform: uppercase;
			color: var(--text-muted);
			margin: 16px 0 12px 0;
		}

		.section-label:first-child { margin-top: 0; }

		.preset-btn {
			display: inline-block;
			margin: 3px;
			font-size: 12px;
			padding: 5px 10px;
			border-radius: 4px;
			border: 1px solid var(--border-color);
			background: var(--bg-secondary);
			color: var(--text-secondary);
			cursor: pointer;
			transition: all 0.15s;
			font-family: 'Inter', sans-serif;
		}

		.preset-btn:hover { border-color: var(--text-muted); color: var(--text-primary); }
		.preset-btn.active { background: var(--accent); border-color: var(--accent); color: #fff; }

		.lang-badge {
			display: inline-block;
			padding: 4px 12px;
			border-radius: 4px;
			font-size: 12px;
			font-weight: 500;
			margin: 3px;
			cursor: pointer;
			transition: all 0.15s;
			border: 1px solid var(--border-color);
			background: var(--bg-secondary);
			color: var(--text-secondary);
		}

		.lang-badge:hover { border-color: var(--text-muted); }
		.lang-badge.active { background: var(--accent); border-color: var(--accent); color: #fff; }

		.form-group label { font-size: 13px; font-weight: 500; color: var(--text-primary); margin-bottom: 6px; }

		.form-control {
			font-family: 'Inter', sans-serif;
			font-size: 13px;
			border: 1px solid var(--border-color);
			border-radius: 6px;
			padding: 8px 12px;
		}

		.form-control:focus { border-color: var(--text-muted); box-shadow: none; }

		.pattern-input {
			font-family: 'JetBrains Mono', monospace;
			font-size: 12px;
			background: var(--bg-primary);
		}

		.btn-primary {
			background: var(--accent);
			border: none;
			padding: 8px 16px;
			font-size: 13px;
			font-weight: 500;
			border-radius: 6px;
		}

		.btn-primary:hover { background: var(--accent-hover); }

		.btn-secondary {
			background: var(--bg-primary);
			border: 1px solid var(--border-color);
			color: var(--text-primary);
			padding: 6px 12px;
			font-size: 12px;
			font-weight: 500;
			border-radius: 6px;
		}

		.btn-secondary:hover { background: var(--border-color); border-color: var(--border-color); color: var(--text-primary); }

		.output-area {
			background: var(--bg-code);
			color: #98c379;
			font-family: 'JetBrains Mono', monospace;
			padding: 16px;
			border-radius: 6px;
			font-size: 12px;
			white-space: pre-wrap;
			word-break: break-all;
			min-height: 280px;
			max-height: 500px;
			overflow-y: auto;
			position: relative;
		}

		.copy-btn {
			position: absolute;
			top: 8px;
			right: 8px;
			background: rgba(255,255,255,0.1);
			border: none;
			color: var(--code-text);
			padding: 4px 10px;
			border-radius: 4px;
			cursor: pointer;
			font-size: 11px;
			font-family: 'Inter', sans-serif;
		}

		.copy-btn:hover { background: rgba(255,255,255,0.15); color: #fff; }

		.nav-tabs { border-bottom: 1px solid var(--border-color); }

		.nav-tabs .nav-link {
			border: none;
			border-bottom: 2px solid transparent;
			color: var(--text-muted) !important;
			font-size: 13px;
			font-weight: 500;
			padding: 10px 16px;
			margin: 0;
			margin-bottom: -1px;
		}

		.nav-tabs .nav-link:hover { border-color: transparent; color: var(--text-primary) !important; }
		.nav-tabs .nav-link.active { border-bottom-color: var(--accent); color: var(--text-primary) !important; background: transparent; }

		.tab-content {
			padding: 20px;
			border: 1px solid var(--border-color);
			border-top: none;
			border-radius: 0 0 6px 6px;
			background: var(--bg-secondary);
		}

		.help-text { font-size: 11px; color: var(--text-muted); margin-top: 4px; }

		.pattern-example {
			background: var(--bg-primary);
			border: 1px solid var(--border-color);
			border-radius: 4px;
			padding: 10px;
			font-family: 'JetBrains Mono', monospace;
			font-size: 11px;
			margin: 6px 0;
			color: var(--text-secondary);
		}

		.ref-scroll { max-height: 240px; overflow-y: auto; }

		footer {
			background: var(--bg-secondary);
			border-top: 1px solid var(--border-color);
			padding: 24px 0;
		}

		footer p { margin: 0; font-size: 13px; color: var(--text-muted); }

		@media (max-width: 992px) {
			.main-content { padding: 24px 0 48px; }
		}
	</style>
</head>
<body>
	<nav class="navbar navbar-expand-lg">
		<div class="container">
			<a class="navbar-brand" href="../index.html">Shravan Kumar Sheri</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
					<li class="nav-item"><a class="nav-link" href="../blog.html">Blog</a></li>
					<li class="nav-item"><a class="nav-link active" href="../tools.html">Tools</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<section class="page-header">
		<div class="container">
			<h1>Semgrep Rule Generator</h1>
			<p>Generate custom Semgrep SAST rules for security vulnerability detection</p>
		</div>
	</section>

	<section class="main-content">
		<div class="container">
			<div class="row">
				<div class="col-lg-7">
					<!-- Language Selection -->
					<div class="card">
						<div class="card-header"><i class="fas fa-code"></i> Language</div>
						<div class="card-body">
							<span class="lang-badge active" onclick="selectLanguage('python')">Python</span>
							<span class="lang-badge" onclick="selectLanguage('javascript')">JavaScript</span>
							<span class="lang-badge" onclick="selectLanguage('java')">Java</span>
							<span class="lang-badge" onclick="selectLanguage('go')">Go</span>
							<span class="lang-badge" onclick="selectLanguage('php')">PHP</span>
							<span class="lang-badge" onclick="selectLanguage('csharp')">C#</span>
							<span class="lang-badge" onclick="selectLanguage('ruby')">Ruby</span>
							<span class="lang-badge" onclick="selectLanguage('generic')">Generic</span>
						</div>
					</div>

					<!-- Preset Patterns -->
					<div class="card">
						<div class="card-header"><i class="fas fa-bolt"></i> Quick Presets</div>
						<div class="card-body">
							<p class="section-label">Injection</p>
							<button class="preset-btn" onclick="setPreset('sqli')">SQL Injection</button>
							<button class="preset-btn" onclick="setPreset('cmdi')">Command Injection</button>
							<button class="preset-btn" onclick="setPreset('xss')">XSS</button>
							<button class="preset-btn" onclick="setPreset('ssrf')">SSRF</button>
							<button class="preset-btn" onclick="setPreset('xxe')">XXE</button>
							<button class="preset-btn" onclick="setPreset('ldapi')">LDAP Injection</button>
							<button class="preset-btn" onclick="setPreset('xpath')">XPath Injection</button>
							<button class="preset-btn" onclick="setPreset('ssti')">SSTI</button>

							<p class="section-label">Secrets & Credentials</p>
							<button class="preset-btn" onclick="setPreset('hardcodedPassword')">Hardcoded Password</button>
							<button class="preset-btn" onclick="setPreset('hardcodedSecret')">Hardcoded Secret</button>
							<button class="preset-btn" onclick="setPreset('apiKey')">API Key</button>
							<button class="preset-btn" onclick="setPreset('awsKeys')">AWS Keys</button>
							<button class="preset-btn" onclick="setPreset('privateKey')">Private Key</button>
							<button class="preset-btn" onclick="setPreset('jwtSecret')">JWT Secret</button>

							<p class="section-label">Crypto & Auth</p>
							<button class="preset-btn" onclick="setPreset('weakCrypto')">Weak Crypto</button>
							<button class="preset-btn" onclick="setPreset('weakHash')">Weak Hashing</button>
							<button class="preset-btn" onclick="setPreset('insecureRandom')">Insecure Random</button>
							<button class="preset-btn" onclick="setPreset('noAuth')">Missing Auth</button>
							<button class="preset-btn" onclick="setPreset('hardcodedIV')">Hardcoded IV</button>

							<p class="section-label">Code Quality</p>
							<button class="preset-btn" onclick="setPreset('debugCode')">Debug Code</button>
							<button class="preset-btn" onclick="setPreset('todoFixme')">TODO/FIXME</button>
							<button class="preset-btn" onclick="setPreset('emptyExcept')">Empty Exception</button>
							<button class="preset-btn" onclick="setPreset('eval')">Eval</button>
							<button class="preset-btn" onclick="setPreset('exec')">Exec</button>

							<p class="section-label">File & Network</p>
							<button class="preset-btn" onclick="setPreset('pathTraversal')">Path Traversal</button>
							<button class="preset-btn" onclick="setPreset('unsafeDeserialize')">Deserialization</button>
							<button class="preset-btn" onclick="setPreset('fileUpload')">File Upload</button>
							<button class="preset-btn" onclick="setPreset('noTLSVerify')">TLS Disabled</button>
							<button class="preset-btn" onclick="setPreset('corsAll')">CORS *</button>
							<button class="preset-btn" onclick="setPreset('openRedirect')">Open Redirect</button>
						</div>
					</div>

					<!-- Custom Rule Builder -->
					<div class="card">
						<div class="card-header"><i class="fas fa-hammer"></i> Custom Rule Builder</div>
						<div class="card-body">
							<ul class="nav nav-tabs" id="builderTabs" role="tablist">
								<li class="nav-item"><a class="nav-link active" id="basic-tab" data-toggle="tab" href="#basic" role="tab">Basic</a></li>
								<li class="nav-item"><a class="nav-link" id="advanced-tab" data-toggle="tab" href="#advanced" role="tab">Advanced</a></li>
							</ul>
							<div class="tab-content">
								<div class="tab-pane fade show active" id="basic" role="tabpanel">
									<div class="form-group">
										<label>Rule ID</label>
										<input type="text" class="form-control" id="ruleId" placeholder="my-company.security.sqli" value="custom-security-rule" onchange="generateRule()">
										<p class="help-text">Unique identifier (use dots for namespacing)</p>
									</div>
									<div class="form-group">
										<label>Pattern</label>
										<textarea class="form-control pattern-input" id="pattern" rows="3" placeholder="cursor.execute($QUERY)" onchange="generateRule()"></textarea>
										<p class="help-text">Use $VAR for metavariables, ... for wildcards</p>
									</div>
									<div class="form-group">
										<label>Message</label>
										<textarea class="form-control" id="message" rows="2" placeholder="Potential SQL injection vulnerability" onchange="generateRule()"></textarea>
									</div>
									<div class="row">
										<div class="col-md-6">
											<div class="form-group">
												<label>Severity</label>
												<select class="form-control" id="severity" onchange="generateRule()">
													<option value="ERROR">ERROR</option>
													<option value="WARNING" selected>WARNING</option>
													<option value="INFO">INFO</option>
												</select>
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group">
												<label>Category</label>
												<select class="form-control" id="category" onchange="generateRule()">
													<option value="security">Security</option>
													<option value="correctness">Correctness</option>
													<option value="best-practice">Best Practice</option>
													<option value="performance">Performance</option>
												</select>
											</div>
										</div>
									</div>
								</div>
								<div class="tab-pane fade" id="advanced" role="tabpanel">
									<div class="form-group">
										<label>Pattern Type</label>
										<select class="form-control" id="patternType" onchange="updatePatternFields()">
											<option value="pattern">Simple Pattern</option>
											<option value="patterns">Multiple Patterns (AND)</option>
											<option value="pattern-either">Pattern Either (OR)</option>
											<option value="pattern-regex">Regex Pattern</option>
										</select>
									</div>
									<div id="multiPatternContainer" style="display: none;">
										<div class="form-group">
											<label>Pattern 1</label>
											<input type="text" class="form-control pattern-input" id="pattern1" placeholder="First pattern">
										</div>
										<div class="form-group">
											<label>Pattern 2</label>
											<input type="text" class="form-control pattern-input" id="pattern2" placeholder="Second pattern">
										</div>
										<button class="btn btn-secondary btn-sm" onclick="addPatternField()"><i class="fas fa-plus"></i> Add</button>
									</div>
									<div class="form-group mt-3">
										<label>Pattern NOT (Exclude)</label>
										<input type="text" class="form-control pattern-input" id="patternNot" placeholder="Pattern to exclude" onchange="generateRule()">
									</div>
									<div class="form-group">
										<label>Metavariable Regex</label>
										<div class="row">
											<div class="col-5">
												<input type="text" class="form-control" id="metavar" placeholder="$VAR">
											</div>
											<div class="col-7">
												<input type="text" class="form-control" id="metavarRegex" placeholder=".*password.*">
											</div>
										</div>
									</div>
									<div class="form-group">
										<label>Fix (Auto-fix)</label>
										<textarea class="form-control pattern-input" id="fix" rows="2" placeholder="cursor.execute($QUERY, $PARAMS)" onchange="generateRule()"></textarea>
									</div>
									<div class="row">
										<div class="col-md-6">
											<div class="form-group">
												<label>CWE ID</label>
												<input type="text" class="form-control" id="cwe" placeholder="CWE-89" onchange="generateRule()">
											</div>
										</div>
										<div class="col-md-6">
											<div class="form-group">
												<label>OWASP</label>
												<select class="form-control" id="owasp" onchange="generateRule()">
													<option value="">Select...</option>
													<option value="A01:2021">A01 - Broken Access Control</option>
													<option value="A02:2021">A02 - Cryptographic Failures</option>
													<option value="A03:2021">A03 - Injection</option>
													<option value="A04:2021">A04 - Insecure Design</option>
													<option value="A05:2021">A05 - Security Misconfiguration</option>
													<option value="A07:2021">A07 - Auth Failures</option>
													<option value="A08:2021">A08 - Integrity Failures</option>
													<option value="A10:2021">A10 - SSRF</option>
												</select>
											</div>
										</div>
									</div>
									<button class="btn btn-primary" onclick="generateRule()">Generate Rule</button>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="col-lg-5">
					<!-- Generated Rule -->
					<div class="card">
						<div class="card-header"><i class="fas fa-file-code"></i> Generated Rule (YAML)</div>
						<div class="card-body">
							<div class="output-area" id="ruleOutput">
								<button class="copy-btn" onclick="copyRule()"><i class="fas fa-copy"></i> Copy</button>
								<span id="ruleYaml"># Select a preset or build a custom rule</span>
							</div>
							<div class="mt-3">
								<button class="btn btn-secondary btn-sm" onclick="downloadRule()"><i class="fas fa-download"></i> Download</button>
								<button class="btn btn-secondary btn-sm" onclick="testRule()"><i class="fas fa-external-link-alt"></i> Test in Playground</button>
							</div>
						</div>
					</div>

					<!-- Pattern Syntax Reference -->
					<div class="card">
						<div class="card-header" data-toggle="collapse" href="#syntaxRef">
							<i class="fas fa-book"></i> Pattern Syntax <i class="fas fa-chevron-down float-right"></i>
						</div>
						<div id="syntaxRef" class="collapse show">
							<div class="card-body" style="font-size: 12px;">
								<p style="font-weight:600;margin-bottom:6px;">Metavariables</p>
								<div class="pattern-example">$VAR - any expression<br>$...ARGS - multiple arguments<br>$_VAR - match but don't bind</div>

								<p style="font-weight:600;margin:12px 0 6px;">Ellipsis</p>
								<div class="pattern-example">foo(...) - any arguments<br>foo($X, ...) - first + any others<br>{ ... } - any statements</div>

								<p style="font-weight:600;margin:12px 0 6px;">Deep Expression</p>
								<div class="pattern-example">&lt;... $EXPR ...&gt; - nested match</div>
							</div>
						</div>
					</div>

					<!-- Language Patterns -->
					<div class="card">
						<div class="card-header" data-toggle="collapse" href="#langPatterns">
							<i class="fas fa-code-branch"></i> Language Examples <i class="fas fa-chevron-down float-right"></i>
						</div>
						<div id="langPatterns" class="collapse">
							<div class="card-body ref-scroll" style="font-size: 12px;">
								<p style="font-weight:600;">Python</p>
								<code style="font-size:11px;">subprocess.call($CMD, shell=True)</code><br>
								<code style="font-size:11px;">eval($INPUT)</code><br>
								<code style="font-size:11px;">pickle.loads($DATA)</code><br><br>

								<p style="font-weight:600;">JavaScript</p>
								<code style="font-size:11px;">eval($CODE)</code><br>
								<code style="font-size:11px;">innerHTML = $INPUT</code><br>
								<code style="font-size:11px;">child_process.exec($CMD)</code><br><br>

								<p style="font-weight:600;">Java</p>
								<code style="font-size:11px;">Runtime.getRuntime().exec($CMD)</code><br>
								<code style="font-size:11px;">Statement.executeQuery($SQL)</code>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>

	<footer>
		<div class="container">
			<p>&copy; 2025 Shravan Kumar Sheri</p>
		</div>
	</footer>

	<script>
		let currentLanguage = 'python';
		let patternFieldCount = 2;

		const presets = {
			sqli: { python: { pattern: 'cursor.execute($QUERY)', patternNot: 'cursor.execute($QUERY, $PARAMS)', message: 'Possible SQL injection. Use parameterized queries.', severity: 'ERROR', cwe: 'CWE-89', owasp: 'A03:2021', fix: 'cursor.execute($QUERY, [...])' }, javascript: { pattern: '$DB.query($QUERY)', patternNot: '$DB.query($QUERY, $PARAMS)', message: 'Possible SQL injection.', severity: 'ERROR', cwe: 'CWE-89', owasp: 'A03:2021' }, java: { pattern: '$STMT.executeQuery($QUERY)', message: 'Possible SQL injection. Use PreparedStatement.', severity: 'ERROR', cwe: 'CWE-89', owasp: 'A03:2021' }, go: { pattern: '$DB.Query($QUERY)', patternNot: '$DB.Query($QUERY, $...ARGS)', message: 'Possible SQL injection.', severity: 'ERROR', cwe: 'CWE-89', owasp: 'A03:2021' }, php: { pattern: 'mysqli_query($CONN, $QUERY)', message: 'Possible SQL injection.', severity: 'ERROR', cwe: 'CWE-89', owasp: 'A03:2021' }, generic: { pattern: 'execute($QUERY)', message: 'Possible SQL injection.', severity: 'ERROR', cwe: 'CWE-89', owasp: 'A03:2021' } },
			cmdi: { python: { pattern: 'subprocess.call($CMD, shell=True, ...)', message: 'Command injection risk. Avoid shell=True.', severity: 'ERROR', cwe: 'CWE-78', owasp: 'A03:2021' }, javascript: { pattern: 'child_process.exec($CMD, ...)', message: 'Command injection risk.', severity: 'ERROR', cwe: 'CWE-78', owasp: 'A03:2021' }, java: { pattern: 'Runtime.getRuntime().exec($CMD)', message: 'Command injection risk.', severity: 'ERROR', cwe: 'CWE-78', owasp: 'A03:2021' }, go: { pattern: 'exec.Command($CMD, ...)', message: 'Potential command injection.', severity: 'WARNING', cwe: 'CWE-78', owasp: 'A03:2021' }, php: { pattern: 'shell_exec($CMD)', message: 'Command injection risk.', severity: 'ERROR', cwe: 'CWE-78', owasp: 'A03:2021' }, generic: { pattern: 'exec($CMD)', message: 'Potential command injection.', severity: 'ERROR', cwe: 'CWE-78', owasp: 'A03:2021' } },
			xss: { python: { pattern: 'return HttpResponse($INPUT)', message: 'Potential XSS.', severity: 'WARNING', cwe: 'CWE-79', owasp: 'A03:2021' }, javascript: { pattern: '$EL.innerHTML = $INPUT', message: 'XSS risk. Use textContent.', severity: 'ERROR', cwe: 'CWE-79', owasp: 'A03:2021', fix: '$EL.textContent = $INPUT' }, java: { pattern: 'response.getWriter().write($INPUT)', message: 'Potential XSS.', severity: 'WARNING', cwe: 'CWE-79', owasp: 'A03:2021' }, go: { pattern: 'template.HTML($INPUT)', message: 'XSS risk.', severity: 'ERROR', cwe: 'CWE-79', owasp: 'A03:2021' }, php: { pattern: 'echo $INPUT', message: 'Potential XSS.', severity: 'WARNING', cwe: 'CWE-79', owasp: 'A03:2021', fix: 'echo htmlspecialchars($INPUT)' }, generic: { pattern: 'innerHTML = $INPUT', message: 'Potential XSS.', severity: 'ERROR', cwe: 'CWE-79', owasp: 'A03:2021' } },
			ssrf: { python: { pattern: 'requests.get($URL, ...)', message: 'Potential SSRF.', severity: 'WARNING', cwe: 'CWE-918', owasp: 'A10:2021' }, javascript: { pattern: 'fetch($URL, ...)', message: 'Potential SSRF.', severity: 'WARNING', cwe: 'CWE-918', owasp: 'A10:2021' }, java: { pattern: 'new URL($URL).openConnection()', message: 'Potential SSRF.', severity: 'WARNING', cwe: 'CWE-918', owasp: 'A10:2021' }, go: { pattern: 'http.Get($URL)', message: 'Potential SSRF.', severity: 'WARNING', cwe: 'CWE-918', owasp: 'A10:2021' }, php: { pattern: 'file_get_contents($URL)', message: 'Potential SSRF.', severity: 'WARNING', cwe: 'CWE-918', owasp: 'A10:2021' }, generic: { pattern: 'fetch($URL)', message: 'Potential SSRF.', severity: 'WARNING', cwe: 'CWE-918', owasp: 'A10:2021' } },
			xxe: { python: { pattern: 'etree.parse($INPUT)', message: 'Potential XXE.', severity: 'ERROR', cwe: 'CWE-611', owasp: 'A05:2021' }, java: { pattern: 'DocumentBuilderFactory.newInstance()', message: 'XXE risk.', severity: 'WARNING', cwe: 'CWE-611', owasp: 'A05:2021' }, php: { pattern: 'simplexml_load_string($INPUT)', message: 'Potential XXE.', severity: 'ERROR', cwe: 'CWE-611', owasp: 'A05:2021' }, generic: { pattern: 'parseXML($INPUT)', message: 'Potential XXE.', severity: 'ERROR', cwe: 'CWE-611', owasp: 'A05:2021' } },
			ldapi: { python: { pattern: 'ldap.search_s($BASE, $SCOPE, $FILTER)', message: 'Potential LDAP injection.', severity: 'ERROR', cwe: 'CWE-90', owasp: 'A03:2021' }, java: { pattern: '$CTX.search($NAME, $FILTER, ...)', message: 'Potential LDAP injection.', severity: 'ERROR', cwe: 'CWE-90', owasp: 'A03:2021' }, generic: { pattern: 'ldap_search($CONN, $BASE, $FILTER)', message: 'Potential LDAP injection.', severity: 'ERROR', cwe: 'CWE-90', owasp: 'A03:2021' } },
			xpath: { python: { pattern: '$TREE.xpath($QUERY)', message: 'Potential XPath injection.', severity: 'ERROR', cwe: 'CWE-643', owasp: 'A03:2021' }, java: { pattern: '$XPATH.evaluate($EXPR, ...)', message: 'Potential XPath injection.', severity: 'ERROR', cwe: 'CWE-643', owasp: 'A03:2021' }, generic: { pattern: 'xpath($QUERY)', message: 'Potential XPath injection.', severity: 'ERROR', cwe: 'CWE-643', owasp: 'A03:2021' } },
			ssti: { python: { pattern: 'Template($INPUT).render(...)', message: 'SSTI risk.', severity: 'ERROR', cwe: 'CWE-1336', owasp: 'A03:2021' }, javascript: { pattern: 'ejs.render($TEMPLATE, ...)', message: 'Potential SSTI.', severity: 'ERROR', cwe: 'CWE-1336', owasp: 'A03:2021' }, java: { pattern: '$ENGINE.getTemplate($INPUT)', message: 'Potential SSTI.', severity: 'ERROR', cwe: 'CWE-1336', owasp: 'A03:2021' }, generic: { pattern: 'render_template_string($INPUT)', message: 'SSTI risk.', severity: 'ERROR', cwe: 'CWE-1336', owasp: 'A03:2021' } },
			hardcodedPassword: { python: { pattern: 'password = "..."', message: 'Hardcoded password. Use env vars.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' }, javascript: { pattern: 'password: "..."', message: 'Hardcoded password.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' }, java: { pattern: 'String password = "...";', message: 'Hardcoded password.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' }, generic: { pattern: 'password = "..."', message: 'Hardcoded password.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' } },
			hardcodedSecret: { python: { pattern: 'secret_key = "..."', message: 'Hardcoded secret.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' }, javascript: { pattern: 'secretKey: "..."', message: 'Hardcoded secret.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' }, generic: { pattern: 'secret = "..."', message: 'Hardcoded secret.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' } },
			apiKey: { generic: { patternRegex: '(api_key|apikey|api-key)\\s*[=:]\\s*["\'][a-zA-Z0-9]{16,}["\']', message: 'API key exposure.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' } },
			awsKeys: { generic: { patternRegex: 'AKIA[0-9A-Z]{16}', message: 'AWS Access Key detected.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' } },
			privateKey: { generic: { patternRegex: '-----BEGIN (RSA |EC |DSA )?PRIVATE KEY-----', message: 'Private key in source.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' } },
			jwtSecret: { python: { pattern: 'jwt.encode($PAYLOAD, "...", ...)', message: 'Hardcoded JWT secret.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' }, javascript: { pattern: 'jwt.sign($PAYLOAD, "...", ...)', message: 'Hardcoded JWT secret.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' }, generic: { pattern: 'jwt.sign($PAYLOAD, "...")', message: 'Hardcoded JWT secret.', severity: 'ERROR', cwe: 'CWE-798', owasp: 'A07:2021' } },
			weakCrypto: { python: { pattern: 'DES.new(...)', message: 'Weak crypto (DES). Use AES.', severity: 'ERROR', cwe: 'CWE-327', owasp: 'A02:2021' }, java: { pattern: 'Cipher.getInstance("DES")', message: 'Weak crypto (DES).', severity: 'ERROR', cwe: 'CWE-327', owasp: 'A02:2021' }, generic: { pattern: 'DES.encrypt(...)', message: 'Weak crypto.', severity: 'ERROR', cwe: 'CWE-327', owasp: 'A02:2021' } },
			weakHash: { python: { pattern: 'hashlib.md5($INPUT)', message: 'Weak hash (MD5).', severity: 'WARNING', cwe: 'CWE-328', owasp: 'A02:2021', fix: 'hashlib.sha256($INPUT)' }, javascript: { pattern: 'crypto.createHash("md5")', message: 'Weak hash (MD5).', severity: 'WARNING', cwe: 'CWE-328', owasp: 'A02:2021' }, java: { pattern: 'MessageDigest.getInstance("MD5")', message: 'Weak hash (MD5).', severity: 'WARNING', cwe: 'CWE-328', owasp: 'A02:2021' }, php: { pattern: 'md5($INPUT)', message: 'Weak hash.', severity: 'WARNING', cwe: 'CWE-328', owasp: 'A02:2021' }, generic: { pattern: 'md5($INPUT)', message: 'Weak hash.', severity: 'WARNING', cwe: 'CWE-328', owasp: 'A02:2021' } },
			insecureRandom: { python: { pattern: 'random.random()', message: 'Insecure random. Use secrets.', severity: 'WARNING', cwe: 'CWE-330', owasp: 'A02:2021', fix: 'secrets.token_bytes()' }, javascript: { pattern: 'Math.random()', message: 'Insecure random.', severity: 'WARNING', cwe: 'CWE-330', owasp: 'A02:2021' }, java: { pattern: 'new Random()', message: 'Use SecureRandom.', severity: 'WARNING', cwe: 'CWE-330', owasp: 'A02:2021', fix: 'new SecureRandom()' }, generic: { pattern: 'rand()', message: 'Insecure random.', severity: 'WARNING', cwe: 'CWE-330', owasp: 'A02:2021' } },
			noAuth: { python: { pattern: '@app.route($PATH)\ndef $FUNC(...):\n    ...', patternNot: '@login_required', message: 'Missing auth check.', severity: 'WARNING', cwe: 'CWE-306', owasp: 'A07:2021' }, generic: { pattern: 'router.get($PATH, $HANDLER)', message: 'Ensure auth check.', severity: 'INFO', cwe: 'CWE-306', owasp: 'A07:2021' } },
			hardcodedIV: { python: { pattern: 'AES.new($KEY, AES.MODE_CBC, "...")', message: 'Hardcoded IV.', severity: 'ERROR', cwe: 'CWE-329', owasp: 'A02:2021' }, java: { pattern: 'new IvParameterSpec("...".getBytes())', message: 'Hardcoded IV.', severity: 'ERROR', cwe: 'CWE-329', owasp: 'A02:2021' }, generic: { pattern: 'iv = "..."', message: 'Hardcoded IV.', severity: 'ERROR', cwe: 'CWE-329', owasp: 'A02:2021' } },
			debugCode: { python: { pattern: 'import pdb; pdb.set_trace()', message: 'Debug code.', severity: 'WARNING', cwe: 'CWE-489' }, javascript: { pattern: 'debugger', message: 'Debugger statement.', severity: 'WARNING', cwe: 'CWE-489' }, generic: { pattern: 'console.log($DEBUG)', message: 'Debug logging.', severity: 'INFO', cwe: 'CWE-489' } },
			todoFixme: { generic: { patternRegex: '(TODO|FIXME|XXX|HACK):?\\s*.*', message: 'TODO/FIXME found.', severity: 'INFO' } },
			emptyExcept: { python: { pattern: 'except:\n    pass', message: 'Empty except.', severity: 'WARNING', cwe: 'CWE-390' }, java: { pattern: 'catch ($TYPE $E) { }', message: 'Empty catch.', severity: 'WARNING', cwe: 'CWE-390' }, generic: { pattern: 'catch { }', message: 'Empty catch.', severity: 'WARNING', cwe: 'CWE-390' } },
			eval: { python: { pattern: 'eval($INPUT)', message: 'Dangerous eval().', severity: 'ERROR', cwe: 'CWE-95', owasp: 'A03:2021' }, javascript: { pattern: 'eval($INPUT)', message: 'Dangerous eval().', severity: 'ERROR', cwe: 'CWE-95', owasp: 'A03:2021' }, php: { pattern: 'eval($INPUT)', message: 'Dangerous eval().', severity: 'ERROR', cwe: 'CWE-95', owasp: 'A03:2021' }, generic: { pattern: 'eval($CODE)', message: 'Dangerous eval().', severity: 'ERROR', cwe: 'CWE-95', owasp: 'A03:2021' } },
			exec: { python: { pattern: 'exec($CODE)', message: 'Dangerous exec().', severity: 'ERROR', cwe: 'CWE-95', owasp: 'A03:2021' }, generic: { pattern: 'exec($CODE)', message: 'Dangerous exec().', severity: 'ERROR', cwe: 'CWE-95', owasp: 'A03:2021' } },
			pathTraversal: { python: { pattern: 'open($PATH, ...)', message: 'Potential path traversal.', severity: 'WARNING', cwe: 'CWE-22', owasp: 'A01:2021' }, javascript: { pattern: 'fs.readFile($PATH, ...)', message: 'Potential path traversal.', severity: 'WARNING', cwe: 'CWE-22', owasp: 'A01:2021' }, java: { pattern: 'new FileInputStream($PATH)', message: 'Potential path traversal.', severity: 'WARNING', cwe: 'CWE-22', owasp: 'A01:2021' }, php: { pattern: 'include($PATH)', message: 'Potential LFI.', severity: 'ERROR', cwe: 'CWE-22', owasp: 'A01:2021' }, generic: { pattern: 'readFile($PATH)', message: 'Potential path traversal.', severity: 'WARNING', cwe: 'CWE-22', owasp: 'A01:2021' } },
			unsafeDeserialize: { python: { pattern: 'pickle.loads($DATA)', message: 'Unsafe deserialization.', severity: 'ERROR', cwe: 'CWE-502', owasp: 'A08:2021' }, java: { pattern: 'new ObjectInputStream($STREAM).readObject()', message: 'Unsafe deserialization.', severity: 'ERROR', cwe: 'CWE-502', owasp: 'A08:2021' }, php: { pattern: 'unserialize($DATA)', message: 'Unsafe deserialization.', severity: 'ERROR', cwe: 'CWE-502', owasp: 'A08:2021' }, ruby: { pattern: 'Marshal.load($DATA)', message: 'Unsafe deserialization.', severity: 'ERROR', cwe: 'CWE-502', owasp: 'A08:2021' }, generic: { pattern: 'deserialize($DATA)', message: 'Unsafe deserialization.', severity: 'ERROR', cwe: 'CWE-502', owasp: 'A08:2021' } },
			fileUpload: { python: { pattern: 'file.save($PATH)', message: 'File upload - validate type.', severity: 'WARNING', cwe: 'CWE-434', owasp: 'A04:2021' }, php: { pattern: 'move_uploaded_file($TMP, $DEST)', message: 'File upload - validate.', severity: 'WARNING', cwe: 'CWE-434', owasp: 'A04:2021' }, generic: { pattern: 'saveFile($FILE, $PATH)', message: 'File upload.', severity: 'WARNING', cwe: 'CWE-434', owasp: 'A04:2021' } },
			noTLSVerify: { python: { pattern: 'requests.get($URL, verify=False, ...)', message: 'TLS verification disabled.', severity: 'ERROR', cwe: 'CWE-295', owasp: 'A02:2021' }, javascript: { pattern: 'rejectUnauthorized: false', message: 'TLS verification disabled.', severity: 'ERROR', cwe: 'CWE-295', owasp: 'A02:2021' }, go: { pattern: 'InsecureSkipVerify: true', message: 'TLS verification disabled.', severity: 'ERROR', cwe: 'CWE-295', owasp: 'A02:2021' }, generic: { pattern: 'verify=false', message: 'TLS may be disabled.', severity: 'ERROR', cwe: 'CWE-295', owasp: 'A02:2021' } },
			corsAll: { python: { pattern: 'Access-Control-Allow-Origin: "*"', message: 'CORS allows all.', severity: 'WARNING', cwe: 'CWE-942', owasp: 'A05:2021' }, javascript: { pattern: '"Access-Control-Allow-Origin": "*"', message: 'CORS allows all.', severity: 'WARNING', cwe: 'CWE-942', owasp: 'A05:2021' }, generic: { pattern: 'Access-Control-Allow-Origin: *', message: 'CORS allows all.', severity: 'WARNING', cwe: 'CWE-942', owasp: 'A05:2021' } },
			openRedirect: { python: { pattern: 'redirect($URL)', message: 'Potential open redirect.', severity: 'WARNING', cwe: 'CWE-601', owasp: 'A01:2021' }, javascript: { pattern: 'window.location = $URL', message: 'Potential open redirect.', severity: 'WARNING', cwe: 'CWE-601', owasp: 'A01:2021' }, java: { pattern: 'response.sendRedirect($URL)', message: 'Potential open redirect.', severity: 'WARNING', cwe: 'CWE-601', owasp: 'A01:2021' }, php: { pattern: 'header("Location: " . $URL)', message: 'Potential open redirect.', severity: 'WARNING', cwe: 'CWE-601', owasp: 'A01:2021' }, generic: { pattern: 'redirect($URL)', message: 'Potential open redirect.', severity: 'WARNING', cwe: 'CWE-601', owasp: 'A01:2021' } }
		};

		function selectLanguage(lang) {
			currentLanguage = lang;
			document.querySelectorAll('.lang-badge').forEach(b => b.classList.remove('active'));
			event.target.classList.add('active');
			generateRule();
		}

		function setPreset(presetName) {
			const preset = presets[presetName];
			const langPreset = preset[currentLanguage] || preset['generic'] || Object.values(preset)[0];
			document.getElementById('ruleId').value = `security.${currentLanguage}.${presetName}`;
			document.getElementById('pattern').value = langPreset.pattern || '';
			document.getElementById('message').value = langPreset.message || '';
			document.getElementById('severity').value = langPreset.severity || 'WARNING';
			document.getElementById('patternNot').value = langPreset.patternNot || '';
			document.getElementById('fix').value = langPreset.fix || '';
			document.getElementById('cwe').value = langPreset.cwe || '';
			document.getElementById('owasp').value = langPreset.owasp || '';
			if (langPreset.patternRegex) { document.getElementById('patternType').value = 'pattern-regex'; document.getElementById('pattern').value = langPreset.patternRegex; }
			else { document.getElementById('patternType').value = 'pattern'; }
			document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
			event.target.classList.add('active');
			generateRule();
		}

		function generateRule() {
			const ruleId = document.getElementById('ruleId').value || 'custom-rule';
			const pattern = document.getElementById('pattern').value;
			const message = document.getElementById('message').value || 'Security issue detected';
			const severity = document.getElementById('severity').value;
			const category = document.getElementById('category').value;
			const patternNot = document.getElementById('patternNot').value;
			const fix = document.getElementById('fix').value;
			const cwe = document.getElementById('cwe').value;
			const owasp = document.getElementById('owasp').value;
			const patternType = document.getElementById('patternType').value;
			const metavar = document.getElementById('metavar').value;
			const metavarRegex = document.getElementById('metavarRegex').value;

			let yaml = `rules:
  - id: ${ruleId}
    languages:
      - ${currentLanguage}
    message: >-
      ${message}
    severity: ${severity}
    metadata:
      category: ${category}
      technology:
        - ${currentLanguage}`;
			if (cwe) yaml += `\n      cwe:\n        - "${cwe}"`;
			if (owasp) yaml += `\n      owasp:\n        - "${owasp}"`;
			yaml += `\n      confidence: MEDIUM`;

			if (pattern) {
				if (patternType === 'pattern-regex') {
					yaml += `\n    pattern-regex: '${pattern}'`;
				} else if (patternType === 'patterns' || patternType === 'pattern-either') {
					const patterns = [pattern];
					for (let i = 1; i <= patternFieldCount; i++) {
						const pField = document.getElementById(`pattern${i}`);
						if (pField && pField.value) patterns.push(pField.value);
					}
					if (patternType === 'patterns') {
						yaml += `\n    patterns:`;
						patterns.forEach(p => { yaml += `\n      - pattern: ${p}`; });
						if (patternNot) yaml += `\n      - pattern-not: ${patternNot}`;
						if (metavar && metavarRegex) yaml += `\n      - metavariable-regex:\n          metavariable: ${metavar}\n          regex: '${metavarRegex}'`;
					} else {
						yaml += `\n    pattern-either:`;
						patterns.forEach(p => { yaml += `\n      - pattern: ${p}`; });
					}
				} else if (patternNot || (metavar && metavarRegex)) {
					yaml += `\n    patterns:\n      - pattern: ${pattern}`;
					if (patternNot) yaml += `\n      - pattern-not: ${patternNot}`;
					if (metavar && metavarRegex) yaml += `\n      - metavariable-regex:\n          metavariable: ${metavar}\n          regex: '${metavarRegex}'`;
				} else {
					yaml += `\n    pattern: ${pattern}`;
				}
			}
			if (fix) yaml += `\n    fix: ${fix}`;
			document.getElementById('ruleYaml').textContent = yaml;
		}

		function updatePatternFields() {
			const type = document.getElementById('patternType').value;
			document.getElementById('multiPatternContainer').style.display = (type === 'patterns' || type === 'pattern-either') ? 'block' : 'none';
		}

		function addPatternField() {
			patternFieldCount++;
			const container = document.getElementById('multiPatternContainer');
			const newField = document.createElement('div');
			newField.className = 'form-group';
			newField.innerHTML = `<label>Pattern ${patternFieldCount}</label><input type="text" class="form-control pattern-input" id="pattern${patternFieldCount}" placeholder="Additional pattern">`;
			container.insertBefore(newField, container.lastElementChild);
		}

		function copyRule() {
			const rule = document.getElementById('ruleYaml').textContent;
			navigator.clipboard.writeText(rule).then(() => {
				const btn = document.querySelector('.copy-btn');
				btn.innerHTML = '<i class="fas fa-check"></i> Copied';
				setTimeout(() => { btn.innerHTML = '<i class="fas fa-copy"></i> Copy'; }, 2000);
			});
		}

		function downloadRule() {
			const rule = document.getElementById('ruleYaml').textContent;
			const ruleId = document.getElementById('ruleId').value || 'custom-rule';
			const blob = new Blob([rule], { type: 'text/yaml' });
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = `${ruleId.replace(/\./g, '-')}.yaml`;
			a.click();
			URL.revokeObjectURL(url);
		}

		function testRule() { window.open('https://semgrep.dev/playground', '_blank'); }

		document.addEventListener('DOMContentLoaded', function() { generateRule(); });
	</script>
</body>
</html>
